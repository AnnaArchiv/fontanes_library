<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Fontanes Handbibliothek</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="js/d3.v4.min.js"></script>
    <script src="js/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


    <style type="text/css">
        html,
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #EBE3DD;
            margin: 0;
            overflow-y: scroll;
            overflow-x: scroll;
            width: 100%;
            height: 28000px;
        }

        h1 {
            margin-left: 0px;
            margin-top: 17px;
            margin-bottom: 0;
            font-weight: 400;
            letter-spacing: 1px;
            font-size: 28px;
            text-transform: uppercase;
        }

        #legend {
            text-transform: uppercase;
            margin-left: 0px;
            margin-top: 5px;
            font-weight: 500;
            font-size: 12px;
            width: 800px;
            height: 60px;
        }

        .eigentumsangaben {
            fill: #1c1c1c;
        }

        .markierungen {
            fill: #f91b49;
        }

        .marginalien {
            fill: #4D8DFF;
        }


        span {
            margin-right: 10px;
        }




        #header {
            z-index: 200;
            position: fixed;
            left: 105px;
            top: 0px;
            width: 100%;
        }


        #scrollnavi {
            z-index: 100;
            position: fixed;
            background-color: #474747;
            border-right: 1px;
            height: 100%;
            width: 80px;
            left: 0;
            top: 0px;
            box-shadow: 2px 0px 5px grey;
            padding-top: 0px;
        }

        #scrollnavi p {
            z-index: 100;
            font-size: 11px;
            margin-left: 5px;
            margin-top: 150px;
            margin-bottom: 150px;
            color: white;
            font-weight: 300;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        #scrollnavi svg {
            z-index: 100;
            position: fixed;
            width: 80px;
            height: 100%;
        }

        #headerIcons {
            z-index: 100;
            float: right;
            padding-right: 100px;
        }

        .search-container {
            float: right;
        }

        #headerIcons input[type=text] {
            padding: 4px;
            width: 160px;
            margin-top: 20px;
            font-size: 12px;
            border-width: 1px;
            border-color: lightgrey;
            border-style: solid;
        }

        .search-container button {
            float: right;
            padding: 4px 6px;
            margin-top: 20px;
            margin-right: 20px;
            background: white;
            font-size: 12px;
            color: grey;
            border-width: 1px;
            border-color: lightgrey;
            border-style: solid;
            border-left: none;
            cursor: pointer;
        }

        .search-container button:hover {
            background: #ccc;
        }

        .headericons {
            margin-top: 20px;
            margin-right: 0px;
            margin-left: 10px;
            float: right;
            width: 26px;
            height: 26px;
        }

        #scroller {
            overflow: scroll;
            height: 100%;
            width: 120px;
            left: 0;
            top: 0px;
        }

        #svg {
          position: fixed;
            margin-left: 105px;
            left: 0;
            margin-top: 120px;
        }

        #svgFront {
            overflow-x: hidden;
            position: fixed;
            margin-left: 105px;
            left: 0;
            margin-top: 120px;
            pointer-events: none;
        }

        #svgFrontTitles {
            overflow-x: hidden;
            position: fixed;
            margin-left: 105px;
            left: 0;
            margin-top: 120px;
            pointer-events: none;
            display:  inline;
        }

        canvas {
            position: fixed;
            margin-left: 105px;
            left: 0;
            margin-top: 240px;
            width: 100%;
            height: 6500px;
            pointer-events: none;
        }


        #container {
            top: 0px;
            position: fixed;
        }

        .anstreichung {
            color: #F74141;
            fill: #F74141;
            cursor: pointer;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .anstreichung.eingefaltet{
            fill: #f91b49;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .unterstreichung {
            color: #FF8A5D;
            fill: #FF8A5D;
            cursor: pointer;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .unterstreichung.eingefaltet{
            fill: #f91b49;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .durchstreichung {
            color: #8D084E;
            fill: #8D084E;
            cursor: pointer;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .durchstreichung.eingefaltet{
            fill: #f91b49;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .sonstigeMarkierung {
            color: #FD9698;
            fill: #FD9698;
            cursor: pointer;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .sonstigeMarkierung.eingefaltet{
            fill: #f91b49;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .anderes {
            color: #ff206a;
            fill: #ff206a;
            cursor: pointer;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .anderes.eingefaltet{
            fill: #f91b49;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .zusatzMaterial {
            color: #e5b404;
            fill: #e5b404;
            cursor: pointer;

        }


        .provenienz {
            color: #575757;
            fill: #575757;
            cursor: pointer;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .provenienz.eingefaltet{
            fill: #1c1c1c;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .provenienzstempel {
            color: #828282;
            fill: #828282;
            cursor: pointer;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .provenienzstempel.eingefaltet{
            fill: #1c1c1c;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .bewertung {
            color: #afacff;
            fill: #afacff;
            cursor: pointer;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .bewertung.eingefaltet{
            fill: #4D8DFF;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .kommentar {
            color: #018DC9;
            fill: #018DC9;
            cursor: pointer;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .kommentar.eingefaltet{
            fill: #4D8DFF;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .textkorrektur {
            color: #29D1E2;
            fill: #29D1E2;
            cursor: pointer;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .textkorrektur.eingefaltet{
            fill: #4D8DFF;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .uebersetzung {
            color: #003888;
            fill: #003888;
            cursor: pointer;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .uebersetzung.eingefaltet{
            fill: #4D8DFF;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .variante {
            color: #6544FE;
            fill: #6544FE;
            cursor: pointer;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .variante.eingefaltet{
            fill: #4D8DFF;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .leer {
            padding-left: 5px;
            padding-right: 5px;
            color: #ffffff;
            fill: #ffffff;
            background-color: rgb(206, 193, 184);
        }


        .filtered{
          fill: white!important;
          -webkit-transition: fill 0.5s linear;
          -moz-transition: fill 0.5s linear;
          -o-transition: fill 0.5s linear;
          transition: fill 0.5s linear;
        }

        .authorLabel {
            font-size: 11px;
            font-weight: 400;
        }

        .BuchTitelLabel {
            font-size: 11px;
        }

        .detailinfo {
            font-size: 11px;
        }

        .detail_titel {
            font-weight: bold;
        }



        .scroll-wrapper {
            position: relative;
            height: 100%;
            padding-top: 0px;
        }





        .navigationLabels {
            font-size: 11px;
            text-transform: uppercase;
        }

        #iconshare{
          margin-right: 100px;
        }
    </style>
</head>

<body>
  <div id="header">
      <div id="headerIcons">
          <img alt="share" id="iconshare" src="icons/icon-share.svg" class="headericons">
          <img alt="help" src="icons/icon-help.svg" class="headericons">
          <img alt="info" src="icons/icon-info.svg" class="headericons">


          <div class="search-container">
              <input type="text" placeholder="MARGINALIEN-SUCHE" name="search">
              <button type="submit"><i class="fa fa-search"></i></button>
          </div>

      </div>

      <h1>Fontanes Handbibliothek</h1>
      <svg id="legend"></svg>
  </div>
  <svg id="svg"></svg>


    <div id="scrollnavi">
        <svg id="scrollSvg"></svg>
    </div>


    <!-- <div id="scrollnavi"></div> -->

    <div id="container">


    </div>


    </div>

    <script>
    //    window.scrollTo(0,(document.documentElement.scrollHeight)/2-((window.innerHeight)/2))




         setTimeout(function() {

           window.scrollTo(0, 6000)
          //   $("body").scrollTop(10000);
         }, 10);

        var scroller = d3.select('body')

        window.onscroll = function(){console.log(Math.max(window.pageYOffset, document.documentElement.scrollTop, document.body.scrollTop))
      //    console.log(scroller.node().scrollTop)
      //    console.log($(window).scrollTop())
          var scrollTop2 = Math.max(window.pageYOffset, document.documentElement.scrollTop, document.body.scrollTop)

                          newScrollTop = scrollTop2-6000
                    //      console.log(newScrollTop)




                          ////////////////////scrollnavi/
                          ////////////////////////////////////////

                          var scrollCircleScale = d3.scaleLinear()
                              .domain([-4990, 0, 2600])
                              .range([firstScrollIcon, secondScrollIcon, thirdScrollIcon-5])
                              .clamp(true)

                          d3.selectAll(".scrollCircleFollower")
                              .attr("cy", scrollCircleScale(newScrollTop))


        }

        var scrollTop = 0
        var newScrollTop = scroller.node().scrollTop - 5050 - 301
//console.log(scroller.node().scrollTop)

        scroller
            .on("scroll", function() {
var scrollTop2 = Math.max(window.pageYOffset, document.documentElement.scrollTop, document.body.scrollTop)


                newScrollTop = scrollTop2




                ////////////////////scrollnavi/
                ////////////////////////////////////////

                var scrollCircleScale = d3.scaleLinear()
                    .domain([-4990, 0, 2600])
                    .range([40, 380, 720])
                    .clamp(true)

                d3.selectAll(".scrollCircleFollower")
                    .attr("cy", scrollCircleScale(newScrollTop))


                ////////////////////scrollnaviEnde
                ////////////////////////////////////////
            })





        // === Set up canvas === //

        var width = window.innerWidth - 100//1300,
        var height = window.innerHeight - 120//680;
        console.log(width)
        console.log(height)

        //Retina function
        function getRetinaRatio() {
            var devicePixelRatio = window.devicePixelRatio || 1
            var c = document.createElement('canvas').getContext('2d')
            var backingStoreRatio = [
                c.webkitBackingStorePixelRatio,
                c.mozBackingStorePixelRatio,
                c.msBackingStorePixelRatio,
                c.oBackingStorePixelRatio,
                c.backingStorePixelRatio,
                1
            ].reduce(function(a, b) {
                return a || b
            })

            return devicePixelRatio / backingStoreRatio
        }

        var ratio = getRetinaRatio()
        var scaledWidth = width * ratio
        var scaledHeight = height * ratio

        //Retina function ende

        var data = [];
        var value = 5000;
        var colourScale;

        var thisVerfasser = 0
        var thisVerfasserSelected = "Fontane, Theodor"



        var tooltip = d3.select("body")
            .append("div")
            .style("position", "absolute")
            .style("z-index", "300")
            .style("display", "none")
            .attr("width", 200)
            .attr("class", "tooltip")

        tooltip.append("img").attr("width", 400).attr("height", "auto")

        // var tooltipTitle = d3.select("body")
        //     .append("div")
        //     .style("position", "absolute")
        //     .style("z-index", "300")
        //     .style("display", "none")
        //     .attr("width", 20)
        //     .attr("height", 600)
        //     .attr("top", 400)
        //     .attr("background-color", "black")
        //     .attr("class", "tooltipTitle")






        var svg = d3.select("#svg")
            .style('width', width + 'px')
            .style('height', height + 'px')

        var svgFront = d3.select("#svgFront")
            .style('width', width + 'px')
            .style('height', height + 'px')

            var svgFrontTitles = d3.select("#svgFrontTitles")
                .style('width', width + 'px')
                .style('height', height + 'px')


        var scrollSvg = d3.select("#scrollSvg")

        var firstScrollIcon = 40
        var secondScrollIcon = window.innerHeight/2
        var thirdScrollIcon = window.innerHeight - 40

        var scrollBgLines = scrollSvg.append("g").attr("transform", "translate(39,-5)")
        var scrollCircles = scrollSvg.append("g").attr("transform", "translate(40,-5)")
        var scrollIcons = scrollSvg.append("g").attr("transform", "translate(0,-18)")
        var scrollLabels = scrollSvg.append("g").attr("transform", "translate(58,-5)")


        scrollBgLines.append("line")
            .attr("x1", 0)
            .attr("x2", 4)
            .attr("y1", firstScrollIcon)
            .attr("y2", thirdScrollIcon)
            .attr("stroke", "white")
            .style("opacity", 0.3)

        scrollBgLines.append("line")
            .attr("x1", 22)
            .attr("x2", 18)
            .attr("y1", firstScrollIcon)
            .attr("y2", thirdScrollIcon)
            .attr("stroke", "white")
            .style("opacity", 0.3)




        // scrollLabels.append("text").text("Autor/In")
        // .attr("y", 45)
        // .attr("x", 10)
        // .attr("fill", "white")
        // .attr("class", "navigationLabels")
        // .style("cursor", "pointer")
        // .on("click", function(){
        // 	$("body").animate({scrollTop:0}, '2000')})


        scrollIcons.append("image")
            .attr("xlink:href", "icons/authorlevel.svg")
            .attr("y", firstScrollIcon+5)
            .attr("x", 10)
            .attr("width", 20)
            .attr("height", 20)
            .style("cursor", "pointer")
            .on("click", function() {
                $("html,body").animate({
                    scrollTop: 0
                }, '3000')
            })

        // scrollLabels.append("text").text("Buch")
        // .attr("y", 385)
        // .attr("x", 10)
        // .attr("fill", "white")
        // .attr("class", "navigationLabels")
        // .style("cursor", "pointer")
        // .on("click", function(){
        // 	$("body").animate({scrollTop:5351}, '2000')})

        scrollIcons.append("image")
            .attr("xlink:href", "icons/buchlevel.svg")
            .attr("y", secondScrollIcon+5)
            .attr("x", 10)
            .attr("width", 20)
            .attr("height", 20)
            .style("cursor", "pointer")
            .on("click", function() {
                $("html,body").animate({
                    scrollTop: 6000
                }, '3000')
            })


        // scrollLabels.append("text").text("Seiten")
        // .attr("y", 725)
        // .attr("x", 10)
        // .attr("fill", "white")
        // .attr("class", "navigationLabels")
        // .style("cursor", "pointer")
        // .on("click", function(){
        // 	$("body").animate({scrollTop:8000}, '2000')})


        scrollIcons.append("image")
            .attr("xlink:href", "icons/seitenlevel.svg")
            .attr("y", thirdScrollIcon)
            .attr("x", 10)
            .attr("width", 20)
            .attr("height", 20)
            .style("cursor", "pointer")
            .on("click", function() {
              $("html,body").animate({
                    scrollTop: 9000
                }, '3000')
            })

        scrollCircles.append("circle")
            .attr("r", 11)
            .attr("cx", 10)
            .attr("cy", firstScrollIcon)
            .attr("stroke", "white")
            .attr("fill", "#474747")
            .style("cursor", "pointer")
            .on("click", function() {
                $("html,body").animate({
                    scrollTop: 0
                }, '3000')
            })

        scrollCircles.append("circle")
            .attr("r", 9)
            .attr("cx", 10)
            .attr("cy", secondScrollIcon)
            .attr("stroke", "white")
            .attr("fill", "#474747")
            .style("cursor", "pointer")
            .on("click", function() {
              $("html,body").animate({
                    scrollTop: 6000
                }, '3000')
            })

        scrollCircles.append("circle")
            .attr("r", 7)
            .attr("cx", 10)
            .attr("cy", thirdScrollIcon-5)
            .attr("stroke", "white")
            .attr("fill", "#474747")
            .style("cursor", "pointer")
            .on("click", function() {
              $("html,body").animate({
                    scrollTop: 9000
                }, '3000')
            })

        var scrollCircleFollower = scrollCircles.append("circle")
            .attr("r", 5)
            .attr("cx", 10)
            .attr("cy", secondScrollIcon)
            .attr("fill", "white")
            .attr("class", "scrollCircleFollower")






        //Real visible canvas
        var canvas = d3.select('#container')
            .append('canvas')
            .attr("id", "canvas")
            .attr('width', scaledWidth)
            .attr('height', scaledHeight)
            .style('width', width + 'px')
            .style('height', height + 'px')
        //	.style("display","none");

        var context = canvas.node().getContext('2d');
        context.scale(ratio, ratio)



        var svgFront = d3.select('body')
            .append("svg")
            .attr("id", "svgFront")
            .style('width', width + 'px')
            .style('height', height + "px")

            var svgFrontTitles = d3.select('body')
                .append("svg")
                .attr("id", "svgFrontTitles")
                .style('width', width + 'px')
                .style('height', height + "px")




        //Create a custom element, that will not be attached to the DOM, to which we can bind the data
        var detachedContainer = document.createElement("custom");
        var dataContainer = d3.select(detachedContainer);


        var transitions = false

        ///Load data
        d3.csv("data/data.csv", function(error, dataset) {
            if (error) throw error;



            var datensatzAll = dataset //.filter(function(d,i){return d.Benutzungsspur != "null"})
            //	console.log(dataset)

            var datenByAuthor = d3.nest()
                .key(function(d) {
                    if (+d.AuthorCount > 1) {
                        return d.Verfasser
                    } else {
                        return "Sonstige"
                    }
                })
                .entries(dataset);

            datenByAuthor.forEach(function(D, I) {
                D.values = d3.nest()
                    .key(function(d) {
                        return d.BookID;
                    })
                    .entries(D.values);
            })

        //    console.log(datenByAuthor)



            var datenByTitle = d3.nest()
                .key(function(d) {
                    return d.BookID;
                })
                .entries(dataset);

            datenByTitle.forEach(function(D, I) {
                D.authorCount = +D.values[0].AuthorCount //.values.length

            })


          //  console.log(datenByTitle)


            //console.log(datenByTitle)
            //////////legend///////////////////////////////////////
            ////////////////////////////////////////////////////////////
            ////////////////////////////////////////////////////////////
            //////////////////////////////////////////////////////////////

            var filter = null
            var eigentumsangabenEntfaltet = false
            var markierungenEntfaltet = false
            var marginalienEntfaltet = false

            var legend = d3.select("#legend")

            var eigentumsangaben = legend.append("g")
                .attr("class", "eigentumsangaben")
                .style("cursor", "pointer")

                eigentumsangaben.append("text")
                .attr("y", 14)

            var zusatzMaterial = legend.append("g")
                .attr("class", "zusatzMaterial")
                .style("cursor", "pointer")

            var markierungen = legend.append("g")
                .attr("class", "markierungen")
                .style("cursor", "pointer")

                markierungen.append("text")
                .attr("y", 28)

            var marginalien = legend.append("g")
                .attr("class", "marginalien")
                .style("cursor", "pointer")

                marginalien.append("text")
                .attr("y", 42)

            var leereSeite = legend.append("g")
                .attr("class", "leereSeite")

                ////////////////Provenienz-Filter Start
                ///////////////////////////////////////////////


                eigentumsangaben.select("text").append("tspan")
                    .text("Eigentumsangaben")
                    .attr("class", "EigentumsangabenFilter")
                    .on("click", function() {
                      if (filter != "eigentumsangaben"){
                        filter = "eigentumsangaben"
                        eigentumsangabenEntfaltet = true


                        farbausfaltungProvenienz()
                        filterInteraction()
                        eigentumsangaben.selectAll(".EigentumsangabenPlus").text(" ⊖")
                        markierungen.selectAll(".MarkierungenPlus").text(" ⊕")
                        marginalien.selectAll(".MarginalienPlus").text(" ⊕")
                        eigentumsangaben.selectAll("text").style("font-weight", "bolder")
                        eigentumsangabendetail.transition().duration(800).attr("transform", "scale(1,1)").style("opacity", 1)
                        markierungendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 1)
                        marginaliendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 1)

                      }
                      else {
                        filter = null
                        eigentumsangabenEntfaltet = false

                        farbeinfaltungProvenienz()
                        filterInteraction()
                        eigentumsangaben.selectAll(".EigentumsangabenPlus").text(" ⊕")
                        eigentumsangaben.selectAll("text").style("font-weight", "500")
                        eigentumsangabendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 0)
                        }

                    })

                eigentumsangaben.select("text").append("tspan")
                    .text(" ⊕")
                    .attr("class", "EigentumsangabenPlus")
                    .style("font-size", 17)
                    .on("click", function() {
                      if (eigentumsangabenEntfaltet == false){
                        eigentumsangabenEntfaltet = true

                        farbausfaltungProvenienz()
                        eigentumsangaben.selectAll(".EigentumsangabenPlus").text(" ⊖")
                        eigentumsangaben.selectAll("text").style("font-weight", "bolder")
                        eigentumsangabendetail.transition().duration(800).attr("transform", "scale(1,1)").style("opacity", 1)
                      }
                      else {
                        eigentumsangabenEntfaltet = false

                        farbeinfaltungProvenienz()
                        eigentumsangaben.selectAll(".EigentumsangabenPlus").text(" ⊕")
                        eigentumsangaben.selectAll("text").style("font-weight", "500")
                        eigentumsangabendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 0)
                        }
                    })



                                var eigentumsangabendetail = eigentumsangaben.append("g").attr("class", "detail").attr("transform", "scale(0,1)").style("opacity", 0)

                                eigentumsangabendetail.append("text")
                                    .text("Provenienz")
                                    .attr("y", 14)
                                    .attr("x", 150)
                                    .attr("class", "provenienz")
                                    .on("click", function(){
                                      if(filter != "provenienz"){
                                        filter = "provenienz"
                                        filterInteraction()
                                      }else{
                                        filter = null
                                        filterInteraction()
                                      }
                                    })


                                eigentumsangabendetail.append("text")
                                    .text("Provenienz-Stempel")
                                    .attr("y", 14)
                                    .attr("x", 240)
                                    .attr("class", "provenienzstempel")
                                    .on("click", function(){
                                      if(filter != "provenienzstempel"){
                                        filter = "provenienzstempel"
                                        filterInteraction()
                                      }else{
                                        filter = null
                                        filterInteraction()
                                      }
                                    })


////////////////Provenienz-Filter Ende
///////////////////////////////////////////////


////////////////Markierung-Filter Start
///////////////////////////////////////////////

            markierungen.select("text").append("tspan")
                .text("Markierungen")
                .attr("class", "MarkierungFilter")
                .on("click", function() {
                  if (filter != "markierungen"){
                    filter = "markierungen"
                    markierungenEntfaltet = true

                    farbausfaltungMarkierung()
                    filterInteraction()
                    eigentumsangaben.selectAll(".EigentumsangabenPlus").text(" ⊕")
                    markierungen.selectAll(".MarkierungenPlus").text(" ⊖")
                    marginalien.selectAll(".MarginalienPlus").text(" ⊕")
                    markierungen.selectAll("text").style("font-weight", "bolder")
                    eigentumsangabendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 1)
                    markierungendetail.transition().duration(800).attr("transform", "scale(1,1)").style("opacity", 1)
                    marginaliendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 1)


                  }
                  else {
                    filter = null
                    markierungenEntfaltet = false

                    farbeinfaltungMarkierung()
                    filterInteraction()
                    markierungen.selectAll(".MarkierungenPlus").text(" ⊕")
                    markierungen.selectAll("text").style("font-weight", "500")
                    markierungendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 0)
                    }
                })




            markierungen.select("text").append("tspan")
                .text(" ⊕")
                .attr("class", "MarkierungenPlus")
                .style("font-size", 17)
                .on("click", function() {
                  if (markierungenEntfaltet == false){
                    markierungenEntfaltet = true

                    farbausfaltungMarkierung()
                    markierungen.selectAll(".MarkierungenPlus").text(" ⊖")
                    markierungen.selectAll("text").style("font-weight", "bolder")
                    markierungendetail.transition().duration(800).attr("transform", "scale(1,1)").style("opacity", 1)
                  }
                  else {
                  markierungenEntfaltet = false

                    farbeinfaltungMarkierung()
                    markierungen.selectAll(".MarkierungenPlus").text(" ⊕")
                    markierungen.selectAll("text").style("font-weight", "500")
                    markierungendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 0)
                    }
                })

            var markierungendetail = markierungen.append("g").attr("class", "detail").attr("transform", "scale(0,1)").style("opacity", 0)

            markierungendetail.append("text")
                .text("Anstreichung")
                .attr("y", 28)
                .attr("x", 120)
                .attr("class", "anstreichung")
                .on("click", function(){
                  if(filter != "anstreichung"){
                    filter = "anstreichung"
                    filterInteraction()
                  }else{
                    filter = null
                    filterInteraction()
                  }
                })

            markierungendetail.append("text")
                .text("Unterstreichung")
                .attr("y", 28)
                .attr("x", 230)
                .attr("class", "unterstreichung")
                .on("click", function(){
                  if(filter != "unterstreichung"){
                    filter = "unterstreichung"
                    filterInteraction()
                  }else{
                    filter = null
                    filterInteraction()
                  }
                })

            markierungendetail.append("text")
                .text("Durchstreichung")
                .attr("y", 28)
                .attr("x", 360)
                .attr("class", "durchstreichung")
                .on("click", function(){
                  if(filter != "durchstreichung"){
                    filter = "durchstreichung"
                    filterInteraction()
                  }else{
                    filter = null
                    filterInteraction()
                  }
                })

            markierungendetail.append("text")
                .text("Sonstige Markierung")
                .attr("y", 28)
                .attr("x", 490)
                .attr("class", "sonstigeMarkierung")
                .on("click", function(){
                  if(filter != "sonstigeMarkierung"){
                    filter = "sonstigeMarkierung"
                    filterInteraction()
                  }else{
                    filter = null
                    filterInteraction()
                  }
                })

            markierungendetail.append("text")
                .text("Anderes")
                .attr("y", 28)
                .attr("x", 640)
                .attr("class", "anderes")
                .on("click", function(){
                  if(filter != "anderes"){
                    filter = "anderes"
                    filterInteraction()
                  }else{
                    filter = null
                    filterInteraction()
                  }
                })



                ////////////////Markierung-Filter Ende
                ///////////////////////////////////////////////

                ////////////////Marginalien-Filter Start
                ///////////////////////////////////////////////

                            marginalien.select("text").append("tspan")
                                .text("Marginalien")
                                .attr("class", "MarginalienFilter")
                                .on("click", function() {
                                  if (filter != "marginalien"){
                                    filter = "marginalien"
                                    marginalienEntfaltet = true

                                    farbausfaltungMarginalien()
                                    filterInteraction()
                                    marginalien.selectAll(".MarginalienPlus").text(" ⊖")
                                    marginalien.selectAll("text").style("font-weight", "bolder")
                                    marginaliendetail.transition().duration(800).attr("transform", "scale(1,1)").style("opacity", 1)

                                    eigentumsangaben.selectAll(".EigentumsangabenPlus").text(" ⊕")
                                    markierungen.selectAll(".MarkierungenPlus").text(" ⊕")
                                    marginalien.selectAll(".MarginalienPlus").text(" ⊖")
                                    marginalien.selectAll("text").style("font-weight", "bolder")
                                    eigentumsangabendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 1)
                                    markierungendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 1)
                                    marginaliendetail.transition().duration(800).attr("transform", "scale(1,1)").style("opacity", 1)


                                  }
                                  else {
                                    filter = null
                                    marginalienEntfaltet = false

                                    farbeinfaltungMarginalien()
                                    filterInteraction()
                                    marginalien.selectAll(".MarginalienPlus").text(" ⊕")
                                    marginalien.selectAll("text").style("font-weight", "500")
                                    marginaliendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 0)
                                    }
                                })


                            marginalien.select("text").append("tspan")
                                .attr("class", "MarginalienPlus")
                                .text(" ⊕")
                                .style("font-size", 17)
                                .on("click", function() {
                                  if (marginalienEntfaltet == false){
                                    marginalienEntfaltet = true

                                    farbausfaltungMarginalien()
                                    marginalien.selectAll(".MarginalienPlus").text(" ⊖")
                                    marginalien.selectAll("text").style("font-weight", "bolder")
                                    marginaliendetail.transition().duration(800).attr("transform", "scale(1,1)").style("opacity", 1)
                                  }
                                  else {
                                    marginalienEntfaltet = false

                                    farbeinfaltungMarginalien()
                                    marginalien.selectAll(".MarginalienPlus").text(" ⊕")
                                    marginalien.selectAll("text").style("font-weight", "500")
                                    marginaliendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 0)
                                    }
                                })

            var marginaliendetail = marginalien.append("g").attr("class", "detail").attr("transform", "scale(0,1)").style("opacity", 0)

            marginaliendetail.append("text")
                .text("Bewertung")
                .attr("y", 42)
                .attr("x", 110)
                .attr("class", "bewertung")
                .on("click", function(){
                  if(filter != "bewertung"){
                    filter = "bewertung"
                    filterInteraction()
                  }else{
                    filter = null
                    filterInteraction()
                  }
                })

            marginaliendetail.append("text")
                .text("Kommentar")
                .attr("y", 42)
                .attr("x", 200)
                .attr("class", "kommentar")
                .on("click", function(){
                  if(filter != "kommentar"){
                    filter = "kommentar"
                    filterInteraction()
                  }else{
                    filter = null
                    filterInteraction()
                  }
                })

            marginaliendetail.append("text")
                .text("Textkorrektur")
                .attr("y", 42)
                .attr("x", 300)
                .attr("class", "textkorrektur")
                .on("click", function(){
                  if(filter != "textkorrektur"){
                    filter = "textkorrektur"
                    filterInteraction()
                  }else{
                    filter = null
                    filterInteraction()
                  }
                })

            marginaliendetail.append("text")
                .text("Variante")
                .attr("y", 42)
                .attr("x", 420)
                .attr("class", "variante")
                .on("click", function(){
                  if(filter != "variante"){
                    filter = "variante"
                    filterInteraction()
                  }else{
                    filter = null
                    filterInteraction()
                  }
                })

            marginaliendetail.append("text")
                .text("Übersetzung")
                .attr("y", 42)
                .attr("x", 500)
                .attr("class", "uebersetzung")
                .on("click", function(){
                  if(filter != "uebersetzung"){
                    filter = "uebersetzung"
                    filterInteraction()
                  }else{
                    filter = null
                    filterInteraction()
                  }
                })

                ////////////////Marginalien-Filter Ende
                ///////////////////////////////////////////////

            zusatzMaterial.append("text")
                .text("Zusätzliches Material")
                .attr("y", 56)
                .on("click", function(){
                  if(filter != "zusatzMaterial"){
                    filter = "zusatzMaterial"
                    filterInteraction()
                  }else{
                    filter = null
                    filterInteraction()
                  }
                })




            ////////////////////////////////////////////////////////////
            ////////////////////////////////////////////////////////////
            //////////////////////////////////////////////////////////////





            var marginleft = 5
            var marginright = 30

            var xOffset = 2

            var posY = 120
            var posYCanvas = 0

            var BuchAnzahl = datenByTitle.length
            var authorAnzahl = datenByAuthor.filter(function(d, i) {
                return d.values[0].values[0].AuthorCount > 1
            }).length + 1

            //console.log(authorAnzahl)

            var chartArea = width - marginleft - marginright
            var areaheight = (window.innerHeight - 280)
            ///Buch-Ebene Größen und Abstände

            var pageheight = areaheight/1111
            var buchBreite = 8
            var buchBgBreite = 2 + buchBreite
            var totalBuchWidth = buchBgBreite * BuchAnzahl
            var authorAbstand = ((chartArea - totalBuchWidth) + (buchBgBreite * authorAnzahl)) / authorAnzahl

            ///Author-Ebene Größen und Abstände
            var authorLevelAbstand = 15

            ///Seiten-Ebene Größen und Abstände
            var sLBuchAbstand = chartArea / authorAnzahl
            var sLAuthorAbstand = 120 //???
            //var sLAuthorAbstand2 = 30
            var sLBuchAbstandSelected = 35 //55
            var sLBuchBreiteSelected = 30
            var sLSeitenAbstandSelected = 0 //sLBuchBreiteSelected+0.5

            var sLBuchAbstandUnselected = 4
            var sLBuchBreiteUnselected = 3
            var thisVerfasserSelectedBookCount = datenByAuthor.filter(function(d, i) {
                return d.key == "Fontane, Theodor"
            })[0].values.length
            var sLTotalBuchWidthSelected = thisVerfasserSelectedBookCount * sLBuchAbstandSelected
            var sLTotalBuchWidthUnselected = (BuchAnzahl - thisVerfasserSelectedBookCount) * sLBuchAbstandUnselected
            var sLAuthorAbstand2 = (chartArea - (sLTotalBuchWidthSelected + sLTotalBuchWidthUnselected)) / authorAnzahl


      //      console.log(datenByAuthor)

            datenByAuthor.forEach(function(D, I) {
                D.Abschnitte = []
                //	D.Abschnitte2 = []
                //	D.Abschnitte2.push({Provenienz:[0,0,0,0,0,0,0,0,0,0], Stempel:[], Anstreichung:[], Unterstreichung:[], Durchstreichung:[], SonstigeMarkierung:[], ZusatzMaterial:[],Bewertung:[],Kommentar:[],Textkorrektur:[],Variante:[],Uebersetzung:[],Anderes:[],Leer:[]})
                D.Abschnitte.push({
                    part: 0,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 1,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 2,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 3,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 4,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 5,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 6,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 7,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 8,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 9,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 10,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 11,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 12,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 13,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 14,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 15,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 16,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 17,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 18,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 19,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 20,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 21,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })



                D.values.forEach(function(E, G) {
                    E.values.forEach(function(F, C) {
                        if (F.Part / F.maxPart <= 0.05) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[1].Provenienz++
                                //			D.Abschnitte2[0].Provenienz[0]++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[1].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[1].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[1].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[1].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[1].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[1].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[1].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[1].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[1].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[1].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[1].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[1].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[1].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.05 && F.Part / F.maxPart <= 0.1) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[2].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[2].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[2].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[2].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[2].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[2].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[2].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[2].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[2].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[2].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[2].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[2].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[2].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[2].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.1 && F.Part / F.maxPart <= 0.15) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[3].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[3].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[3].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[3].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[3].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[3].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[3].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[3].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[3].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[3].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[3].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[3].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[3].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[3].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.15 && F.Part / F.maxPart <= 0.2) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[4].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[4].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[4].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[4].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[4].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[4].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[4].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[4].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[4].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[4].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[4].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[4].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[4].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[4].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.2 && F.Part / F.maxPart <= 0.25) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[5].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[5].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[5].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[5].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[5].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[5].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[5].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[5].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[5].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[5].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[5].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[5].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[5].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[5].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.25 && F.Part / F.maxPart <= 0.3) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[6].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[6].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[6].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[6].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[6].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[6].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[6].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[6].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[6].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[6].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[6].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[6].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[6].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[6].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.3 && F.Part / F.maxPart <= 0.35) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[7].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[7].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[7].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[7].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[7].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[7].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[7].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[7].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[7].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[7].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[7].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[7].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[7].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[7].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.35 && F.Part / F.maxPart <= 0.4) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[8].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[8].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[8].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[8].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[8].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[8].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[8].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[8].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[8].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[8].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[8].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[8].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[8].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[8].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.4 && F.Part / F.maxPart <= 0.45) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[9].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[9].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[9].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[9].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[9].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[9].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[9].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[9].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[9].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[9].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[9].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[9].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[9].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[9].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.45 && F.Part / F.maxPart <= 0.5) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[10].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[10].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[10].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[10].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[10].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[10].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[10].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[10].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[10].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[10].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[10].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[10].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[10].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[10].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.5 && F.Part / F.maxPart <= 0.55) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[11].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[11].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[11].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[11].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[11].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[11].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[11].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[11].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[11].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[11].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[11].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[11].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[11].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[11].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.55 && F.Part / F.maxPart <= 0.6) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[12].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[12].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[12].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[12].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[12].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[12].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[12].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[12].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[12].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[12].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[12].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[12].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[12].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[12].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.5 && F.Part / F.maxPart <= 0.65) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[13].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[13].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[13].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[13].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[13].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[13].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[13].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[13].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[13].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[13].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[13].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[13].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[13].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[13].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.65 && F.Part / F.maxPart <= 0.7) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[14].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[14].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[14].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[14].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[14].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[14].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[14].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[14].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[14].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[14].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[14].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[14].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[14].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[14].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.7 && F.Part / F.maxPart <= 0.75) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[15].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[15].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[15].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[15].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[15].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[15].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[15].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[15].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[15].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[15].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[15].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[15].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[15].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[15].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.75 && F.Part / F.maxPart <= 0.8) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[16].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[16].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[16].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[16].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[16].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[16].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[16].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[16].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[16].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[16].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[16].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[16].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[16].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[16].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.8 && F.Part / F.maxPart <= 0.85) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[17].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[17].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[17].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[17].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[17].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[17].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[17].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[17].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[17].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[17].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[17].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[17].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[17].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[17].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.85 && F.Part / F.maxPart <= 0.9) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[18].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[18].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[18].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[18].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[18].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[18].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[18].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[18].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[18].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[18].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[18].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[18].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[18].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[18].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.9 && F.Part / F.maxPart <= 0.95) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[19].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[19].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[19].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[19].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[19].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[19].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[19].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[19].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[19].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[19].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[19].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[19].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[19].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[19].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.95 && F.Part / F.maxPart <= 1) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[20].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[20].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[20].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[20].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[20].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[20].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[20].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[20].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[20].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[20].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[20].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[20].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[20].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[20].Leer++
                            }
                        }




                    })

                })





                D.Abschnitte.forEach(function(E, F) {
                    E.ProvenienzNorm = E.Provenienz / E.BuchAnzahlAutor
                    E.StempelNorm = E.Stempel / E.BuchAnzahlAutor
                    E.AnstreichungNorm = E.Anstreichung / E.BuchAnzahlAutor
                    E.UnterstreichungNorm = E.Unterstreichung / E.BuchAnzahlAutor
                    E.DurchstreichungNorm = E.Durchstreichung / E.BuchAnzahlAutor
                    E.SonstigeMarkierungNorm = E.SonstigeMarkierung / E.BuchAnzahlAutor
                    E.ZusatzMaterialNorm = E.ZusatzMaterial / E.BuchAnzahlAutor
                    E.BewertungNorm = E.Bewertung / E.BuchAnzahlAutor
                    E.KommentarNorm = E.Kommentar / E.BuchAnzahlAutor
                    E.TextkorrekturNorm = E.Textkorrektur / E.BuchAnzahlAutor
                    E.VarianteNorm = E.Variante / E.BuchAnzahlAutor
                    E.UebersetzungNorm = E.Uebersetzung / E.BuchAnzahlAutor
                    E.AnderesNorm = E.Anderes / E.BuchAnzahlAutor
                    E.LeerNorm = E.Leer / E.BuchAnzahlAutor

										E.TotalTraces = E.Provenienz + E.Stempel + E.Anstreichung + E.Unterstreichung + E.Durchstreichung + E.SonstigeMarkierung + E.ZusatzMaterial
										+ E.Bewertung + E.Kommentar + E.Textkorrektur + E.Variante + E.Uebersetzung + E.Anderes
										E.TotalTracesNorm = E.TotalTraces / E.BuchAnzahlAutor
                })



            })


            datenByAuthor.forEach(function(D, I) {

            D.maxTraceNumber = d3.max([D.Abschnitte[0].TotalTraces, D.Abschnitte[1].TotalTraces, D.Abschnitte[2].TotalTraces, D.Abschnitte[3].TotalTraces, D.Abschnitte[4].TotalTraces, D.Abschnitte[5].TotalTraces, D.Abschnitte[6].TotalTraces, D.Abschnitte[7].TotalTraces
            , D.Abschnitte[8].TotalTraces, D.Abschnitte[9].TotalTraces, D.Abschnitte[10].TotalTraces, D.Abschnitte[11].TotalTraces, D.Abschnitte[12].TotalTraces, D.Abschnitte[13].TotalTraces, D.Abschnitte[14].TotalTraces
            , D.Abschnitte[15].TotalTraces, D.Abschnitte[16].TotalTraces, D.Abschnitte[17].TotalTraces, D.Abschnitte[18].TotalTraces, D.Abschnitte[19].TotalTraces, D.Abschnitte[20].TotalTraces])

            D.maxTraceNumberNorm = D.maxTraceNumber/D.Abschnitte[0].BuchAnzahlAutor
          //  D.maxTraceNumberNormBefore = datenByAuthor[I-1].maxTraceNumberNorm

            })

            datenByAuthor.forEach(function(D, I) {

            D.maxTraceNumber = d3.max([D.Abschnitte[0].TotalTraces, D.Abschnitte[1].TotalTraces, D.Abschnitte[2].TotalTraces, D.Abschnitte[3].TotalTraces, D.Abschnitte[4].TotalTraces, D.Abschnitte[5].TotalTraces, D.Abschnitte[6].TotalTraces, D.Abschnitte[7].TotalTraces
            , D.Abschnitte[8].TotalTraces, D.Abschnitte[9].TotalTraces, D.Abschnitte[10].TotalTraces, D.Abschnitte[11].TotalTraces, D.Abschnitte[12].TotalTraces, D.Abschnitte[13].TotalTraces, D.Abschnitte[14].TotalTraces
            , D.Abschnitte[15].TotalTraces, D.Abschnitte[16].TotalTraces, D.Abschnitte[17].TotalTraces, D.Abschnitte[18].TotalTraces, D.Abschnitte[19].TotalTraces, D.Abschnitte[20].TotalTraces])

            D.maxTraceNumberNorm = D.maxTraceNumber/D.Abschnitte[0].BuchAnzahlAutor
            if (I>0){
              D.maxTraceNumberNormBefore = datenByAuthor[I-1].maxTraceNumberNorm
}
            })


            var posx = 0
            var posx2 = 0

            var bookFingerprint = dataContainer.selectAll(".bookFingerprint")
                .data(datenByTitle)
                .enter()
                .append("g")
                .attr("class", "bookFingerprint")
                .attr("transform", function(d, i) {
                    if (i == 0) {
                        posx = 0
                        return "translate(" + (marginleft + (posx)) + "," + (posYCanvas) + ")"
                    } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser && d.values[0].AuthorCount > 1) {
                        posx = posx + authorAbstand
                        return "translate(" + (marginleft + (posx)) + "," + (posYCanvas) + ")"
                    } else {
                        posx = posx + buchBgBreite
                        return "translate(" + (marginleft + (posx)) + "," + (posYCanvas) + ")"
                    }
                })



            var bookG = svg.selectAll(".bookBG")
                .data(datenByTitle)
                .enter()
                .append("g")
                .attr("transform", function(d, i) {
                    if (i == 0) {
                        posx = 0
                        return "translate(" + (marginleft - ((buchBgBreite - buchBreite) / 2) + (posx)) + "," + (posY) + ")"
                    } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser && d.values[0].AuthorCount > 1) {
                        posx = posx + authorAbstand
                        return "translate(" + (marginleft - ((buchBgBreite - buchBreite) / 2) + (posx)) + "," + (posY) + ")"
                    } else {
                        posx = posx + buchBgBreite
                        return "translate(" + (marginleft - ((buchBgBreite - buchBreite) / 2) + (posx)) + "," + (posY) + ")"
                    }
                })
                .attr("class", "bookBG")

            var bookGFront = svgFront.selectAll(".bookBG")
                .data(datenByTitle)
                .enter()
                .append("g")
                .attr("transform", function(d, i) {
                    if (i == 0) {
                        posx = 0
                        return "translate(" + (marginleft - ((buchBgBreite - buchBreite) / 2) + (posx)) + "," + (posY) + ")"
                    } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser && d.values[0].AuthorCount > 1) {
                        posx = posx + authorAbstand
                        return "translate(" + (marginleft - ((buchBgBreite - buchBreite) / 2) + (posx)) + "," + (posY) + ")"
                    } else {
                        posx = posx + buchBgBreite
                        return "translate(" + (marginleft - ((buchBgBreite - buchBreite) / 2) + (posx)) + "," + (posY) + ")"
                    }
                })
                .attr("class", "bookBG")

            var bookTitleFront =  svgFrontTitles.selectAll(".bookTitleFrontG")
                .data(datenByTitle)
                .enter()
                .append("g")
                .attr("transform", function(d, i) {
                    if (i == 0) {
                        posx = 0
                        return "translate(" + (marginleft+buchBreite + (posx)) + "," + (posY) + ")"
                    } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser && d.values[0].AuthorCount > 1) {
                        posx = posx + authorAbstand
                        return "translate(" + (marginleft+buchBreite + (posx)) + "," + (posY) + ")"
                    } else {
                        posx = posx + buchBgBreite
                        return "translate(" + (marginleft+buchBreite + (posx)) + "," + (posY) + ")"
                    }
                })
                .attr("class", "bookTitleFrontG")
                .style("display", "none")


                bookTitleFront.append("rect")
                .attr("height", 1500)
                .attr("width", 20)
                .attr("fill", "#474747")
                .attr("class", "BuchTitelRect")

                bookTitleFront.append("text").attr("x", -2).attr("y", 10).style("text-anchor", "end")
                .text(function(d) {
                    if (d.values[0].BuchTitel.length > 80) {
                        return (d.values[0].BuchTitel).substring(0, 80) + " [...]"
                    } else {
                        return d.values[0].BuchTitel
                    }
                })
                .attr("fill", "white")
                .attr("class", "BuchTitelLabel")
                .attr("transform", "rotate(-90)")


            var authorGroup = bookG
                .filter(function(d, i) {
                    return i == 0 || d.values[0].Verfasser != datenByTitle[i - 1].values[0].Verfasser
                }).filter(function(d, i) {
                    return d.values[0].AuthorCount != 1 || d.values[0].Verfasser == "[Black, Adam u. Charles]"
                })
                .append("g").attr("class", function(d) {
                    return d.values[0].Verfasser
                }).attr("transform", "translate(0,0)")
            var authorLabel = bookG
                .filter(function(d, i) {
                    return i == 0 || d.values[0].Verfasser != datenByTitle[i - 1].values[0].Verfasser
                }).filter(function(d, i) {
                    return d.values[0].AuthorCount != 1 || d.values[0].Verfasser == "[Black, Adam u. Charles]"
                })
                //|| d.values[0].AuthorCount == 1 && datenByTitle[i-1].authorCount != 1}
                .append("g").attr("transform", "translate(4,-3)rotate(-45)")
            var layerGroups = bookGFront
                .filter(function(d, i) {
                    return i == 0 || d.values[0].Verfasser != datenByTitle[i - 1].values[0].Verfasser
                }).filter(function(d, i) {
                    return d.values[0].AuthorCount != 1 || d.values[0].Verfasser == "[Black, Adam u. Charles]"
                })
                .append("g").attr("transform", "translate(0,0)rotate(0)")

            //console.log(authorGroup)
            //console.log(datenByTitle)

            authorGroup.append("rect")
                //.attr("class", function(d,i){console.log(datenByAuthor[i])})
                .attr("width", function(d, i) {
                    return buchBgBreite * (datenByAuthor[i].values.length)
                })
                .attr("height", 6000)
                .attr("fill", "#cec1b8")
                .attr("opacity", 0)






            var stack = d3.stack()
                .keys(["AnstreichungNorm", "UnterstreichungNorm", "DurchstreichungNorm", "SonstigeMarkierungNorm", "AnderesNorm", "BewertungNorm", "KommentarNorm", "TextkorrekturNorm", "UebersetzungNorm", "VarianteNorm", "ZusatzMaterialNorm", "ProvenienzNorm", "StempelNorm"])
                .order(d3.stackOrderNone)
                .offset(d3.stackOffsetNone);



            var xAreaMax = 4
            var totalAreaChartsWidth = 0
            datenByAuthor.forEach(function(D, I) {
              totalAreaChartsWidth= totalAreaChartsWidth + xAreaMax*D.maxTraceNumberNorm
            })
            authorLevelAbstand = (chartArea - totalAreaChartsWidth)/authorAnzahl



            var yArea = d3.scaleLinear()
                .range([0, (areaheight / 21)]);

            var xArea = d3.scaleLinear()
                .range([0, xAreaMax]);




            var area = d3.area()
                .y(function(d, i) {
                    return yArea(d.data.part)
                })
                .x0(function(d) {
                  var areaChartXPos = 50//Number(dataContainer.selectAll(".bookFingerprint").filter(function(D){return D.values[0].Verfasser == d.data.Verfasser || D.values[0].Verfasser == "[Black, Adam u. Charles]"}).attr("transform").replace("translate(", "").split(',')[0])
                    return xArea(d[0]);
                })
                .x1(function(d) {
                  var areaChartXPos = 50//Number(dataContainer.selectAll(".bookFingerprint").filter(function(D){return D.values[0].Verfasser == d.data.Verfasser || D.values[0].Verfasser == "[Black, Adam u. Charles]"}).attr("transform").replace("translate(", "").split(',')[0])

                    return xArea(d[1]);
                })
                .curve(d3.curveBasis)
              //  .context(context);

           var areachartGroup = layerGroups.append("g").attr("class", "areachartGroup")
          //var areachartGroup = dataContainer.append("g").attr("class", "areachartGroup")

            var areachart = areachartGroup.selectAll(".areachartlayer")
                .data(function(D, I) {
                    return (stack(datenByAuthor[I].Abschnitte).filter(function(d) {
                        return d
                    }))
                })
                .enter().append("g")
                .attr("class", "areachartlayer")
                .attr("display", "none")

//            console.log(d3.max(datenByAuthor[1].Abschnitte[1].TotalTraces))
			//			console.log(d3.max([(datenByAuthor[1].Abschnitte[0].TotalTracesNorm),(datenByAuthor[1].Abschnitte[1].TotalTracesNorm),(datenByAuthor[1].Abschnitte[2].TotalTracesNorm)
	// 				,(datenByAuthor[1].Abschnitte[3].TotalTracesNorm),(datenByAuthor[1].Abschnitte[4].TotalTracesNorm),(datenByAuthor[1].Abschnitte[5].TotalTracesNorm),(datenByAuthor[1].Abschnitte[6].TotalTracesNorm)
	// 			,(datenByAuthor[1].Abschnitte[7].TotalTracesNorm),(datenByAuthor[1].Abschnitte[8].TotalTracesNorm),(datenByAuthor[1].Abschnitte[9].TotalTracesNorm),(datenByAuthor[1].Abschnitte[10].TotalTracesNorm)
	// 		,(datenByAuthor[1].Abschnitte[11].TotalTracesNorm),(datenByAuthor[1].Abschnitte[12].TotalTracesNorm),(datenByAuthor[1].Abschnitte[13].TotalTracesNorm),(datenByAuthor[1].Abschnitte[14].TotalTracesNorm)
	// 	,(datenByAuthor[1].Abschnitte[15].TotalTracesNorm),(datenByAuthor[1].Abschnitte[16].TotalTracesNorm),(datenByAuthor[1].Abschnitte[17].TotalTracesNorm),(datenByAuthor[1].Abschnitte[18].TotalTracesNorm)
	// ,(datenByAuthor[1].Abschnitte[19].TotalTracesNorm),(datenByAuthor[1].Abschnitte[20].TotalTracesNorm)]))

            areachartGroup.append("line")
                .attr("x1", 0)
                .attr("x2", 0)
                .attr("y1", 0)
                .attr("y2", areaheight)
                .attr("stroke-width", 0.5)
                .attr("stroke", "black")
                .style("opacity", 1)
                .attr("stroke-dasharray", 2, 0.5)
                .attr("display", "none")


            areachart.append("path")
              //  .attr("id", console.log(area))
                .attr("d", area)
                .attr("class", function(d, i) {
                    if (d.key == "AnstreichungNorm") {
                        return "anstreichung eingefaltet"
                    } else if (d.key == "UnterstreichungNorm") {
                        return "unterstreichung eingefaltet"
                    } else if (d.key == "ProvenienzNorm") {
                        return "provenienz eingefaltet"
                    } else if (d.key == "StempelNorm") {
                        return "provenienzstempel eingefaltet"
                    } else if (d.key == "DurchstreichungNorm") {
                        return "durchstreichung eingefaltet"
                    } else if (d.key == "ZusatzMaterialNorm") {
                        return "zusatzMaterial"
                    } else if (d.key == "SonstigeMarkierungNorm") {
                        return "sonstigeMarkierung eingefaltet"
                    } else if (d.key == "AnderesNorm") {
                        return "anderes eingefaltet"
                    } else if (d.key == "BewertungNorm") {
                        return "bewertung eingefaltet"
                    } else if (d.key == "KommentarNorm") {
                        return "kommentar eingefaltet"
                    } else if (d.key == "TextkorrekturNorm") {
                        return "textkorrektur eingefaltet"
                    } else if (d.key == "UebersetzungNorm") {
                        return "uebersetzung eingefaltet"
                    } else if (d.key == "VarianteNorm") {
                        return "variante eingefaltet"
                    }
                })



            //console.log(datenByAuthor)


            authorLabel.append("text")
                .attr("class", "authorLabel")
                .attr("fill", "black")
                .text(function(d) {
                    if (d.values[0].Verfasser == "[Black, Adam u. Charles]") {
                        return "Sonstige"
                    } else {
                        return d.values[0].Verfasser
                    }
                })
                .style("font-size", function(d, i) {
                    if (d.values[0].Verfasser == "[ohne Angabe]") {
                        return 10
                    } else {
                        var fontSizeScale = d3.scaleLinear()
                            .domain([1, 28])
                            .range([10, 15])
                            .clamp(true)

                        return fontSizeScale(d.values[0].AuthorCount)
                    }
                })




            /////Titel und hover
            bookG
                //.attr("transform", "translate(" + (posX-1) + "," + (posY) + ")")
                .append("rect")
                .attr("cursor", function() {
                    if (scrollTop > -5) {
                        return "pointer"
                    } else {
                        return "not-allowed"
                    }
                })
                .attr("opacity", 0)
                .attr("width", buchBgBreite)
                .attr("height", "7500")
                .attr("class", "bookBG")
                .attr("fill", "#cec1b8")
                .on("mouseover", function(d) {
                    if (scrollTop > -800 && scrollTop < 1200) {
                        thisVerfasserSelected = d3.select(this).datum().values[0].Verfasser

                        //	console.log(thisVerfasserSelected)
                    }
                })
                .on("mousemove", function(d) {

                    if (scrollTop > -800) {
                        if (scrollTop > -800 && scrollTop < 1200) {
                            thisVerfasserSelected = d3.select(this).datum().values[0].Verfasser
                            //	console.log(thisVerfasser)

                        }
                        var currentScrollTop = Math.max(window.pageYOffset, document.documentElement.scrollTop, document.body.scrollTop)
                    //    console.log(currentScrollTop)
                    //    console.log(d3.event.layerY || d3.event.offsety)
                    //    console.log(d3.event.offsety)
                        console.log(d3.event.layerY )
                        console.log(d3.event.pageY)
                    //    var mouseY = ((d3.event.layerY || d3.event.offsety) - currentScrollTop-120);
                        var mouseY = ((d3.event.pageY) - currentScrollTop-240);
                    //    console.log(mouseY)
                        //console.log(mouseY/pageheight)
                        //console.log(d.values)
                        var thisPage = Math.round(round45(mouseY) / pageheight) + 1
                        console.log(thisPage)
                        function round45(x) {
                            return Math.ceil(x / pageheight) * pageheight
                        }
                        //console.log(d.values.filter(function(D,I){return D.Part == 3}))
                        thisVerfasser = d3.select(this).datum().values[0].Verfasser
                        var thisBookID = d3.select(this).datum().values[0].BookID



                        //tooltip.select("p").text(thisPageID)
                        if (d.values[0].maxPart < thisPage || mouseY < 0) {
                            d3.select('.tooltip')
                                .style("display", "none")
                                .style('top', d3.event.pageY)
                        } else if (d.values[0].maxPart >= thisPage && mouseY >= 0) {
                            var thisPageID = (d.values.filter(function(d, i) {
                                return d.Part == thisPage
                            }))[0].ID

                            d3.select('.tooltip')
                                .style("display", "block")
                                .style('top', d3.event.pageY - 200 + 'px')
                                .style('left', d3.event.pageX + 25 + 'px')

                            tooltip.select("img").attr("src", function() {
                                return "./img/m/" + thisPageID + ".jpg"
                            })
                        }


                        authorGroup.selectAll("rect").filter(function(d) {
                                return d.values[0].Verfasser == thisVerfasser
                            }).transition().duration(200)
                            .attr("opacity", function() {
                                if (scrollTop < 400) {
                                    return 1
                                } else {
                                    return 0
                                }
                            })

                        authorGroup.selectAll("rect").filter(function(d) {
                                return d.values[0].Verfasser == thisVerfasserSelected
                            }).transition().duration(200)
                            .attr("opacity", function() {
                                if (scrollTop > 400) {
                                    return 0
                                }
                            })

                        svg.selectAll(".authorLabel").filter(function(d) {
                            return d.values[0].Verfasser == thisVerfasserSelected
                        }).style("font-weight", "bold")
                        svg.selectAll(".authorLabel").filter(function(d) {
                            return d.values[0].Verfasser != thisVerfasserSelected
                        }).style("font-weight", "normal")

                        //console.log(d)

                        var thisBookID = d3.select(this).datum().values[0].BookID

                        svgFrontTitles.selectAll(".bookTitleFrontG")
                          .filter(function(d) {
                                return d.values[0].BookID == thisBookID
                            })
                          .style("display", "inline")



                    }
                })
                .on("mouseout", function() {

                  var thisBookID = d3.select(this).datum().values[0].BookID

                  svgFrontTitles.selectAll(".bookTitleFrontG")
                    .filter(function(d) {
                          return d.values[0].BookID == thisBookID
                      })
                    .style("display", "none")


                    authorGroup.selectAll("rect").filter(function(d) {
                        return d.values[0].Verfasser != thisVerfasserSelected
                    }).transition().duration(200).attr("opacity", function() {
                        return 0
                    })
                    svg.selectAll(".authorLabel").filter(function(d) {
                        if (scrollTop > 0) {
                            return d.values[0].Verfasser != thisVerfasserSelected
                        } else {
                            return d
                        }
                    }).style("font-weight", function() {
                        if (scrollTop < 0) {
                            return "normal"
                        }
                    })


                    //	d3.select(this).transition().attr("opacity", 0)

                    d3.select('.tooltip')
                        .style("display", "none")

                })
                .on("click", bookClick)
            //.on("mousemove", bookClick)


            bookFingerprint.append("rect")
                .attr("class", "nodesbg")
                .attr("width", buchBreite)
                .attr("height", function(d) {
                    return (d.values[0].maxPart) * pageheight
                })
                .attr("fill", "white")
                .attr("x", 0)
                .attr("y", posYCanvas)
                .attr("opacity", 1)


            bookFingerprint.selectAll(".nodes")
                .data(function(d) {
                    return d.values.filter(function(d) {
                        return d.Benutzungsspur != "null"
                    })
                })
                //			.data(function(d){return d.values})
                .enter()
                .append("rect")
                .attr("width", buchBreite)
                .attr("height", pageheight)
                .attr("x", 0)
                .attr("y", function(d, i) {
                    return posYCanvas + pageheight * d.Part
                })
                .attr("opacity", 1)
                //	.attr("fill", function(d){return color(d.Benutzungsspur)})
                .attr("fill", function(d) {
                    if (d.Benutzungsspur == "null") {
                        return "white"
                    } else if (d.Benutzungsspur === "1" || d.Benutzungsspur === "1?") {
                        return "#f91b49"
                    } else if (d.Benutzungsspur === "2" || d.Benutzungsspur === "2?") {
                        return "#f91b49"
                    } else if (d.Benutzungsspur === "3" || d.Benutzungsspur === "3?") {
                        return "#f91b49"
                    } else if (d.Benutzungsspur === "4" || d.Benutzungsspur === "4?") {
                        return "#f91b49"
                    } else if (d.Benutzungsspur === "7" || d.Benutzungsspur === "7?") {
                        return "#f91b49"
                    } else if (d.Benutzungsspur === "6" || d.Benutzungsspur === "6?") {
                        return "#e5b404"
                    } else if (d.SchriftspurTyp == "P" && d.Schreibmedium != "Stempel") {
                        return "#1c1c1c"
                    } else if (d.SchriftspurTyp == "P" && d.Schreibmedium == "Stempel") {
                        return "#1c1c1c"
                    } else if (d.SchriftspurTyp == "B") {
                        return "#4D8DFF"
                    } else if (d.SchriftspurTyp == "K") {
                        return "#4D8DFF"
                    } else if (d.SchriftspurTyp == "T") {
                        return "#4D8DFF"
                    } else if (d.SchriftspurTyp == "U") {
                        return "#4D8DFF"
                    } else if (d.SchriftspurTyp == "V") {
                        return "#4D8DFF"
                    }
                })
                // .attr("fill", function(d){
                // 	if (d.Benutzungsspur == "null"){return "white"}
                // 	else if (d.Benutzungsspur === "1" || d.Benutzungsspur === "1?"){return "#FF5D62"}
                // 	else if (d.Benutzungsspur === "2" || d.Benutzungsspur === "2?"){return "#ff7d5d"}
                // 	else if (d.Benutzungsspur === "3" || d.Benutzungsspur === "3?"){return "#8D084E"}
                // 	else if (d.Benutzungsspur === "4" || d.Benutzungsspur === "4?"){return "#FD9698"}
                // 	else if (d.Benutzungsspur === "7" || d.Benutzungsspur === "7?"){return "#ff206a"}
                //
                // 	else if (d.Benutzungsspur === "6" || d.Benutzungsspur === "6?"){return "#e3c460"}
                //
                //
                // 	else if (d.SchriftspurTyp == "P" && d.Schreibmedium != "Stempel") {return "#575757"}
                // 	else if (d.SchriftspurTyp == "P" && d.Schreibmedium == "Stempel") {return "#828282"}
                //
                // 	else if (d.SchriftspurTyp == "B") {return "#95B739"}
                // 	else if (d.SchriftspurTyp == "K") {return "#075011"}
                // 	else if (d.SchriftspurTyp == "T") {return "#00D18D"}
                // 	else if (d.SchriftspurTyp == "U") {return "#017554"}
                // 	else if (d.SchriftspurTyp == "V") {return "#519E15"}
                // 	})
                .attr("class", function(d) {
                    if (d.Benutzungsspur == "null") {
                        return "leer"
                    } else if (d.Benutzungsspur === "1" || d.Benutzungsspur === "1?") {
                        return "anstreichung"
                    } else if (d.Benutzungsspur === "2" || d.Benutzungsspur === "2?") {
                        return "unterstreichung"
                    } else if (d.Benutzungsspur === "3" || d.Benutzungsspur === "3?") {
                        return "durchstreichung"
                    } else if (d.Benutzungsspur === "4" || d.Benutzungsspur === "4?") {
                        return "sonstigeMarkierung"
                    } else if (d.Benutzungsspur === "7" || d.Benutzungsspur === "7?") {
                        return "anderes"
                    } else if (d.Benutzungsspur === "6" || d.Benutzungsspur === "6?") {
                        return "zusatzMaterial"
                    } else if (d.SchriftspurTyp == "P" && d.Schreibmedium != "Stempel") {
                        return "provenienz"
                    } else if (d.SchriftspurTyp == "P" && d.Schreibmedium == "Stempel") {
                        return "provenienzstempel"
                    } else if (d.SchriftspurTyp == "B") {
                        return "bewertung"
                    } else if (d.SchriftspurTyp == "K") {
                        return "kommentar"
                    } else if (d.SchriftspurTyp == "T") {
                        return "textkorrektur"
                    } else if (d.SchriftspurTyp == "U") {
                        return "uebersetzung"
                    } else if (d.SchriftspurTyp == "V") {
                        return "variante"
                    }
                })
                .classed("nodes", true)

            //})

            function farbausfaltungProvenienz() {
                transitions = true

                setTimeout(function() {
                    transitions = false
                }, 1000);

                areachart.selectAll(".provenienz,.provenienzstempel").classed("eingefaltet", false)

                dataContainer.selectAll(".nodes").filter(".provenienz,.provenienzstempel").transition().duration(800)
                    .attr("fill", function(d) {
                        if (d.SchriftspurTyp == "P" && d.Schreibmedium != "Stempel") {
                            return "#575757"
                        } else if (d.SchriftspurTyp == "P" && d.Schreibmedium == "Stempel") {
                            return "#828282"
                        }
                    })
}

function farbeinfaltungProvenienz() {
    transitions = true

    setTimeout(function() {
        transitions = false
    }, 1000);

    areachart.selectAll(".provenienz,.provenienzstempel").classed("eingefaltet", true)

    dataContainer.selectAll(".nodes").filter(".provenienz,.provenienzstempel").transition().duration(800)
        .attr("fill", function(d) {
            if (d.SchriftspurTyp == "P" && d.Schreibmedium != "Stempel") {
                return "#1c1c1c"
            } else if (d.SchriftspurTyp == "P" && d.Schreibmedium == "Stempel") {
                return "#1c1c1c"
            }
        })
}



            function farbausfaltungMarkierung() {
                transitions = true

                setTimeout(function() {
                    transitions = false
                }, 1000);

                areachart.selectAll(".unterstreichung,.anstreichung,.durchstreichung,.sonstigeMarkierung,.anderes").classed("eingefaltet", false)

                dataContainer.selectAll(".nodes").filter(".unterstreichung,.anstreichung,.durchstreichung,.sonstigeMarkierung,.anderes").transition().duration(800)
                    .attr("fill", function(d) {
                        if (d.Benutzungsspur === "1" || d.Benutzungsspur === "1?") {
                            return "#F74141"
                        } else if (d.Benutzungsspur === "2" || d.Benutzungsspur === "2?") {
                            return "#FF8A5D"
                        } else if (d.Benutzungsspur === "3" || d.Benutzungsspur === "3?") {
                            return "#8D084E"
                        } else if (d.Benutzungsspur === "4" || d.Benutzungsspur === "4?") {
                            return "#FD9698"
                        } else if (d.Benutzungsspur === "7" || d.Benutzungsspur === "7?") {
                            return "#ff206a"
                        }
                    })
            }

            function farbeinfaltungMarkierung() {
                transitions = true

                setTimeout(function() {
                    transitions = false
                }, 1000);

                areachart.selectAll(".unterstreichung,.anstreichung,.durchstreichung,.sonstigeMarkierung,.anderes").classed("eingefaltet", true)

                dataContainer.selectAll(".nodes").filter(".unterstreichung,.anstreichung,.durchstreichung,.sonstigeMarkierung,.anderes").transition().duration(800)
                    .attr("fill", function(d) {
                        if (d.Benutzungsspur === "1" || d.Benutzungsspur === "1?") {
                            return "#f91b49"
                        } else if (d.Benutzungsspur === "2" || d.Benutzungsspur === "2?") {
                            return "#f91b49"
                        } else if (d.Benutzungsspur === "3" || d.Benutzungsspur === "3?") {
                            return "#f91b49"
                        } else if (d.Benutzungsspur === "4" || d.Benutzungsspur === "4?") {
                            return "#f91b49"
                        } else if (d.Benutzungsspur === "7" || d.Benutzungsspur === "7?") {
                            return "#f91b49"
                        }
                    })
            }



            function farbausfaltungMarginalien() {
                transitions = true

                setTimeout(function() {
                    transitions = false
                }, 1000);

                areachart.selectAll(".bewertung,.kommentar,.textkorrektur,.uebersetzung,.variante").classed("eingefaltet", false)

                dataContainer.selectAll(".nodes").filter(".bewertung,.kommentar,.textkorrektur,.uebersetzung,.variante").transition().duration(800)
                    .attr("fill", function(d) {
                        if (d.SchriftspurTyp == "B") {
                            return "#afacff"
                        } else if (d.SchriftspurTyp == "K") {
                            return "#018DC9"
                        } else if (d.SchriftspurTyp == "T") {
                            return "#29D1E2"
                        } else if (d.SchriftspurTyp == "U") {
                            return "#003888"
                        } else if (d.SchriftspurTyp == "V") {
                            return "#6544FE"
                        }
                    })
            }

            function farbeinfaltungMarginalien() {
                transitions = true

                setTimeout(function() {
                    transitions = false
                }, 1000);

                areachart.selectAll(".bewertung,.kommentar,.textkorrektur,.uebersetzung,.variante").classed("eingefaltet", true)

                dataContainer.selectAll(".nodes").filter(".bewertung,.kommentar,.textkorrektur,.uebersetzung,.variante").transition().duration(800)
                    .attr("fill", function(d) {
                        if (d.SchriftspurTyp == "B") {
                            return "#4D8DFF"
                        } else if (d.SchriftspurTyp == "K") {
                            return "#4D8DFF"
                        } else if (d.SchriftspurTyp == "T") {
                            return "#4D8DFF"
                        } else if (d.SchriftspurTyp == "U") {
                            return "#4D8DFF"
                        } else if (d.SchriftspurTyp == "V") {
                            return "#4D8DFF"
                        }
                    })
            }

var detailview = false


            function bookClick() {
              d3.select("#svgFrontTitles").style("display", "none")
                transitions = true
                setTimeout(function() {
                    transitions = false
                }, 3000);
                authorGroup.selectAll("rect").attr("display", "none")

                d3.select(this).transition().attr("opacity", 0)
                var posX = 0

                var thisData = (d3.select(this).datum().values).filter(function(d) {
                    return d.Benutzungsspur != "null"
                })


                var clickedBook = d3.select(this).datum().values[0].BookID
                var maxX = 0

                bookFingerprint.selectAll(".nodes")
                    .transition()
                    .duration(800)
                    .attr("width", function(d) {
                        if (d.BookID == clickedBook) {
                            return 20
                        } else {
                            return 5
                        }
                    })
                    .attr("x", 0)
                    .filter(function(d, i) {
                        return d.BookID == clickedBook
                    })
                    //.attr("x", function(d,i){console.log(d)})
                    //.attr("fill", function(d,i){console.log(d)})
                    .attr("x", function(d, i) {
                        if (i > 5 && thisData[i - 6].ID == d.ID) {
                            maxX = (Math.max(maxX, 7))
                            return 120
                        } else if (i > 4 && thisData[i - 5].ID == d.ID) {
                            maxX = (Math.max(maxX, 6))
                            return 100
                        } else if (i > 3 && thisData[i - 4].ID == d.ID) {
                            maxX = (Math.max(maxX, 5))
                            return 80
                        } else if (i > 2 && thisData[i - 3].ID == d.ID) {
                            maxX = (Math.max(maxX, 4))
                            return 60
                        } else if (i > 1 && thisData[i - 2].ID == d.ID) {
                            maxX = (Math.max(maxX, 3))
                            return 40
                        } else if (i != 0 && thisData[i - 1].ID == d.ID) {
                            maxX = (Math.max(maxX, 2))
                            return 20
                        } else {
                            maxX = (Math.max(maxX, 1))
                            return 0
                        }
                    })

                bookFingerprint.selectAll(".nodesbg")
                    .transition()
                    .duration(800)
                    .attr("width", function(d) {
                        if (d.values[0].BookID == clickedBook) {
                            return 20
                        } else {
                            return 5
                        }
                    })
                    .attr("x", 0)



                bookFingerprint
                    .transition()
                    .duration(700)
                    .attr("transform", function(d, i) {
                        if (i == 0) {
                            posx = 0
                            return "translate(" + (marginleft + (posx)) + "," + (posYCanvas) + ")"
                        } else if (i != 0 && datenByTitle[i - 1].values[0].BookID == clickedBook) {
                            posx = posx + 350
                            return "translate(" + (marginleft + (posx)) + "," + (posYCanvas) + ")"
                        } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser) {
                            posx = posx + 12
                            return "translate(" + (marginleft + (posx)) + "," + (posYCanvas) + ")"
                        } else {
                            posx = posx + 8
                            return "translate(" + (marginleft + (posx)) + "," + (posYCanvas) + ")"
                        }
                    })


                bookG
                    .transition()
                    .delay(50)
                    .duration(800)
                    .attr("transform", function(d, i) {
                        if (i == 0) {
                            posx = 0
                            return "translate(" + (marginleft - 2 + (posx)) + "," + (posY) + ")"
                        } else if (i != 0 && datenByTitle[i - 1].values[0].BookID == clickedBook) {
                            posx = posx + 350
                            return "translate(" + (marginleft - 2 + (posx)) + "," + (posY) + ")"
                        } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser) {
                            posx = posx + 12
                            return "translate(" + (marginleft - 2 + (posx)) + "," + (posY) + ")"
                        } else {
                            posx = posx + 8
                            return "translate(" + (marginleft - 2 + (posx)) + "," + (posY) + ")"
                        }
                    })
                    .selectAll("rect")
                    .attr("cursor", function() {
                        if (scrollTop > -5) {
                            return "pointer"
                        } else {
                            return "not-allowed"
                        }
                    })



                bookG.selectAll(".bookBG")
                    .transition()
                    .delay(50)
                    .duration(800)
                    //.attr("fill", function(d){console.log(d.values[0].BookID)})
                    .attr("width", function(d) {
                        if (d.values[0].BookID == clickedBook) {
                            return 350
                        } else {
                            return buchBreite
                        }
                    })

                d3.selectAll(".BuchTitel").remove()

                d3.selectAll(".detailinfo")
                    .transition()
                    .style("opacity", 0)
                    .remove()

                detailview = true
                ///Detailinfo bei Klick einblenden
                var detailInfo = d3.select(this.parentNode).append("g").attr("class", "detailinfo")





                setTimeout(function() {


                  detailInfo.append("text")
                      .attr("class", "detail_titel")
                      .text(function(d) {
                          return d.values[0].BuchTitel
                      })
                      .attr("y", 10)
                      .attr("dy", 0)
                      .attr("x", 5 + 20 * maxX)
                      .call(wrap, 200)
                      .selectAll("tspan")
                      .attr("x", 5 + 20 * maxX)


                    detailInfo.append("image")
                        .attr("xlink:href", function(d) {
                            return "./img/m/" + (d.values.filter(function(D) {
                                return D.Part === "1"
                            })[0].ID) + ".jpg"
                        })
                        //.attr("xlink:href", function(d){return console.log(d.values.filter(function(D){return D.Part === "1"}))})
                        .attr("class", "detail_cover")
                        .attr("y", function() {
                            return 5 + (d3.select(".detail_titel")).node().getBBox().height
                        })
                        .attr("x", 5 + 20 * maxX)
                        .attr("height", 140)




                    detailInfo.append("text")
                        .attr("class", "detail_verfasser")
                        .text(function(d) {
                            return "Verfasser: " + d.values[0].Verfasser
                        })
                        .attr("y", function() {
                            return 160 + (d3.select(".detail_titel")).node().getBBox().height
                        })
                        .attr("dy", 0)
                        .attr("x", 5 + 20 * maxX)
                        .call(wrap, 200)
                        .selectAll("tspan")
                        .attr("x", 5 + 20 * maxX)

                    detailInfo.append("text")
                        .attr("class", "detail_genre")
                        .text(function(d) {
                            return "Genre: " + d.values[0].Genre
                        })
                        .attr("y", function() {
                            return 160 + ((d3.select(".detail_titel")).node().getBBox().height) + (d3.select(".detail_verfasser")).node().getBBox().height
                        })
                        .attr("dy", 0)
                        .attr("x", 5 + 20 * maxX)
                        .call(wrap, 200)
                        .selectAll("tspan")
                        .attr("x", 5 + 20 * maxX)

                    detailInfo.append("text")
                        .attr("class", "detail_year")
                        .text(function(d) {
                            return "Datierung: " + "XXXX"
                        })
                        .attr("y", function() {
                            return 160 + ((d3.select(".detail_genre")).node().getBBox().height) + ((d3.select(".detail_titel")).node().getBBox().height) + (d3.select(".detail_verfasser")).node().getBBox().height
                        })
                        .attr("dy", 0)
                        .attr("x", 5 + 20 * maxX)

                    detailInfo.append("text")
                        .attr("class", "detail_seitenzahl")
                        .text(function(d) {
                            return "Seitenzahl: " + d.values[0].maxPart
                        })
                        .attr("y", function() {
                            return 160 + ((d3.select(".detail_year")).node().getBBox().height) + ((d3.select(".detail_genre")).node().getBBox().height) + ((d3.select(".detail_titel")).node().getBBox().height) + (d3.select(".detail_verfasser")).node().getBBox().height
                        })
                        .attr("dy", 0)
                        .attr("x", 5 + 20 * maxX)


                    // detailInfo.append("rect")
                    //     .attr("class", "detail_eigentumsangaben")
                    //     .attr("y", function() {
                    //         return 160 + ((d3.select(".detail_seitenzahl")).node().getBBox().height) + ((d3.select(".detail_year")).node().getBBox().height) + ((d3.select(".detail_genre")).node().getBBox().height) + ((d3.select(".detail_titel")).node().getBBox().height) + (d3.select(".detail_verfasser")).node().getBBox().height
                    //     })
                    //     .attr("x", 5 + 20 * maxX)
                    //     .attr("height", 10)
                    //     .attr("width", 100)
                    //     .attr("fill", "blue")
                    //
                    // detailInfo.append("rect")
                    //     .attr("class", "detail_marginalien")
                    //     .attr("y", function() {
                    //         return 175 + ((d3.select(".detail_seitenzahl")).node().getBBox().height) + ((d3.select(".detail_year")).node().getBBox().height) + ((d3.select(".detail_genre")).node().getBBox().height) + ((d3.select(".detail_titel")).node().getBBox().height) + (d3.select(".detail_verfasser")).node().getBBox().height
                    //     })
                    //     .attr("x", 5 + 20 * maxX)
                    //     .attr("height", 10)
                    //     .attr("width", 120)
                    //     .attr("fill", "#ff7b38")
                    //
                    // detailInfo.append("rect")
                    //     .attr("class", "detail_markierung")
                    //     .attr("y", function() {
                    //         return 190 + ((d3.select(".detail_seitenzahl")).node().getBBox().height) + ((d3.select(".detail_year")).node().getBBox().height) + ((d3.select(".detail_genre")).node().getBBox().height) + ((d3.select(".detail_titel")).node().getBBox().height) + (d3.select(".detail_verfasser")).node().getBBox().height
                    //     })
                    //     .attr("x", 5 + 20 * maxX)
                    //     .attr("height", 10)
                    //     .attr("width", 160)
                    //     .attr("fill", "#00d18d")
                    //
                    // detailInfo.append("rect")
                    //     .attr("class", "detail_markierung")
                    //     .attr("y", function() {
                    //         return 205 + ((d3.select(".detail_seitenzahl")).node().getBBox().height) + ((d3.select(".detail_year")).node().getBBox().height) + ((d3.select(".detail_genre")).node().getBBox().height) + ((d3.select(".detail_titel")).node().getBBox().height) + (d3.select(".detail_verfasser")).node().getBBox().height
                    //     })
                    //     .attr("x", 5 + 20 * maxX)
                    //     .attr("height", 10)
                    //     .attr("width", 20)
                    //     .attr("fill", "#e3c460")

                }, 200);

                //
                // var titleLineCount =
                // console.log(d3.select(".detail_titel").selectAll("tspan")._groups[0].length)

                detailInfo
                    .attr("transform", "scale(0,1)")
                    .transition()
                    .duration(1200)
                    .attr("transform", "scale(1,1)")



            }


            ////////// Text-Wrap Function Anfang///
            ///////////////////////////////////////
            ///////////////////////////////////////

            function wrap(text, width) {

                text.each(function() {
                    var lineNumber = 0
                    var text = d3.select(this),
                        words = text.text().split(/\s+/).reverse(),
                        word,
                        line = []

                    var lineHeight = 1.1, // ems
                        y = text.attr("y"),
                        dy = parseFloat(text.attr("dy")),
                        tspan = text.text(null).append("tspan").attr("y", y).attr("dy", dy + "em")


                    while (word = words.pop()) {
                        line.push(word);
                        tspan.text(line.join(" "));
                        if (tspan.node().getComputedTextLength() > width) {
                            line.pop();
                            tspan.text(line.join(" "));
                            line = [word];
                            lineNumber = lineNumber + 1
                            tspan = text.append("tspan").attr("y", y).attr("dy", lineNumber * lineHeight + dy + "em").text(word);
                        }
                    }

                });

            }



            ////////// Text-Wrap Function Ende/////
            ///////////////////////////////////////
            ///////////////////////////////////////








            //
            //
            //
            //
            var colToCircle = {};

            // 				// === Draw canvas === //

            var i = 1




            ////////// Filter Interaction///////////
            ///////////////////////////////////////
            ///////////////////////////////////////


            d3.select("h1").on("click", function() {
                transitions = true
                setTimeout(function() {
                    transitions = false
                }, 1000);
                dataContainer.selectAll(".nodes")
                    .transition()
                    .attr("opacity", 1)
            })

            function filterInteraction() {
                transitions = true
                setTimeout(function() {
                    transitions = false
                }, 1000);
                if (filter == null) {
                  areachart.selectAll("path").classed("filtered", false)

                    dataContainer.selectAll(".nodes")
                        .attr("opacity", 1)

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.SchriftspurTyp == "P" && d.Schreibmedium != "Stempel"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "#575757")

                        dataContainer.selectAll(".nodes")
                            .filter(function(d) {
                                return d.SchriftspurTyp == "P" && d.Schreibmedium == "Stempel"
                            })
                            .attr("opacity", 1)
                            .transition()
                            .attr("fill", "#828282")


                            dataContainer.selectAll(".nodes")
                                .filter(function(d) {
                                    return d.Benutzungsspur === "1" || d.Benutzungsspur === "1?"
                                })
                                .attr("opacity", 1)
                                .transition()
                                .attr("fill", "#F74141")

                                dataContainer.selectAll(".nodes")
                                    .filter(function(d) {
                                        return d.Benutzungsspur === "2" || d.Benutzungsspur === "2?"
                                    })
                                    .attr("opacity", 1)
                                    .transition()
                                    .attr("fill", "#FF8A5D")

                                    dataContainer.selectAll(".nodes")
                                        .filter(function(d) {
                                            return d.Benutzungsspur === "3" || d.Benutzungsspur === "3?"
                                        })
                                        .attr("opacity", 1)
                                        .transition()
                                        .attr("fill", "#8D084E")

                                        dataContainer.selectAll(".nodes")
                                            .filter(function(d) {
                                                return d.Benutzungsspur === "4" || d.Benutzungsspur === "4?"
                                            })
                                            .attr("opacity", 1)
                                            .transition()
                                            .attr("fill", "#FD9698")

                                            dataContainer.selectAll(".nodes")
                                                .filter(function(d) {
                                                    return d.Benutzungsspur === "6" || d.Benutzungsspur === "6?"
                                                })
                                                .attr("opacity", 1)
                                                .transition()
                                                .attr("fill", "#e5b404")

                                                dataContainer.selectAll(".nodes")
                                                    .filter(function(d) {
                                                        return d.SchriftspurTyp == "B"
                                                    })
                                                    .attr("opacity", 1)
                                                    .transition()
                                                    .attr("fill", "#afacff")

                                                    dataContainer.selectAll(".nodes")
                                                        .filter(function(d) {
                                                            return d.SchriftspurTyp == "K"
                                                        })
                                                        .attr("opacity", 1)
                                                        .transition()
                                                        .attr("fill", "#018DC9")

                                                        dataContainer.selectAll(".nodes")
                                                            .filter(function(d) {
                                                                return d.SchriftspurTyp == "T"
                                                            })
                                                            .attr("opacity", 1)
                                                            .transition()
                                                            .attr("fill", "#29D1E2")

                                                            dataContainer.selectAll(".nodes")
                                                                .filter(function(d) {
                                                                    return d.SchriftspurTyp == "V"
                                                                })
                                                                .attr("opacity", 1)
                                                                .transition()
                                                                .attr("fill", "#6544FE")

                                                                dataContainer.selectAll(".nodes")
                                                                    .filter(function(d) {
                                                                        return d.SchriftspurTyp == "U"
                                                                    })
                                                                    .attr("opacity", 1)
                                                                    .transition()
                                                                    .attr("fill", "#003888")

                                                                    dataContainer.selectAll(".nodes")
                                                                        .filter(function(d) {
                                                                            return d.Benutzungsspur === "7" || d.Benutzungsspur === "7?"
                                                                        })
                                                                        .attr("opacity", 1)
                                                                        .transition()
                                                                        .attr("fill", "#ff206a")

                }
                else if (filter == "eigentumsangaben") {

                    areachart.selectAll("path").classed("filtered", true).filter(".provenienz,.provenienzstempel").classed("filtered", false)

                    dataContainer.selectAll(".nodes")
                    .attr("opacity", 0)
                        .transition()
                        .attr("fill", "white")

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.SchriftspurTyp == "P" && d.Schreibmedium != "Stempel"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "#575757")

                        dataContainer.selectAll(".nodes")
                            .filter(function(d) {
                                return d.SchriftspurTyp == "P" && d.Schreibmedium == "Stempel"
                            })
                            .attr("opacity", 1)
                            .transition()
                            .attr("fill", "#828282")
                }
                else if (filter == "provenienz") {

                    areachart.selectAll("path").classed("filtered", true).filter(".provenienz").classed("filtered", false)

                    dataContainer.selectAll(".nodes")
                    .attr("opacity", 0)
                        .transition()
                        .attr("fill", "white")

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.SchriftspurTyp == "P" && d.Schreibmedium != "Stempel"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "#575757")


                } else if (filter == "provenienzstempel") {

                    areachart.selectAll("path").classed("filtered", true).filter(".provenienzstempel").classed("filtered", false)

                    dataContainer.selectAll(".nodes")
                    .attr("opacity", 0)
                        .transition()
                        .attr("fill", "white")

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.SchriftspurTyp == "P" && d.Schreibmedium == "Stempel"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "#828282")

                      } else if (filter == "markierungen") {

                        areachart.selectAll("path").classed("filtered", true).filter(".unterstreichung,.anstreichung,.durchstreichung,.sonstigeMarkierung,.anderes").classed("filtered", false)

                          dataContainer.selectAll(".nodes")
                          .attr("opacity", 0)
                              .transition()
                              .attr("fill", "white")


                              dataContainer.selectAll(".nodes")
                                  .filter(function(d) {
                                      return d.Benutzungsspur === "1" || d.Benutzungsspur === "1?"
                                  })
                                  .attr("opacity", 1)
                                  .transition()
                                  .attr("fill", "#F74141")

                                  dataContainer.selectAll(".nodes")
                                      .filter(function(d) {
                                          return d.Benutzungsspur === "2" || d.Benutzungsspur === "2?"
                                      })
                                      .attr("opacity", 1)
                                      .transition()
                                      .attr("fill", "#FF8A5D")

                                      dataContainer.selectAll(".nodes")
                                          .filter(function(d) {
                                              return d.Benutzungsspur === "3" || d.Benutzungsspur === "3?"
                                          })
                                          .attr("opacity", 1)
                                          .transition()
                                          .attr("fill", "#8D084E")

                                          dataContainer.selectAll(".nodes")
                                              .filter(function(d) {
                                                  return d.Benutzungsspur === "4" || d.Benutzungsspur === "4?"
                                              })
                                              .attr("opacity", 1)
                                              .transition()
                                              .attr("fill", "#FD9698")





                      } else if (filter == "anstreichung") {

                        areachart.selectAll("path").classed("filtered", true).filter(".anstreichung").classed("filtered", false)

                          dataContainer.selectAll(".nodes")
                          .attr("opacity", 0)
                              .transition()
                              .attr("fill", "white")

                          dataContainer.selectAll(".nodes")
                              .filter(function(d) {
                                  return d.Benutzungsspur === "1" || d.Benutzungsspur === "1?"
                              })
                              .attr("opacity", 1)
                              .transition()
                              .attr("fill", "#F74141")


                } else if (filter == "unterstreichung") {

                  areachart.selectAll("path").classed("filtered", true).filter(".unterstreichung").classed("filtered", false)

                    dataContainer.selectAll(".nodes")
                    .attr("opacity", 0)
                        .transition()
                        .attr("fill", "white")

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.Benutzungsspur === "2" || d.Benutzungsspur === "2?"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "#FF8A5D")
                } else if (filter == "durchstreichung") {

                  areachart.selectAll("path").classed("filtered", true).filter(".durchstreichung").classed("filtered", false)

                    dataContainer.selectAll(".nodes")
                    .attr("opacity", 0)
                        .transition()
                        .attr("fill", "white")

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.Benutzungsspur === "3" || d.Benutzungsspur === "3?"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "#8D084E")
                } else if (filter == "sonstigeMarkierung") {

areachart.selectAll("path").classed("filtered", true).filter(".sonstigeMarkierung").classed("filtered", false)

                    dataContainer.selectAll(".nodes")
                    .attr("opacity", 0)
                        .transition()
                        .attr("fill", "white")

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.Benutzungsspur === "4" || d.Benutzungsspur === "4?"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "#FD9698")
                } else if (filter == "zusatzMaterial") {
                  areachart.selectAll("path").classed("filtered", true).filter(".zusatzMaterial").classed("filtered", false)

                    dataContainer.selectAll(".nodes")
                    .attr("opacity", 0)
                        .transition()
                        .attr("fill", "white")

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.Benutzungsspur === "6" || d.Benutzungsspur === "6?"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "#e5b404")

                      } else if (filter == "marginalien") {
                        areachart.selectAll("path").classed("filtered", true).filter(".bewertung,.kommentar,.textkorrektur,.uebersetzung,.variante").classed("filtered", false)

                          dataContainer.selectAll(".nodes")
                          .attr("opacity", 0)
                              .transition()
                              .attr("fill", "white")

                              dataContainer.selectAll(".nodes")
                                  .filter(function(d) {
                                      return d.SchriftspurTyp == "B"
                                  })
                                  .attr("opacity", 1)
                                  .transition()
                                  .attr("fill", "#afacff")

                                  dataContainer.selectAll(".nodes")
                                      .filter(function(d) {
                                          return d.SchriftspurTyp == "K"
                                      })
                                      .attr("opacity", 1)
                                      .transition()
                                      .attr("fill", "#018DC9")

                                      dataContainer.selectAll(".nodes")
                                          .filter(function(d) {
                                              return d.SchriftspurTyp == "T"
                                          })
                                          .attr("opacity", 1)
                                          .transition()
                                          .attr("fill", "#29D1E2")

                                          dataContainer.selectAll(".nodes")
                                              .filter(function(d) {
                                                  return d.SchriftspurTyp == "V"
                                              })
                                              .attr("opacity", 1)
                                              .transition()
                                              .attr("fill", "#6544FE")

                                              dataContainer.selectAll(".nodes")
                                                  .filter(function(d) {
                                                      return d.SchriftspurTyp == "U"
                                                  })
                                                  .attr("opacity", 1)
                                                  .transition()
                                                  .attr("fill", "#003888")


                } else if (filter == "bewertung") {
                  areachart.selectAll("path").classed("filtered", true).filter(".bewertung").classed("filtered", false)


                    dataContainer.selectAll(".nodes")
                    .attr("opacity", 0)
                        .transition()
                        .attr("fill", "white")

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.SchriftspurTyp == "B"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "#afacff")
                } else if (filter == "kommentar") {
                  areachart.selectAll("path").classed("filtered", true).filter(".kommentar").classed("filtered", false)

                    dataContainer.selectAll(".nodes")
                    .attr("opacity", 0)
                        .transition()
                        .attr("fill", "white")

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.SchriftspurTyp == "K"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "#018DC9")
                } else if (filter == "textkorrektur") {
                  areachart.selectAll("path").classed("filtered", true).filter(".textkorrektur").classed("filtered", false)

                    dataContainer.selectAll(".nodes")
                    .attr("opacity", 0)
                        .transition()
                        .attr("fill", "white")

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.SchriftspurTyp == "T"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "#29D1E2")
                } else if (filter == "variante") {
                  areachart.selectAll("path").classed("filtered", true).filter(".variante").classed("filtered", false)

                    dataContainer.selectAll(".nodes")
                    .attr("opacity", 0)
                        .transition()
                        .attr("fill", "white")

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.SchriftspurTyp == "V"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "#6544FE")
                } else if (filter == "uebersetzung") {
                  areachart.selectAll("path").classed("filtered", true).filter(".uebersetzung").classed("filtered", false)

                    dataContainer.selectAll(".nodes")
                    .attr("opacity", 0)
                        .transition()
                        .attr("fill", "white")

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.SchriftspurTyp == "U"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "#003888")
                } else if (filter == "anderes") {
                  areachart.selectAll("path").classed("filtered", true).filter(".anderes").classed("filtered", false)

                    dataContainer.selectAll(".nodes")
                    .attr("opacity", 0)
                        .transition()
                        .attr("fill", "white")

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.Benutzungsspur === "7" || d.Benutzungsspur === "7?"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "#ff206a")
                } else if (filter == "leer") {
                    dataContainer.selectAll(".nodes")
                    .attr("opacity", 0)
                        .transition()
                        .attr("fill", "white")

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.Benutzungsspur === "null"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "white")
                }


            }



            ////////// Filter Interaction Ende/////
            ///////////////////////////////////////
            ///////////////////////////////////////


            function animate() {

                if (transitions == true || scrollTop !== newScrollTop) {
                    scrollTop = newScrollTop
                    scrollFunction()
                    draw()

                }
                window.requestAnimationFrame(animate);
            }
            window.requestAnimationFrame(animate);


            function scrollFunction() {
              d3.select('.tooltip')
                  .style("display", "none"

                )
              if (scrollTop != 0) {

detailview = false


 d3.select("#svgFrontTitles").style("display", "none")

}else if(scrollTop == 0 && detailview == false){
     d3.select("#svgFrontTitles").style("display", "inline")

   }else if(scrollTop == 0 && detailview == true){
        d3.select("#svgFrontTitles").style("display", "none")
}



                bookG
                    .selectAll("rect")
                    .attr("cursor", function() {
                        if (scrollTop > -5) {
                            return "pointer"
                        } else {
                            return "auto"
                        }
                    })


                    // if(scrollTop == 0){
                    //   d3.select("#svgFrontTitles").style("display", "inline")
                    // }

                if (scrollTop < 0) {
                  /////remove Detailview von buchauswahl


                                d3.selectAll(".detailinfo")
                                    .transition()
                                    .style("opacity", 0)
                                    .remove()
                  /////remove Detailview von buchauswahl ende


                    authorGroup.selectAll("rect").transition().duration(200).attr("opacity", 0)


                    bookFingerprint.selectAll(".nodes")
                        .attr("height", function(d) {
                            if (d.maxPart >= 1111) {
                                var implicateScaleB = d3.scaleLinear()
                                    .domain([-100, -4000])
                                    .range([(areaheight / d.maxPart), 0])
                                    .clamp(true)
                                return implicateScaleB(scrollTop)
                            } else {
                                var implicateScale = d3.scaleLinear()
                                    .domain([-100, -4000])
                                    .range([pageheight, (areaheight / d.maxPart)])
                                    .clamp(true)
                                return implicateScale(scrollTop)
                            }
                        })
                        .attr("y", function(d, i) {
                            if (d.maxPart >= 1111) {
                                var implicateScaleB = d3.scaleLinear()
                                    .domain([-100, -4000])
                                    .range([(areaheight / d.maxPart), pageheight])
                                    .clamp(true)

                                return posYCanvas + implicateScaleB(scrollTop) * (d.Part - 1)
                            } else {
                                var implicateScale = d3.scaleLinear()
                                    .domain([-100, -4000])
                                    .range([pageheight, (areaheight / d.maxPart)])
                                    .clamp(true)

                                return posYCanvas + implicateScale(scrollTop) * (d.Part - 1)
                            }
                        })


                    bookFingerprint.selectAll(".nodesbg")
                        .attr("opacity", 1)
                        .attr("height", function(d) {
                            if (d.maxPart >= 1111) {
                                var implicateScaleB = d3.scaleLinear()
                                    .domain([-100, -4000])
                                    .range([areaheight, (d.values[0].maxPart) * pageheight])
                                    .clamp(true)
                                return implicateScaleB(scrollTop)
                            } else {
                                var implicateScale = d3.scaleLinear()
                                    .domain([-100, -4000])
                                    .range([(d.values[0].maxPart) * pageheight, areaheight])
                                    .clamp(true)
                                return implicateScale(scrollTop)
                            }
                        })


                    bookFingerprint.selectAll(".nodes")
                        .attr("opacity", 1)
                        .attr("width", function(d) {
                            var implicateScaleC = d3.scaleLinear()
                                .domain([-4000, -5000])
                                .range([buchBreite, 0])
                                .clamp(true)
                            return implicateScaleC(scrollTop)
                        })







                    //			if (scrollTop < -2300){

                    bookG
                        .attr("transform", function(d, i) {
													var areaSize = xAreaMax*(datenByAuthor.filter(function(D,I){if (d.values[0].AuthorCount == 1){return D.values[0].values[0].AuthorCount == 1}else{return D.values[0].values[0].Verfasser == d.values[0].Verfasser}})[0].maxTraceNumberNormBefore)
						//		console.log(datenByAuthor.filter(function(D,I){if (d.values[0].AuthorCount == 1){return D.values[0].values[0].AuthorCount == 1}else{return D.values[0].values[0].Verfasser == d.values[0].Verfasser}})[0].maxTraceNumberNormBefore)

                            if (i == 0) {
                                posx2 = 0
                                posx = 0
                                return "translate(" + (marginleft - 1 + (posx2)) + "," + (posY) + ")"
                            } else if (i != 0 && d.values[0].AuthorCount == 1 && d.values[0].Verfasser != "[Black, Adam u. Charles]") {
                                posx2 = posx2
                                posx = posx + buchBgBreite

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([-100, -6000])
                                    .range([posx, posx2])
                                    .clamp(true)

                                return "translate(" + (marginleft - 1 + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"
                            } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser) {
                                posx2 = posx2 + areaSize+authorLevelAbstand
                                posx = posx + authorAbstand

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([-100, -6000])
                                    .range([posx, posx2])
                                    .clamp(true)

                                return "translate(" + (marginleft - 1 + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"
                            } else {
                                posx2 = posx2
                                posx = posx + buchBgBreite

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([-100, -6000])
                                    .range([posx, posx2])
                                    .clamp(true)

                                return "translate(" + (marginleft - 1 + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"
                            }
                        })



                    bookGFront
                        .attr("transform", function(d, i) {
													var areaSize = xAreaMax*(datenByAuthor.filter(function(D,I){if (d.values[0].AuthorCount == 1){return D.values[0].values[0].AuthorCount == 1}else{return D.values[0].values[0].Verfasser == d.values[0].Verfasser}})[0].maxTraceNumberNormBefore)


                            if (i == 0) {
                                posx2 = 0
                                posx = 0
                                return "translate(" + (marginleft - 1 + (posx2)) + "," + (posY) + ")"
                            } else if (i != 0 && d.values[0].AuthorCount == 1 && d.values[0].Verfasser != "[Black, Adam u. Charles]") {
                                posx2 = posx2
                                posx = posx + buchBgBreite

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([-100, -6000])
                                    .range([posx, posx2])
                                    .clamp(true)

                                return "translate(" + (marginleft - 1 + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"

                            } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser) {
																posx2 = posx2 + areaSize+authorLevelAbstand
                                posx = posx + authorAbstand

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([-100, -6000])
                                    .range([posx, posx2])
                                    .clamp(true)

                                return "translate(" + (marginleft - 1 + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"
                            } else {
                                posx2 = posx2
                                posx = posx + buchBgBreite

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([-100, -6000])
                                    .range([posx, posx2])
                                    .clamp(true)

                                return "translate(" + (marginleft - 1 + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"
                            }
                        })






                    bookFingerprint
                        .attr("transform", function(d, i) {
													var areaSize = xAreaMax*(datenByAuthor.filter(function(D,I){if (d.values[0].AuthorCount == 1){return D.values[0].values[0].AuthorCount == 1}else{return D.values[0].values[0].Verfasser == d.values[0].Verfasser}})[0].maxTraceNumberNormBefore)

                            if (i == 0) {
                                posx2 = 0
                                posx = 0
                                return "translate(" + (marginleft - 1 + (posx2)) + "," + (posYCanvas) + ")"
                            } else if (i != 0 && d.values[0].AuthorCount == 1 && d.values[0].Verfasser != "[Black, Adam u. Charles]") {
                                posx2 = posx2
                                posx = posx + buchBgBreite

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([-100, -6000])
                                    .range([posx, posx2])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posYCanvas) + ")"
                            } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser) {


																posx2 = posx2 + areaSize+authorLevelAbstand
                                posx = posx + authorAbstand

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([-100, -6000])
                                    .range([posx, posx2])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posYCanvas) + ")"
                            } else {
                                posx2 = posx2
                                posx = posx + buchBgBreite

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([-100, -6000])
                                    .range([posx, posx2])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posYCanvas) + ")"
                            }
                        })



                    bookFingerprint
                        .selectAll(".nodesbg")
                        .attr("opacity", function(d) {
                            var implicateScaleOpacity = d3.scaleLinear()
                                .domain([-4000, -4900])
                                .range([1, 0])
                                .clamp(true)

                            return implicateScaleOpacity(scrollTop)
                        })

                    var implicateScaleAreaChart = d3.scaleLinear()
                        .domain([-4000, -6000])
                        .range([0, 1])
                        .clamp(true)


                    layerGroups.attr("transform", "translate(0,0)scale(" + implicateScaleAreaChart(scrollTop) + ",1)")
                    areachartGroup.selectAll("line").attr("display", "auto")
                    areachart.attr("display", function() {
                        if (scrollTop > 0) {
                            return "auto"
                        }
                    })




                }

                ////////Scroll-Section > 0 Start
                ///////////////////////////////////////
                ///////////////////////////////////////
                ///////////////////////////////////////
                else if (scrollTop > 0) {
                  /////remove Detailview von buchauswahl

                  d3.select("#svgFrontTitles").style("display", "none")

                                d3.selectAll(".detailinfo")
                                    .transition()
                                    .style("opacity", 0)
                                    .remove()
                  /////remove Detailview von buchauswahl ende


                    bookG
                        .attr("transform", function(d, i) {
                            if (i == 0) {
                                posx2 = 0
                                posx = 0
                                return "translate(" + (marginleft - 1 + (posx2)) + "," + (posY) + ")"
                            } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser) {
                                posx2 = posx2 + sLAuthorAbstand
                                posx = posx + authorAbstand

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([-100, -6000])
                                    .range([posx, posx2])
                                    .clamp(true)

                                return "translate(" + (marginleft - 1 + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"
                            } else {
                                posx2 = posx2
                                posx = posx + buchBgBreite

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([-100, -6000])
                                    .range([posx, posx2])
                                    .clamp(true)

                                return "translate(" + (marginleft - 1 + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"
                            }
                        })

                    bookFingerprint
                        .attr("transform", function(d, i) {
                            if (i == 0) {
                                posx2 = 0
                                posx = 0
                                return "translate(" + (marginleft - 1 + (posx2)) + "," + (posYCanvas) + ")"
                            } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser) {
                                posx2 = posx2 + sLAuthorAbstand
                                posx = posx + authorAbstand

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([-100, -6000])
                                    .range([posx, posx2])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posYCanvas) + ")"
                            } else {
                                posx2 = posx2
                                posx = posx + buchBgBreite

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([-100, -6000])
                                    .range([posx, posx2])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posYCanvas) + ")"
                            }
                        })



                    bookFingerprint
                        .selectAll(".nodesbg")
                        .attr("opacity", function(d) {
                            var implicateScaleOpacity = d3.scaleLinear()
                                .domain([-200, -5000])
                                .range([1, 0])
                                .clamp(true)

                            return implicateScaleOpacity(scrollTop)
                        })




                    areachartGroup.selectAll("line").attr("display", "none")
                    areachart.attr("display", "none")

                    var explicateScale = d3.scaleLinear()
                        .domain([500, 2500])
                        .range([pageheight, 30])
                        .clamp(true)

                    var explicateScale2 = d3.scaleLinear()
                        .domain([500, 2500])
                        .range([pageheight, 31])
                        .clamp(true)


                    //////////////////////////Auswahl für SelectedAuthor beim Reinzoomen und Stauchen der anderen Bücher
                    thisVerfasserSelectedBookCount = datenByAuthor.filter(function(d, i) {
                        return d.key == thisVerfasserSelected
                    })[0].values.length
                    sLTotalBuchWidthSelected = thisVerfasserSelectedBookCount * sLBuchAbstandSelected
                    sLTotalBuchWidthUnselected = (BuchAnzahl - thisVerfasserSelectedBookCount) * sLBuchAbstandUnselected
                    sLAuthorAbstand2 = (chartArea - (sLTotalBuchWidthSelected + sLTotalBuchWidthUnselected)) / (authorAnzahl - 1)



                    bookFingerprint.selectAll(".nodes")
                        .attr("height", explicateScale(scrollTop))
                        .attr("width", function(d, i) {
                            if (d.Verfasser == thisVerfasserSelected) {
                                var implicateScaleWidth = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([buchBreite, sLBuchBreiteSelected])
                                    .clamp(true)

                                return implicateScaleWidth(scrollTop)


                            } else {
                                var implicateScaleWidth = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([buchBreite, sLBuchBreiteUnselected])
                                    .clamp(true)

                                return implicateScaleWidth(scrollTop)
                            }
                        })
                        .attr("y", function(d, i) {
                            return posYCanvas + (explicateScale2(scrollTop)) * (d.Part - 1)
                        })
                        //.filter(function(d,i){return d.Verfasser == thisVerfasserSelected})
                        .attr("x", function(d, i) {
                            if (d.Verfasser == thisVerfasserSelected) {

                                var thisBookData = (d3.select(this.parentNode).datum()).values.filter(function(D, I) {
                                    return D.Benutzungsspur != "null"
                                })
                                //	console.log(thisBookData)
                                var maxX = 0

                                if (i > 5 && thisBookData[i - 6].ID == d.ID) {
                                    maxX = (Math.max(maxX, 7))

                                    var implicateScaleXPos = d3.scaleLinear()
                                        .domain([500, 2000])
                                        .range([0, 6 * sLSeitenAbstandSelected])
                                        .clamp(true)


                                    return implicateScaleXPos(scrollTop)
                                } else if (i > 4 && thisBookData[i - 5].ID == d.ID) {
                                    maxX = (Math.max(maxX, 6))

                                    var implicateScaleXPos = d3.scaleLinear()
                                        .domain([500, 2000])
                                        .range([0, 5 * sLSeitenAbstandSelected])
                                        .clamp(true)


                                    return implicateScaleXPos(scrollTop)
                                } else if (i > 3 && thisBookData[i - 4].ID == d.ID) {
                                    maxX = (Math.max(maxX, 5))

                                    var implicateScaleXPos = d3.scaleLinear()
                                        .domain([500, 2000])
                                        .range([0, 4 * sLSeitenAbstandSelected])
                                        .clamp(true)


                                    return implicateScaleXPos(scrollTop)
                                } else if (i > 2 && thisBookData[i - 3].ID == d.ID) {
                                    maxX = (Math.max(maxX, 4))

                                    var implicateScaleXPos = d3.scaleLinear()
                                        .domain([500, 2000])
                                        .range([0, 3 * sLSeitenAbstandSelected])
                                        .clamp(true)


                                    return implicateScaleXPos(scrollTop)
                                } else if (i > 1 && thisBookData[i - 2].ID == d.ID) {
                                    maxX = (Math.max(maxX, 3))

                                    var implicateScaleXPos = d3.scaleLinear()
                                        .domain([500, 2000])
                                        .range([0, 2 * sLSeitenAbstandSelected])
                                        .clamp(true)


                                    return implicateScaleXPos(scrollTop)
                                } else if (i != 0 && thisBookData[i - 1].ID == d.ID) {
                                    maxX = (Math.max(maxX, 2))


                                    var implicateScaleXPos = d3.scaleLinear()
                                        .domain([500, 2000])
                                        .range([0, 1 * sLSeitenAbstandSelected])
                                        .clamp(true)


                                    return implicateScaleXPos(scrollTop)
                                } else {
                                    maxX = (Math.max(maxX, 1))
                                    return 0
                                }

                            } else {
                                return 0
                            }
                        })




                    bookFingerprint.selectAll(".nodesbg")
                        .attr("height", function(d) {
                            return (explicateScale2(scrollTop)) * (d.values[0].maxPart)
                        })
                        .attr("width", function(d, i) {
                            if (d.values[0].Verfasser == thisVerfasserSelected) {
                                var implicateScaleWidth = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([buchBreite, sLBuchBreiteSelected])
                                    .clamp(true)

                                return implicateScaleWidth(scrollTop)


                            } else {
                                var implicateScaleWidth = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([buchBreite, sLBuchBreiteUnselected])
                                    .clamp(true)

                                return implicateScaleWidth(scrollTop)
                            }
                        })

                        d3.select("#svg").selectAll(".bookBG").selectAll("rect")
                        .attr("width", function(d, i) {
                            if (d.values[0].Verfasser == thisVerfasserSelected) {
                                var implicateScaleWidth = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([buchBreite, sLBuchBreiteSelected])
                                    .clamp(true)

                                return implicateScaleWidth(scrollTop)


                            } else {
                                var implicateScaleWidth = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([buchBreite, sLBuchBreiteUnselected])
                                    .clamp(true)

                                return implicateScaleWidth(scrollTop)
                            }
                        })




                    bookFingerprint
                        .attr("transform", function(d, i) {
                                              console.log(scrollTop)
                          if (scrollTop < 3000){
                            posYCanvas = 0
                          }
                          else {
                            posYCanvas = 0-((scrollTop-3000)*2)
                          }console.log(posYCanvas)
                          //falls erstes Element
                            if (i == 0) {
                                posx3 = 0
                                posx = 0
                                return "translate(" + (marginleft - 1 + (posx3)) + "," + (posYCanvas) + ")"

                            //falls vorheriges Element Selected und anderer Verfasser
                            } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser && datenByTitle[i - 1].values[0].Verfasser == thisVerfasserSelected) {
                                posx3 = posx3 + sLBuchAbstandSelected + sLAuthorAbstand2
                                posx = posx + authorAbstand

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([posx, posx3])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posYCanvas) + ")"

                            //falls vorheriges Element Selected und gleicher Verfasser
                          } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser == thisVerfasserSelected && datenByTitle[i - 1].values[0].Verfasser == d.values[0].Verfasser) {
                                posx3 = posx3 + sLBuchAbstandSelected
                                posx = posx + buchBgBreite

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([posx, posx3])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posYCanvas) + ")"

                            //falls vorheriges Element NICHT Selected und anderer Verfasser
                          } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser && datenByTitle[i - 1].values[0].Verfasser != thisVerfasserSelected && datenByTitle[i - 1].values[0].AuthorCount != 1) {
                                posx3 = posx3 + sLAuthorAbstand2
                                posx = posx + authorAbstand

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([posx, posx3])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posYCanvas) + ")"

                            //falls vorheriges Element NICHT Selected und gleicher Verfasser
                            } else {
                                posx3 = posx3 + sLBuchAbstandUnselected
                                posx = posx + buchBgBreite

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([posx, posx3])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posYCanvas) + ")"
                            }
                        })

bookFingerprint.selectAll(".nodesbg")
.attr("y", function(d, i) {
                          if (scrollTop < 3000){

                            posYCanvas = 0
                          }
                          else {

                            posYCanvas = 0-((scrollTop-3000)*2)

                          } console.log(posYCanvas)
                                return posYCanvas})





                    bookG
                        .attr("transform", function(d, i) {
                          //falls erstes Element
                            if (i == 0) {
                                posx3 = 0
                                posx = 0
                                return "translate(" + (marginleft - 1 + (posx3)) + "," + (posY) + ")"

                                //falls vorheriges Element Selected und anderer Verfasser
                            } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser && datenByTitle[i - 1].values[0].Verfasser == thisVerfasserSelected) {
                                posx3 = posx3 + sLBuchAbstandSelected + sLAuthorAbstand2
                                posx = posx + authorAbstand

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([posx, posx3])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"

                                //falls vorheriges Element Selected und gleicher Verfasser
                            } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser == thisVerfasserSelected) {
                                posx3 = posx3 + sLBuchAbstandSelected
                                posx = posx + buchBgBreite

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([posx, posx3])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"

                                //falls vorheriges Element NICHT Selected und anderer Verfasser
                            } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser && datenByTitle[i - 1].values[0].Verfasser != thisVerfasserSelected) {
                                posx3 = posx3 + sLAuthorAbstand2
                                posx = posx + authorAbstand

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([posx, posx3])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"

                                //falls vorheriges Element NICHT Selected und gleicher Verfasser
                            } else {
                                posx3 = posx3 + sLBuchAbstandUnselected
                                posx = posx + buchBgBreite

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([posx, posx3])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"
                            }
                        })

                    bookGFront
                        .attr("transform", function(d, i) {
                            if (i == 0) {
                                posx3 = 0
                                posx = 0
                                return "translate(" + (marginleft - 1 + (posx3)) + "," + (posY) + ")"
                            } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser && datenByTitle[i - 1].values[0].Verfasser == thisVerfasserSelected) {
                                posx3 = posx3 + sLBuchAbstandSelected
                                posx = posx + authorAbstand

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([posx, posx3])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"
                            } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser == thisVerfasserSelected) {
                                posx3 = posx3 + sLBuchAbstandSelected
                                posx = posx + buchBgBreite

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([posx, posx3])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"
                            } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser && datenByTitle[i - 1].values[0].Verfasser != thisVerfasserSelected) {
                                posx3 = posx3 + sLAuthorAbstand2
                                posx = posx + authorAbstand

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([posx, posx3])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"
                            } else {
                                posx3 = posx3 + sLBuchAbstandUnselected
                                posx = posx + buchBgBreite

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([posx, posx3])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"
                            }
                        })


                    if (scrollTop > 400) {
                        d3.select("#svg").selectAll(".bookBG").selectAll("rect").attr("opacity", function(d) {
                            return 0
                        })

                    }



                    //////////////
                    //////////////
                    ///Hover-Thumb

                    bookG.on("mousemove", function(d) {
console.log(posYCanvas)
                        if (scrollTop > 0) {
                          var currentScrollTop = Math.max(window.pageYOffset, document.documentElement.scrollTop, document.body.scrollTop)

                      //    var mouseY = ((d3.event.layerY || d3.event.offsety) - currentScrollTop-120);
                      var mouseY = ((d3.event.pageY) - currentScrollTop-240-posYCanvas);

                            //console.log(mouseY/pageheight)
                            //console.log(d.values)

                      //      console.log(mouseY)
                            var thisPage = Math.round(round45(mouseY) / explicateScale2(scrollTop))
console.log(thisPage)

                            function round45(x) {
                                return Math.ceil(x / explicateScale2(scrollTop)) * explicateScale2(scrollTop)
                            }
                            //console.log(d.values.filter(function(D,I){return D.Part == 3}))
                            thisVerfasser = d3.select(this).datum().values[0].Verfasser
                            var thisBookID = d3.select(this).datum().values[0].BookID



                            //tooltip.select("p").text(thisPageID)
                            if (d.values[0].maxPart < thisPage || mouseY < 0) {
                                d3.select('.tooltip')
                                    .style("display", "none")
                                    .style('top', d3.event.pageY)
                            } else if (d.values[0].maxPart >= thisPage && mouseY > 0) {
                                var thisPageID = (d.values.filter(function(d, i) {
                                    return d.Part == thisPage
                                }))[0].ID

                                d3.select('.tooltip')
                                    .style("display", "block")
                                    .style('top', d3.event.pageY - 200 + 'px')
                                    .style('left', d3.event.pageX + 25 + 'px')

                                tooltip.select("img").attr("src", function() {
                                    return "./img/m/" + thisPageID + ".jpg"
                                })
                            }
                        }



                    })

                }

                ////////Scroll-Section > 0 Ende
                ///////////////////////////////////////
                ///////////////////////////////////////
                ///////////////////////////////////////

            }


            draw()

            function draw() {
                //		context.globalCompositeOperation = 'multiply';
                // clear canvas

                context.clearRect(0, 0, width, height);
                ///draw elements
                var bookGroups = dataContainer.selectAll(".bookFingerprint")


// areachart.each(function(d){
//
//
//   context.beginPath();
//   area(d);
//   if (d.key == "SonstigeMarkierungNorm"){
//     context.fillStyle = 'blue';
//     context.strokeStyle = 'blue';
//   }else{
//   context.fillStyle = 'red';
//   context.strokeStyle = 'red';}
//   context.fill();
// })

                bookGroups.each(function(d) {
                    //console.log(Number(d3.select(this).attr("transform").replace("translate(", "").split(',')[0]))
                    var bookGroupPosition = Number(d3.select(this).attr("transform").replace("translate(", "").split(',')[0])

                    var elementswhite = d3.select(this).selectAll(".nodesbg");

                    elementswhite.each(function(d) {

                        var node = d3.select(this);
                        var nodeXPos = Number(node.attr("x")) + bookGroupPosition
                        context.fillStyle = node.attr("fill");
                        context.globalAlpha = node.attr("opacity")
                        // context.shadowBlur = 0


                        context.beginPath();
                        context.rect((nodeXPos), (node.attr("y")), (node.attr("width")), (node.attr("height")))
                        //	context.arc((+node.attr("x")), (+node.attr("y")),  (+node.attr("width")), (+node.attr("height")));
                        context.fill();
                        context.closePath();
                    })



                    var elements = d3.select(this).selectAll(".nodes");

                    elements.each(function(d) {
                        var node = d3.select(this);
                        var nodeXPos = Number(node.attr("x")) + bookGroupPosition

                        context.fillStyle = node.attr("fill");
                        context.globalAlpha = node.attr("opacity")
                    //    context.globalCompositeOperation = 'multiply';

                        // if (filter != null && node.attr("opacity")!= 0){
                        // context.shadowColor = node.attr("fill");
                        // context.shadowBlur = 10;}
                        // else{ context.shadowBlur = 0}

                        context.beginPath();
                        context.rect((nodeXPos), (node.attr("y")), (node.attr("width")), (node.attr("height")))
                        //	context.arc((+node.attr("x")), (+node.attr("y")),  (+node.attr("width")), (+node.attr("height")));
                        context.fill();
                        context.closePath();
                    })
                })

            }



        });
    </script>

</body>

</html>
