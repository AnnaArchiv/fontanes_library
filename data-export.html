<!doctype html>
<html lang="de">

<head>
    <meta charset="utf-8">
    <title>Fontanes Handbibliothek</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Eine explorative Visualisierung von Lese- und Schriftspuren in Theodor Fontanes Handbibliothek mit der Datenerschließung des Theodor Fontane Archivs."/>
    <meta property="og:url"                content="https//uclab.fh-potsdam.de/ff" />
    <meta property="og:type"               content="website" />
    <meta property="og:title"              content="Theodor Fontanes Handbiblitothek"/>
    <meta property="og:description"        content="Eine explorative Visualisierung von Lese- und Schriftspuren in Theodor Fontanes Handbibliothek mit der Datenerschließung des Theodor Fontane Archivs." />
    <!-- <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" /> -->
    <script src="js/d3.v5.min.js"></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/select2.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/select2.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css?family=Reenie+Beanie|Stardos+Stencil" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Homemade+Apple" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Volkhov" rel="stylesheet">




    <style type="text/css">


        html,
        body {
             font-family: 'Roboto', sans-serif;

            background-color:white;
            margin: 0;
            overflow-y: scroll;
            overflow-x: scroll;
            width: 100%;
            font-size: 10px;
        }

        /* ::-webkit-scrollbar {
            display: none;
        } */


        h1 {
            margin-left: 0px;
            margin-top: 17px;
            margin-bottom: 0;
            font-weight: 500;
            letter-spacing: 2px;
            font-size: 28px;
             text-transform: uppercase;
                /* font-family: 'Volkhov', serif; */
        }

        #legend {
            text-transform: uppercase;
            margin-left: 0px;
            margin-top: 10px;
            font-weight: 400;
            font-size: 12px;
            width: 1000px;
            height: 60px;
            display:none;
            /*  letter-spacing: 0.5px */
            /* display: none; */
        }
        /* #legendNeu {
            text-transform: uppercase;
            left: 0px;
            top: 0px;
            font-weight: 400;
            font-size: 12px;
            width: 1200px;
            height: 80px;
            z-index: 600;
        } */

        /* .AuswahlFilter{
          display: block;
          margin-top: 5px;
        }

        .Benutzungsspur{
          display: inline;
          margin-right: 10px;
        }
        .Benutzungsspurb{
          display: inline;
          margin-right: 10px;
        }

        .Benutzungsspurausgefahren{
          display: block;
          margin-right: 10px;
          transform: scale(0.5, 1);
          transform-origin: left;
        }

        .Schreibhand{
          display: inline;
          margin-right: 10px;
        }

        .Schreibmedium{
          display: none;
          margin-right: 10px;
        } */

        .plusminus{
          font-size: 15px;
          margin-right: 0px;
        }

        .stempel{
          font-family: 'Stardos Stencil';
          font-size: 12px;
        }

        .handschrift{
          font-family: 'Roboto';
          font-size: 12px;
          font-weight: 300;
          /* font-style: italic; */
        }


        .eigentumsangaben {
            fill: #5B5B5B;
            color: #5B5B5B;
        }

        .markierungen {
            fill: #58b0f7;
            color:  #58b0f7;
        }

        .marginalien {
            fill: #f72652;
            color:  #f72652;
        }


        span {
            margin-right: 10px;
        }




        #header {
            z-index: 200;
            position: fixed;
            left: 125px;
            top: 0px;
            width: 100%;
            display:none;
        }


        #scrollnavi {
            z-index: 100;
            position: fixed;
            background-color: #474747;
            border-right: 1px;
            height: 100%;
            width: 80px;
            left: 0;
            top: 0px;
            box-shadow: 2px 0px 5px grey;
            padding-top: 0px;
            display:none;
        }

        #scrollnavi p {
            z-index: 100;
            font-size: 11px;
            margin-left: 5px;
            margin-top: 150px;
            margin-bottom: 150px;
            color: white;
            font-weight: 300;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        #scrollnavi svg {
            z-index: 100;
            position: fixed;
            width: 80px;
            height: 100%;
            display:none;
        }

        #headerIcons {

            z-index: 100;
            float: right;
            padding-right: 100px;
        }

        .search-container {
            float: right;
        }

        #headerIcons input[type=text] {
            padding: 4px;
            width: 160px;
            margin-top: 20px;
            font-size: 12px;
            border-width: 1px;
            border-color: lightgrey;
            border-style: solid;
        }

        .search-container button {
            float: right;
            padding: 4px 6px;
            margin-top: 20px;
            background: white;
            font-size: 12px;
            color: grey;
            border-width: 1px;
            border-color: lightgrey;
            border-style: solid;
            border-left: none;
            cursor: pointer;
        }

        .search-container button:hover {
            background: #ccc;
        }

        .headericons {
            margin-top: 20px;
            margin-right: 0px;
            margin-left: 10px;
            float: right;
            width: 26px;
            height: 26px;
              font-family: 'Roboto', sans-serif!important;
        }



        /*
        * === SEARCH BOX===
        */


        .searchiconbg {
        background-color: lightgrey;
          height: 24px;
          margin-top: 0px;
          margin-left: 13px;
        }

        #search-icon {
          position: relative;
          margin-top: 3px;
        padding-left: 5px;
          padding-right:5px;
          color:#888888;

        }

        .search {
          position: relative;
          width: 300px;
          font-size: 12px;
          margin-left: 0px;
          margin-top:20px;
          border:0;
        }



        /*
        * === SEARCH BOX===
        */

        #scroller {
            overflow: scroll;
            height: 100%;
            width: 120px;
            left: 0;
            top: 0px;
            display:none;
        }

        #svg {
          position: fixed;
            margin-left: 83px;
            left: 0;
            margin-top: 150px;
            display:none;
        }

        #svgFront {
            overflow-x: hidden;
            position: fixed;
            margin-left: 83px;
            left: 0;
            margin-top: 150px;
            pointer-events: none;
            display:none;
        }

        #svgFrontTitles {
            overflow-x: hidden;
            position: fixed;
            margin-left: 83px;
            left: 0;
            margin-top: 150px;
            pointer-events: none;
            display:  inline;
            display:none;
        }

        canvas {
            position: fixed;
            margin-left: 83px;
            left: 0;
            margin-top: 270px;
            width: 100%;
            height: 6500px;
            pointer-events: none;
            display:none;
        }


        #container {
            top: 0px;
            position: fixed;
        }

        .anstreichung {
            color: #018DC9;
            fill: #018DC9;
            cursor: pointer;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .anstreichung.eingefaltet{
            fill: #58b0f7;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .unterstreichung {
            color: #415aff;
            fill: #415aff;
            cursor: pointer;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .unterstreichung.eingefaltet{
            fill: #58b0f7;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;

        }

        .durchstreichung {
            color: #4020d0;
            fill: #4020d0;
            cursor: pointer;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .durchstreichung.eingefaltet{
            fill: #58b0f7;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .sonstigeMarkierung {
            color: #29D1E2;
            fill: #29D1E2;
            cursor: pointer;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .sonstigeMarkierung.eingefaltet{
            fill: #58b0f7;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .anderes {
            color: #ab56c4;
            fill: #ab56c4;
            cursor: pointer;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .anderes.eingefaltet{
            fill: #ab56c4;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .zusatzMaterial {
            color: rgb(72, 184, 112);
            fill: rgb(72, 184, 112);
            cursor: pointer;

        }
        .platzhalter {
            fill: #EBE3DD;
            cursor: pointer;
            stroke-width: 1px;
            stroke: #EBE3DD;

        }


        .provenienz {
            color: #575757;
            fill: #575757;
            cursor: pointer;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .provenienz.eingefaltet{
            fill: #5B5B5B;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;

        }

        .provenienzstempel {
            color: #828282;
            fill: #828282;
            cursor: pointer;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;

        }

        .provenienzstempel.eingefaltet{
            fill: #5B5B5B;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .bewertung {
            color: #F74141;
            fill: #F74141;
            cursor: pointer;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .bewertung.eingefaltet{
            fill: #f72652;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;

        }

        .kommentar {
            color: #FF8A5D;
            fill: #FF8A5D;
            cursor: pointer;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .kommentar.eingefaltet{
            fill: #f72652;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;

        }

        .textkorrektur {
            color: #8D084E;
            fill: #8D084E;
            cursor: pointer;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .textkorrektur.eingefaltet{
            fill: #f72652;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;

        }

        .uebersetzung {
            color: #f93593;
            fill: #f93593;
            cursor: pointer;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .uebersetzung.eingefaltet{
            fill: #f72652;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;

        }

        .variante {
            color: #FD9698;
            fill: #FD9698;
            cursor: pointer;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .variante.eingefaltet{
            fill: #f72652;
            -webkit-transition: fill 0.5s linear;
            -moz-transition: fill 0.5s linear;
            -o-transition: fill 0.5s linear;
            transition: fill 0.5s linear;
        }

        .leer {
            padding-left: 5px;
            padding-right: 5px;
            color: #ffffff;
            fill: #ffffff;
            background-color: rgb(206, 193, 184);
        }


        .filtered{
          fill: white!important;
          -webkit-transition: fill 0.5s linear;
          -moz-transition: fill 0.5s linear;
          -o-transition: fill 0.5s linear;
          transition: fill 0.5s linear;
        }

        .authorLabel {
            font-size: 11px;
            font-weight: 400;
        }

        .BuchTitelLabel {
            font-size: 12px;
        }

        .detailinfo {
            font-size: 12px;
            font-weight: bold;
        }

        .detail_titel {
            font-weight: bold;
        }



        .scroll-wrapper {
            position: relative;
            height: 100%;
            padding-top: 0px;
        }





        .navigationLabels {
            font-size: 11px;
            text-transform: uppercase;
        }

        #iconshare{
          margin-right: 100px;
        }
    </style>
</head>

<body>
  <div id="header">
      <div id="headerIcons">
          <img alt="share" id="iconshare" src="icons/icon-share.svg" class="headericons">
          <img alt="help" src="icons/icon-help.svg" class="headericons">
          <img alt="info" src="icons/icon-info.svg" class="headericons">


          <div class="search-container">
            <div id="search"></div>
              <!-- <input type="text" placeholder="MARGINALIEN-SUCHE" name="search"> -->
              <!-- <button type="submit"><i class="fa fa-list-ol listbutton"></i></button> -->
              <!-- <button type="submit"><i class="fa fa-search searchbutton"></i></button> -->

          </div>

      </div>

      <h1>Fontanes Handbibliothek</h1>
      <svg id="legend"></svg>
      <!-- <div id="legendNeu">
       <div class="AuswahlFilter"><p class="Benutzungsspur">Benutzungsspur-Typ:</p>
         <p class="eigentumsangaben Benutzungsspur">Eigentumsangaben<span class="plusminus">⊕</span></p> <div class="Benutzungsspurb"><p class="Benutzungsspurausgefahren"><span class="provenienz">Provenienz</span><span class="provenienzstempel">Provenienz-Stempel</span></p></div>
         <p class="markierungen Benutzungsspur">Markierungen<span class="plusminus">⊕</span></p><p class="Benutzungsspur"><span class="anstreichung">Anstreichung</span><span class="unterstreichung">Unterstreichung</span><span class="durchstreichung">Durchstreichung</span><span class="sonstigeMarkierung">Sonstige Markierung</span></p>
         <p class="marginalien Benutzungsspur">Marginalien<span class="plusminus">⊕</span></p><p class="Benutzungsspur"><span class="bewertung">Bewertung</span><span class="kommentar">Kommentar</span><span class="textkorrektur">Textkorrektur</span><span class="variante">Variante</span><span class="uebersetzung">Übersetzung</span></p>
         <p class="zusatzMaterial Benutzungsspur">Zusätzliches Material</p><p class="anderes Benutzungsspur">Anderes</p></div>
       <div class="AuswahlFilter"><p class="Schreibhand">Schreibhand:</p><p class="SchreibhandFontane Schreibhand">Theodor Fontane</p><p class="SchreibhandFamilie Schreibhand">Fontanes Familie</p><p class="SchreibhandAndere Schreibhand">Andere / Unbekannt</p></div>
       <div class="AuswahlFilter"><p class="Schreibmedium">Schreibmedium:</p></div>
      </div> -->
  </div>
  <svg id="svg"></svg>


    <div id="scrollnavi">
        <svg id="scrollSvg"></svg>
    </div>





    <!-- <div id="scrollnavi"></div> -->

    <div id="container">


    </div>


    </div>

    <script>
    //    window.scrollTo(0,(document.documentElement.scrollHeight)/2-((window.innerHeight)/2))



    setTimeout(function() {

      window.scrollTo(0, 6000)


    }, 10);






        var scroller = d3.select('body')

        window.onscroll = function(){//console.log(Math.max(window.pageYOffset, document.documentElement.scrollTop, document.body.scrollTop))
      //    console.log(scroller.node().scrollTop)
      //    console.log($(window).scrollTop())
          var scrollTop2 = Math.max(window.pageYOffset, document.documentElement.scrollTop, document.body.scrollTop)

                          newScrollTop = scrollTop2-6000
                    //      console.log(newScrollTop)




                          ////////////////////scrollnavi/
                          ////////////////////////////////////////

                          var scrollCircleScale = d3.scaleLinear()
                              .domain([-4990, 0, 2600])
                              .range([firstScrollIcon, secondScrollIcon, thirdScrollIcon-5])
                              .clamp(true)

                          d3.selectAll(".scrollCircleFollower")
                              .attr("cy", scrollCircleScale(newScrollTop))


        }

        var scrollTop = 0
        var newScrollTop = scroller.node().scrollTop - 5050 - 301
//console.log(scroller.node().scrollTop)

        scroller
            .on("scroll", function() {


              // d3.select('.tooltip')
              //     .style("display", "none")



var scrollTop2 = Math.max(window.pageYOffset, document.documentElement.scrollTop, document.body.scrollTop)


                newScrollTop = scrollTop2




                ////////////////////scrollnavi/
                ////////////////////////////////////////

                // var scrollCircleScale = d3.scaleLinear()
                //     .domain([-4990, 0, 2600])
                //     .range([40, 380, 720])
                //     .clamp(true)



                d3.selectAll(".scrollCircleFollower")
                    .attr("cy", scrollCircleScale(newScrollTop))


                ////////////////////scrollnaviEnde
                ////////////////////////////////////////
            })





        // === Set up canvas === //

        var width = window.innerWidth - 100//1300,
        var height = window.innerHeight - 120//680;
      //  console.log(width)
      //  console.log(height)

        //Retina function
        function getRetinaRatio() {
            var devicePixelRatio = window.devicePixelRatio || 1
            var c = document.createElement('canvas').getContext('2d')
            var backingStoreRatio = [
                c.webkitBackingStorePixelRatio,
                c.mozBackingStorePixelRatio,
                c.msBackingStorePixelRatio,
                c.oBackingStorePixelRatio,
                c.backingStorePixelRatio,
                1
            ].reduce(function(a, b) {
                return a || b
            })

            return devicePixelRatio / backingStoreRatio
        }

        var ratio = getRetinaRatio()
        var scaledWidth = width * ratio
        var scaledHeight = height * ratio

        //Retina function ende

        var data = [];
        var value = 5000;
        var colourScale;

        var thisVerfasser = 0
        var thisVerfasserSelected = "Fontane, Theodor"



        var tooltip = d3.select("body")
            .append("div")
            .style("position", "absolute")
            .style("z-index", "300")
            .style("display", "none")
            .attr("width", 200)
            .attr("class", "tooltip")

        tooltip.append("img").attr("width", 200).attr("height", "auto")

        // var tooltipTitle = d3.select("body")
        //     .append("div")
        //     .style("position", "absolute")
        //     .style("z-index", "300")
        //     .style("display", "none")
        //     .attr("width", 20)
        //     .attr("height", 600)
        //     .attr("top", 400)
        //     .attr("background-color", "black")
        //     .attr("class", "tooltipTitle")






        var svg = d3.select("#svg")
            .style('width', width + 'px')
            .style('height', height + 'px')

        var svgFront = d3.select("#svgFront")
            .style('width', width + 'px')
            .style('height', height + 'px')

            var svgFrontTitles = d3.select("#svgFrontTitles")
                .style('width', width + 'px')
                .style('height', height + 'px')


        var scrollSvg = d3.select("#scrollSvg")

        var firstScrollIcon = 40
        var secondScrollIcon = window.innerHeight/2
        var thirdScrollIcon = window.innerHeight - 40

        var scrollBgLines = scrollSvg.append("g").attr("transform", "translate(39,-5)")
        var scrollCircles = scrollSvg.append("g").attr("transform", "translate(40,-5)")
        var scrollIcons = scrollSvg.append("g").attr("transform", "translate(0,-18)")
        var scrollLabels = scrollSvg.append("g").attr("transform", "translate(58,-5)")


        scrollBgLines.append("line")
            .attr("x1", 0)
            .attr("x2", 4)
            .attr("y1", firstScrollIcon)
            .attr("y2", thirdScrollIcon)
            .attr("stroke", "white")
            .style("opacity", 0.3)
            .attr("class", "firstScrollLine")

        scrollBgLines.append("line")
            .attr("x1", 22)
            .attr("x2", 18)
            .attr("y1", firstScrollIcon)
            .attr("y2", thirdScrollIcon)
            .attr("stroke", "white")
            .style("opacity", 0.3)
            .attr("class", "secondScrollLine")




        // scrollLabels.append("text").text("Autor/In")
        // .attr("y", 45)
        // .attr("x", 10)
        // .attr("fill", "white")
        // .attr("class", "navigationLabels")
        // .style("cursor", "pointer")
        // .on("click", function(){
        // 	$("body").animate({scrollTop:0}, '2000')})


        scrollIcons.append("image")
            .attr("xlink:href", "icons/authorlevel.svg")
            .attr("y", firstScrollIcon+5)
            .attr("x", 10)
            .attr("width", 20)
            .attr("height", 20)
            .style("cursor", "pointer")
            .on("click", function() {
                $("html,body").animate({
                    scrollTop: 0
                }, '3000')
            })
            .attr("class", "autorIcon")

        // scrollLabels.append("text").text("Buch")
        // .attr("y", 385)
        // .attr("x", 10)
        // .attr("fill", "white")
        // .attr("class", "navigationLabels")
        // .style("cursor", "pointer")
        // .on("click", function(){
        // 	$("body").animate({scrollTop:5351}, '2000')})

        scrollIcons.append("image")
            .attr("xlink:href", "icons/buchlevel.svg")
            .attr("y", secondScrollIcon+5)
            .attr("x", 10)
            .attr("width", 20)
            .attr("height", 20)
            .style("cursor", "pointer")
            .on("click", function() {
                $("html,body").animate({
                    scrollTop: 6000
                }, '3000')
            })
            .attr("class", "buchIcon")


        // scrollLabels.append("text").text("Seiten")
        // .attr("y", 725)
        // .attr("x", 10)
        // .attr("fill", "white")
        // .attr("class", "navigationLabels")
        // .style("cursor", "pointer")
        // .on("click", function(){
        // 	$("body").animate({scrollTop:8000}, '2000')})


        scrollIcons.append("image")
            .attr("xlink:href", "icons/seitenlevel.svg")
            .attr("y", thirdScrollIcon)
            .attr("x", 10)
            .attr("width", 20)
            .attr("height", 20)
            .style("cursor", "pointer")
            .on("click", function() {
              $("html,body").animate({
                    scrollTop: 9000
                }, '3000')
            })
            .attr("class", "seitenIcon")

        scrollCircles.append("circle")
            .attr("r", 11)
            .attr("cx", 10)
            .attr("cy", firstScrollIcon)
            .attr("stroke", "white")
            .attr("fill", "#474747")
            .style("cursor", "pointer")
            .on("click", function() {
                $("html,body").animate({
                    scrollTop: 0
                }, '3000')
            })

        scrollCircles.append("circle")
            .attr("r", 9)
            .attr("cx", 10)
            .attr("cy", secondScrollIcon)
            .attr("stroke", "white")
            .attr("fill", "#474747")
            .style("cursor", "pointer")
            .on("click", function() {
              $("html,body").animate({
                    scrollTop: 6000
                }, '3000')
            })
            .attr("class", "secondScrollCircle")

        scrollCircles.append("circle")
            .attr("r", 7)
            .attr("cx", 10)
            .attr("cy", thirdScrollIcon-5)
            .attr("stroke", "white")
            .attr("fill", "#474747")
            .style("cursor", "pointer")
            .on("click", function() {
              $("html,body").animate({
                    scrollTop: 9000
                }, '3000')
            })
            .attr("class", "thirdScrollCircle")

        var scrollCircleFollower = scrollCircles.append("circle")
            .attr("r", 5)
            .attr("cx", 10)
            .attr("cy", secondScrollIcon)
            .attr("fill", "white")
            .attr("class", "scrollCircleFollower")
            .attr("cursor", "grab")
            .call(d3.drag()
             .on("start", dragstarted)
             .on("drag", dragged)
             .on("end", dragended));

      function dragstarted(d) {
       d3.select(this).raise().classed("active", true)
       .attr("cursor", "grabbing")
      }

      function dragged(d) {
       d3.select(this).attr("cy", function(){if(d3.event.y < 40){return "40px"} else if(d3.event.y > thirdScrollIcon-5){return thirdScrollIcon-5}else {return d3.event.y}});
       window.scrollTo(0, scrollCircleScaleReverse(d3.event.y))
      }

      function dragended(d) {
       d3.select(this).classed("active", false)
       .attr("cursor", "grab")
      }


      var scrollCircleScaleReverse = d3.scaleLinear()
              .domain([firstScrollIcon, secondScrollIcon, thirdScrollIcon-5])
              .range([0, 6000, 9000])
              .clamp(true)



        //Real visible canvas
        var canvas = d3.select('#container')
            .append('canvas')
            .attr("id", "canvas")
            .attr('width', scaledWidth)
            .attr('height', scaledHeight)
            .style('width', width + 'px')
            .style('height', height + 'px')
        //	.style("display","none");

        var context = canvas.node().getContext('2d');
        context.scale(ratio, ratio)



        var svgFront = d3.select('body')
            .append("svg")
            .attr("id", "svgFront")
            .style('width', width + 'px')
            .style('height', height + "px")

            var svgFrontTitles = d3.select('body')
                .append("svg")
                .attr("id", "svgFrontTitles")
                .style('width', width + 'px')
                .style('height', height + "px")




        //Create a custom element, that will not be attached to the DOM, to which we can bind the data
        var detachedContainer = document.createElement("custom");
        var dataContainer = d3.select(detachedContainer);


        var transitions = false

        ///Load data
      //  d3.csv("data/data.csv", function(error, dataset) {

      Promise.all([
        d3.csv("data/data.csv"),
        d3.csv("data/korpus.csv"),
      ])
      .then(([dataset, korpus]) =>  {
      //   console.log(dataset)
         console.log(korpus)
      // });
      //
      //   d3.csv("data/data.csv").then(function(dataset) {












///////////////////search
var searchDaten = [
    {
      "text": "Group 1",
      "children" : [
        {
            "id": 1,
            "text": "Option 1.1"
        },
        {
            "id": 2,
            "text": "Option 1.2"
        }
      ]
    },
    {
      "text": "Group 2",
      "children" : [
        {
            "id": 3,
            "text": "Option 2.1"
        },
        {
            "id": 4,
            "text": "Option 2.2"
        }
      ]
    }
  ]

var searchDatenCreator  = dataset.filter(function(d){return d.SchriftspurTranskription!= "null" && d.SchriftspurTyp != "P"})

var searchDaten = []
searchDatenCreator.forEach(function(D,I){
  searchDaten.push({
    id: I,
    text: D.SchriftspurTranskription
  })
})


$("#search").select2({
  data: searchDaten,
  containerCssClass: "search",
  selectOnClose: true,
  placeholder: "MARGINALIEN-SUCHE / MARGINALIEN-ÜBERSICHT",
  allowClear: true

});


$("#search").on("select2-clearing", function(e) {
  selectedStichwort = ""
  selectedPerson = ""
  jahrAuswahl = ""
  minyeartotal = "1895"
  maxyeartotal = "1933"
  JahrUpdate()
  arcUpdate()
  timelineUpdate()
  auswahlAnzeigeUpdate()

})









            setTimeout(function() {
              hashLoad()
            }, 50);




            var datensatzAll = dataset //.filter(function(d,i){return d.Benutzungsspur != "null"})
            //	console.log(dataset)

            var datenByAuthor = d3.nest()
                .key(function(d) {
                    if (+d.AuthorCount > 1) {
                        return d.Verfasser
                    } else {
                        return "Sonstige"
                    }
                })
                .entries(dataset);

            datenByAuthor.forEach(function(D, I) {
                D.values = d3.nest()
                    .key(function(d) {
                        return d.BookID;
                    })
                    .entries(D.values);
            })

        //    console.log(datenByAuthor)



            var datenByTitle = d3.nest()
                .key(function(d) {
                    return d.BookID;
                })
                .entries(dataset);

            datenByTitle.forEach(function(D, I) {
                D.authorCount = +D.values[0].AuthorCount //.values.length

            })



           var countSpuren = []

           datenByTitle.forEach(function(D,I){
            countSpuren.push({
              id: I,
              book: D.key
            })

           })

           console.table(countSpuren)

            //console.log(datenByTitle)
            //////////legend///////////////////////////////////////
            ////////////////////////////////////////////////////////////
            ////////////////////////////////////////////////////////////
            //////////////////////////////////////////////////////////////

            var filter = null
            var eigentumsangabenEntfaltet = false
            var markierungenEntfaltet = false
            var marginalienEntfaltet = false

            var legend = d3.select("#legend")

            legend.append("text")
            .text("Schriftspur-Typ")
            .style("font-weight", "bold")
            .style("letter-spacing", "1px")
            .attr("y", 36)
            .attr("x", 0)

            var eigentumsangaben = legend.append("g")
                .attr("class", "eigentumsangaben")
                .style("cursor", "pointer")
                .attr("transform", "translate(135,0)")

                eigentumsangaben.append("text")
                .attr("y", 36)

            var zusatzMaterial = legend.append("g")
                .attr("class", "zusatzMaterial")
                .style("cursor", "pointer")
                .attr("transform", "translate(555,0)")



            var anderes = legend.append("g")
                    .attr("class", "anderes")
                    .style("cursor", "pointer")
                    .attr("transform", "translate(725,0)")

            var markierungen = legend.append("g")
                .attr("class", "markierungen")
                .style("cursor", "pointer")
                .attr("transform", "translate(300,0)")

                markierungen.append("text")
                .attr("y", 36)

            var marginalien = legend.append("g")
                .attr("class", "marginalien")
                .style("cursor", "pointer")
                .attr("transform", "translate(435,0)")

                marginalien.append("text")
                .attr("y", 36)


            var marginalienVerfasser = legend.append("g")
                .attr("class", "marginalienVerfasser")
                .style("cursor", "pointer")

                marginalienVerfasser.append("text")
                .text("Marginalien Schreibhand")
                .style("font-weight", "bold")
                .style("cursor", "auto")
                .style("letter-spacing", "1px")
                .attr("y", 14)
                .attr("x", 0)

              //  var SchreibhandFilter = null

                marginalienVerfasser.append("text")
                .text("Theodor Fontane")
                .attr("y", 14)
                .attr("x", 200)
                .on("click", function(){
                  if(filter != "Fontane"){
                    filter = "Fontane"
                    filterInteraction()
                  }else{
                    filter = null
                    filterInteraction()
                  }
                })

                marginalienVerfasser.append("text")
                .text("Fontanes Familie")
                .attr("y", 14)
                .attr("x", 330)
                .on("click", function(){
                  if(filter != "Familie"){
                    filter = "Familie"
                    filterInteraction()
                  }else{
                    filter = null
                    filterInteraction()
                  }
                })

                marginalienVerfasser.append("text")
                .text("Andere / Unbekannt")
                .attr("y", 14)
                .attr("x", 460)
                .on("click", function(){
                  if(filter != "Unbekannt"){
                    filter = "Unbekannt"
                    filterInteraction()
                  }else{
                    filter = null
                    filterInteraction()
                  }
                })

                ////////////////Provenienz-Filter Start
                ///////////////////////////////////////////////


                eigentumsangaben.select("text").append("tspan")
                    .text("Provenienzangaben")
                    .attr("class", "EigentumsangabenFilter")
                    .on("click", function() {
                      if (filter != "eigentumsangaben"){
                        filter = "eigentumsangaben"
                        eigentumsangabenEntfaltet = true


                        farbausfaltungProvenienz()
                        filterInteraction()
                        eigentumsangaben.selectAll(".EigentumsangabenPlus").text(" ⊖")
                        markierungen.selectAll(".MarkierungenPlus").text(" ⊕")
                        marginalien.selectAll(".MarginalienPlus").text(" ⊕")
                        eigentumsangaben.selectAll("text").style("font-weight", "bolder").style("opacity", 1)
                        zusatzMaterial.selectAll("text").style("font-weight", "400").style("opacity",.6)
                        marginalien.selectAll("text").style("font-weight", "400").style("opacity", .6)
                        markierungen.selectAll("text").style("font-weight", "400").style("opacity", .6)

                        eigentumsangabendetail.transition().duration(800).attr("transform", "scale(1,1)").style("opacity", 1)
                        markierungendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 1)
                        marginaliendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 1)

                      }
                      else {
                        filter = null
                        eigentumsangabenEntfaltet = false

                        farbeinfaltungProvenienz()
                        filterInteraction()
                        eigentumsangaben.selectAll(".EigentumsangabenPlus").text(" ⊕")
                        zusatzMaterial.selectAll("text").style("font-weight", "400").style("opacity", 1)
                        marginalien.selectAll("text").style("font-weight", "400").style("opacity", 1)
                        markierungen.selectAll("text").style("font-weight", "400").style("opacity", 1)
                        eigentumsangaben.selectAll("text").style("font-weight", "400").style("opacity", 1)
                        eigentumsangabendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 0)
                        }

                    })

                eigentumsangaben.select("text").append("tspan")
                    .text(" ⊕")
                    .attr("class", "EigentumsangabenPlus")
                    .style("font-size", 17 + "px")
                    // .on("click", function() {
                    //   if (eigentumsangabenEntfaltet == false){
                    //     eigentumsangabenEntfaltet = true
                    //
                    //     farbausfaltungProvenienz()
                    //     eigentumsangaben.selectAll(".EigentumsangabenPlus").text(" ⊖")
                    //     eigentumsangaben.selectAll("text").style("font-weight", "bolder")
                    //     eigentumsangabendetail.transition().duration(800).attr("transform", "scale(1,1)").style("opacity", 1)
                    //   }
                    //   else {
                    //     eigentumsangabenEntfaltet = false
                    //
                    //     farbeinfaltungProvenienz()
                    //     eigentumsangaben.selectAll(".EigentumsangabenPlus").text(" ⊕")
                    //     eigentumsangaben.selectAll("text").style("font-weight", "500")
                    //     eigentumsangabendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 0)
                    //     }
                    // })



                                var eigentumsangabendetail = eigentumsangaben.append("g").attr("class", "detail").attr("transform", "scale(0,1)").style("opacity", 0)

                                eigentumsangabendetail.append("text")
                                    .text("Schriftl. Provenienzangaben")
                                    .attr("y", 50)
                                    .attr("x", 0)
                                    .attr("class", "provenienz")
                                    .on("click", function(){
                                      if(filter != "provenienz"){
                                        filter = "provenienz"
                                        filterInteraction()
                                      }else{
                                        filter = null
                                        filterInteraction()
                                      }
                                    })


                                eigentumsangabendetail.append("text")
                                    .text("Provenienz-Stempel")
                                    .attr("y", 50)
                                    .attr("x", 210)
                                    .attr("class", "provenienzstempel")
                                    .on("click", function(){
                                      if(filter != "provenienzstempel"){
                                        filter = "provenienzstempel"
                                        filterInteraction()
                                      }else{
                                        filter = null
                                        filterInteraction()
                                      }
                                    })


////////////////Provenienz-Filter Ende
///////////////////////////////////////////////


////////////////Markierung-Filter Start
///////////////////////////////////////////////

            markierungen.select("text").append("tspan")
                .text("Markierungen")
                .attr("class", "MarkierungFilter")
                .on("click", function() {
                  if (filter != "markierungen"){
                    filter = "markierungen"
                    markierungenEntfaltet = true

                    farbausfaltungMarkierung()
                    filterInteraction()
                    eigentumsangaben.selectAll(".EigentumsangabenPlus").text(" ⊕")
                    markierungen.selectAll(".MarkierungenPlus").text(" ⊖")
                    marginalien.selectAll(".MarginalienPlus").text(" ⊕")
                    markierungen.selectAll("text").style("font-weight", "bolder").style("opacity", 1)
                    zusatzMaterial.selectAll("text").style("font-weight", "400").style("opacity", .6)
                    marginalien.selectAll("text").style("font-weight", "400").style("opacity", .6)
                    eigentumsangaben.selectAll("text").style("font-weight", "400").style("opacity", .6)

                    eigentumsangabendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 1)
                    markierungendetail.transition().duration(800).attr("transform", "scale(1,1)").style("opacity", 1)
                    marginaliendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 1)


                  }
                  else {
                    filter = null
                    markierungenEntfaltet = false

                    farbeinfaltungMarkierung()
                    filterInteraction()
                    markierungen.selectAll(".MarkierungenPlus").text(" ⊕")
                    zusatzMaterial.selectAll("text").style("font-weight", "400").style("opacity", 1)
                    marginalien.selectAll("text").style("font-weight", "400").style("opacity", 1)
                    markierungen.selectAll("text").style("font-weight", "400").style("opacity", 1)
                    eigentumsangaben.selectAll("text").style("font-weight", "400").style("opacity", 1)
                    markierungendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 0)
                    }
                })




            markierungen.select("text").append("tspan")
                .text(" ⊕")
                .attr("class", "MarkierungenPlus")
                .style("font-size", 17 + "px")
                // .on("click", function() {
                //   if (markierungenEntfaltet == false){
                //     markierungenEntfaltet = true
                //
                //     farbausfaltungMarkierung()
                //     markierungen.selectAll(".MarkierungenPlus").text(" ⊖")
                //     markierungen.selectAll("text").style("font-weight", "bolder")
                //     markierungendetail.transition().duration(800).attr("transform", "scale(1,1)").style("opacity", 1)
                //   }
                //   else {
                //   markierungenEntfaltet = false
                //
                //     farbeinfaltungMarkierung()
                //     markierungen.selectAll(".MarkierungenPlus").text(" ⊕")
                //     markierungen.selectAll("text").style("font-weight", "500")
                //     markierungendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 0)
                //     }
                // })

            var markierungendetail = markierungen.append("g").attr("class", "detail").attr("transform", "scale(0,1)").style("opacity", 0)

            markierungendetail.append("text")
                .text("Anstreichung")
                .attr("y", 50)
                .attr("x", 0)
                .attr("class", "anstreichung")
                .on("click", function(){
                  if(filter != "anstreichung"){
                    filter = "anstreichung"
                    filterInteraction()
                  }else{
                    filter = null
                    filterInteraction()
                  }
                })

            markierungendetail.append("text")
                .text("Unterstreichung")
                .attr("y", 50)
                .attr("x", 110)
                .attr("class", "unterstreichung")
                .on("click", function(){
                  if(filter != "unterstreichung"){
                    filter = "unterstreichung"
                    filterInteraction()
                  }else{
                    filter = null
                    filterInteraction()
                  }
                })

            markierungendetail.append("text")
                .text("Durchstreichung")
                .attr("y", 50)
                .attr("x", 240)
                .attr("class", "durchstreichung")
                .on("click", function(){
                  if(filter != "durchstreichung"){
                    filter = "durchstreichung"
                    filterInteraction()
                  }else{
                    filter = null
                    filterInteraction()
                  }
                })

            markierungendetail.append("text")
                .text("Sonstige Markierung")
                .attr("y", 50)
                .attr("x", 370)
                .attr("class", "sonstigeMarkierung")
                .on("click", function(){
                  if(filter != "sonstigeMarkierung"){
                    filter = "sonstigeMarkierung"
                    filterInteraction()
                  }else{
                    filter = null
                    filterInteraction()
                  }
                })

            // markierungendetail.append("text")
            //     .text("Anderes")
            //     .attr("y", 50)
            //     .attr("x", 530)
            //     .attr("class", "anderes")
            //     .on("click", function(){
            //       if(filter != "anderes"){
            //         filter = "anderes"
            //         filterInteraction()
            //       }else{
            //         filter = null
            //         filterInteraction()
            //       }
            //     })



                ////////////////Markierung-Filter Ende
                ///////////////////////////////////////////////

                ////////////////Marginalien-Filter Start
                ///////////////////////////////////////////////

                            marginalien.select("text").append("tspan")
                                .text("Marginalien")
                                .attr("class", "MarginalienFilter")
                                .on("click", function() {
                                  if (filter != "marginalien"){
                                    filter = "marginalien"
                                    marginalienEntfaltet = true

                                    farbausfaltungMarginalien()
                                    filterInteraction()
                                    marginalien.selectAll(".MarginalienPlus").text(" ⊖")
                                    marginalien.selectAll("text").style("font-weight", "bolder")
                                    marginaliendetail.transition().duration(800).attr("transform", "scale(1,1)").style("opacity", 1)

                                    eigentumsangaben.selectAll(".EigentumsangabenPlus").text(" ⊕")
                                    markierungen.selectAll(".MarkierungenPlus").text(" ⊕")
                                    marginalien.selectAll(".MarginalienPlus").text(" ⊖")
                                    marginalien.selectAll("text").style("font-weight", "bolder").style("opacity", 1)
                                    zusatzMaterial.selectAll("text").style("font-weight", "400").style("opacity", .6)
                                    markierungen.selectAll("text").style("font-weight", "400").style("opacity", .6)
                                    eigentumsangaben.selectAll("text").style("font-weight", "400").style("opacity", .6)

                                    eigentumsangabendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 1)
                                    markierungendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 1)
                                    marginaliendetail.transition().duration(800).attr("transform", "scale(1,1)").style("opacity", 1)


                                  }
                                  else {
                                    filter = null
                                    marginalienEntfaltet = false

                                    farbeinfaltungMarginalien()
                                    filterInteraction()
                                    marginalien.selectAll(".MarginalienPlus").text(" ⊕")
                                    zusatzMaterial.selectAll("text").style("font-weight", "400").style("opacity", 1)
                                    marginalien.selectAll("text").style("font-weight", "400").style("opacity", 1)
                                    markierungen.selectAll("text").style("font-weight", "400").style("opacity", 1)
                                    eigentumsangaben.selectAll("text").style("font-weight", "400").style("opacity", 1)
                                    marginaliendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 0)
                                    }
                                })


                            marginalien.select("text").append("tspan")
                                .attr("class", "MarginalienPlus")
                                .text(" ⊕")
                                .style("font-size", 17 + "px")
                                // .on("click", function() {
                                //   if (marginalienEntfaltet == false){
                                //     marginalienEntfaltet = true
                                //
                                //     farbausfaltungMarginalien()
                                //     marginalien.selectAll(".MarginalienPlus").text(" ⊖")
                                //     marginalien.selectAll("text").style("font-weight", "bolder")
                                //     marginaliendetail.transition().duration(800).attr("transform", "scale(1,1)").style("opacity", 1)
                                //   }
                                //   else {
                                //     marginalienEntfaltet = false
                                //
                                //     farbeinfaltungMarginalien()
                                //     marginalien.selectAll(".MarginalienPlus").text(" ⊕")
                                //     marginalien.selectAll("text").style("font-weight", "500")
                                //     marginaliendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 0)
                                //     }
                                // })

            var marginaliendetail = marginalien.append("g").attr("class", "detail").attr("transform", "scale(0,1)").style("opacity", 0)

            marginaliendetail.append("text")
                .text("Bewertung")
                .attr("y", 50)
                .attr("x", 0)
                .attr("class", "bewertung")
                .on("click", function(){
                  if(filter != "bewertung"){
                    filter = "bewertung"
                    filterInteraction()
                  }else{
                    filter = null
                    filterInteraction()
                  }
                })

            marginaliendetail.append("text")
                .text("Kommentar")
                .attr("y", 50)
                .attr("x", 90)
                .attr("class", "kommentar")
                .on("click", function(){
                  if(filter != "kommentar"){
                    filter = "kommentar"
                    filterInteraction()
                  }else{
                    filter = null
                    filterInteraction()
                  }
                })

            marginaliendetail.append("text")
                .text("Textkorrektur")
                .attr("y", 50)
                .attr("x", 190)
                .attr("class", "textkorrektur")
                .on("click", function(){
                  if(filter != "textkorrektur"){
                    filter = "textkorrektur"
                    filterInteraction()
                  }else{
                    filter = null
                    filterInteraction()
                  }
                })

            marginaliendetail.append("text")
                .text("Variante")
                .attr("y", 50)
                .attr("x", 310)
                .attr("class", "variante")
                .on("click", function(){
                  if(filter != "variante"){
                    filter = "variante"
                    filterInteraction()
                  }else{
                    filter = null
                    filterInteraction()
                  }
                })

            marginaliendetail.append("text")
                .text("Übersetzung")
                .attr("y", 50)
                .attr("x", 390)
                .attr("class", "uebersetzung")
                .on("click", function(){
                  if(filter != "uebersetzung"){
                    filter = "uebersetzung"
                    filterInteraction()
                  }else{
                    filter = null
                    filterInteraction()
                  }
                })

                ////////////////Marginalien-Filter Ende
                ///////////////////////////////////////////////

            zusatzMaterial.append("text")
                .text("Zusätzliches Material")
                .attr("y", 36)
              //  .attr("x", 600)
                .on("click", function(){
                  if(filter != "zusatzMaterial"){
                    filter = "zusatzMaterial"
                    filterInteraction()
                    eigentumsangaben.selectAll(".EigentumsangabenPlus").text(" ⊕")
                    markierungen.selectAll(".MarkierungenPlus").text(" ⊕")
                    marginalien.selectAll(".MarginalienPlus").text(" ⊕")
                    zusatzMaterial.selectAll("text").style("font-weight", "bolder").style("opacity", 1)
                    marginalien.selectAll("text").style("font-weight", "400").style("opacity", .6)
                    markierungen.selectAll("text").style("font-weight", "400").style("opacity", .6)
                    eigentumsangaben.selectAll("text").style("font-weight", "400").style("opacity", .6)

                    eigentumsangabendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 1)
                    markierungendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 1)
                    marginaliendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 1)
                  }else{
                    filter = null
                    filterInteraction()
                    zusatzMaterial.selectAll("text").style("font-weight", "400").style("opacity", 1)
                    marginalien.selectAll("text").style("font-weight", "400").style("opacity", 1)
                    markierungen.selectAll("text").style("font-weight", "400").style("opacity", 1)
                    eigentumsangaben.selectAll("text").style("font-weight", "400").style("opacity", 1)
                  }
                })



                anderes.append("text")
                    .text("Anderes")
                    .attr("y", 36)
                  //  .attr("x", 600)
                    .on("click", function(){
                      if(filter != "anderes"){
                        filter = "anderes"
                        filterInteraction()
                        eigentumsangaben.selectAll(".EigentumsangabenPlus").text(" ⊕")
                        markierungen.selectAll(".MarkierungenPlus").text(" ⊕")
                        marginalien.selectAll(".MarginalienPlus").text(" ⊕")
                        zusatzMaterial.selectAll("text").style("font-weight", "bolder").style("opacity", 1)
                        marginalien.selectAll("text").style("font-weight", "400").style("opacity", .6)
                        markierungen.selectAll("text").style("font-weight", "400").style("opacity", .6)
                        eigentumsangaben.selectAll("text").style("font-weight", "400").style("opacity", .6)

                        eigentumsangabendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 1)
                        markierungendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 1)
                        marginaliendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 1)
                      }else{
                        filter = null
                        filterInteraction()
                        zusatzMaterial.selectAll("text").style("font-weight", "400").style("opacity", 1)
                        marginalien.selectAll("text").style("font-weight", "400").style("opacity", 1)
                        markierungen.selectAll("text").style("font-weight", "400").style("opacity", 1)
                        eigentumsangaben.selectAll("text").style("font-weight", "400").style("opacity", 1)
                      }
                    })




            ////////////////////////////////////////////////////////////
            ////////////////////////////////////////////////////////////
            //////////////////////////////////////////////////////////////

            var clickedBook = 0



            var marginleft = 42
            var marginright = 30

            var xOffset = 2

            var posY = 120
            var posYCanvas = 0

            var BuchAnzahl = datenByTitle.length
            var authorAnzahl = datenByAuthor.filter(function(d, i) {
                return d.values[0].values[0].AuthorCount > 1
            }).length + 1


            var chartArea = width - marginleft - marginright
            var areaheight = (window.innerHeight - 310)
            ///Buch-Ebene Größen und Abstände

            var pageheight = areaheight/1674

            if(window.innerWidth >=1800){
              var buchBreite = 8
            }else if(window.innerWidth < 1800 && window.innerWidth >= 1600){
              var buchBreite = 7
            }else if(window.innerWidth < 1600 && window.innerWidth >= 1400){
              var buchBreite = 6
            }else if(window.innerWidth < 1400 && window.innerWidth >= 1200){
              var buchBreite = 3
            }else if(window.innerWidth < 1200 && window.innerWidth >= 1100){
              var buchBreite = 4
            }else if(window.innerWidth < 1100){
              var buchBreite = 4
            }






            if(window.innerWidth >=1200){
              var buchBgBreite = 2 + buchBreite
            }else {
                var buchBgBreite = 1+ buchBreite
            }

            var totalBuchWidth = buchBgBreite * BuchAnzahl
            var authorAbstand = ((chartArea - totalBuchWidth) + (buchBgBreite * authorAnzahl)) / authorAnzahl

            ///Author-Ebene Größen und Abstände
            var authorLevelAbstand = 15

            ///Seiten-Ebene Größen und Abstände
            var sLBuchAbstand = chartArea / authorAnzahl
          //  var sLAuthorAbstand = 120 //???
            //var sLAuthorAbstand2 = 30
            var sLBuchAbstandSelected = 24 //55
            var sLBuchBreiteSelected = 20
            var sLSeitenAbstandSelected = 0 //sLBuchBreiteSelected+0.5

            var sLBuchAbstandUnselected = 4
            var sLBuchBreiteUnselected = 3
            var thisVerfasserSelectedBookCount = datenByAuthor.filter(function(d, i) {
                return d.key == "Fontane, Theodor"
            })[0].values.length
            var sLTotalBuchWidthSelected = thisVerfasserSelectedBookCount * sLBuchAbstandSelected
            var sLTotalBuchWidthUnselected = (BuchAnzahl - thisVerfasserSelectedBookCount) * sLBuchAbstandUnselected
            var sLAuthorAbstand2 = (chartArea+100 - (sLTotalBuchWidthSelected + sLTotalBuchWidthUnselected)) / (authorAnzahl-1)


            ///Setting für Buch-buchauswahl

                var selectedBookBuchlevel = 20
                var selectedBookSeitenlevel = 30

                var BuchauswahlFeld = 420
                var BuchauswahlFeldSeitenFeld = 600

                var unselectedBookSameAuthorBuchlevel = 3
                var unselectedBookSameAuthorSeitenlevel = 3


                                var unselectedBookBuchlevel = 5
                                var unselectedBookSeitenlevel = 3

                var onSelectionBuchAbstand = 7






//////////////Rezize Function Start
$(window).resize(function() {
  width = window.innerWidth - 100//1300,
  height = window.innerHeight - 120//680;


  ratio = getRetinaRatio()
   scaledWidth = width * ratio
  caledHeight = height * ratio

  chartArea = width - marginleft - marginright
  areaheight = (window.innerHeight - 310)
  ///Buch-Ebene Größen und Abstände

  //console.log(areaheight)


  svg = d3.select("#svg")
      .style('width', width + 'px')
      .style('height', height + 'px')

  svgFront = d3.select("#svgFront")
      .style('width', width + 'px')
      .style('height', height + 'px')

  svgFrontTitles = d3.select("#svgFrontTitles")
          .style('width', width + 'px')
          .style('height', height + 'px')


        firstScrollIcon = 40
        secondScrollIcon = window.innerHeight/2
        thirdScrollIcon = window.innerHeight - 40


        d3.select(".firstScrollLine")
            .attr("y1", firstScrollIcon)
            .attr("y2", thirdScrollIcon)

        d3.select(".secondScrollLine")
            .attr("y1", firstScrollIcon)
            .attr("y2", thirdScrollIcon)


            d3.select(".autorIcon")
            .attr("y", firstScrollIcon+5)


            d3.select(".buchIcon")
            .attr("y", secondScrollIcon+5)

            d3.select(".secondScrollCircle")
                .attr("cy", secondScrollIcon)

        d3.select(".seitenIcon")
          .attr("y", thirdScrollIcon)

          d3.select(".thirdScrollCircle")
              .attr("cy", thirdScrollIcon-5)


              scrollCircleScale = d3.scaleLinear()
                  .domain([-4990, 0, 2600])
                  .range([firstScrollIcon, secondScrollIcon, thirdScrollIcon-5])
                  .clamp(true)

              d3.selectAll(".scrollCircleFollower")
                  .attr("cy", scrollCircleScale(newScrollTop))

  pageheight = areaheight/1674


  if(window.innerWidth >=1800){
    buchBreite = 8
  }else if(window.innerWidth < 1800 && window.innerWidth >= 1600){
    buchBreite = 7
  }else if(window.innerWidth < 1600 && window.innerWidth >= 1400){
    buchBreite = 6
  }else if(window.innerWidth < 1400 && window.innerWidth >= 1200){
    buchBreite = 5
  }else if(window.innerWidth < 1200 && window.innerWidth >= 1100){
    buchBreite = 3
  }else if(window.innerWidth < 1100){
    buchBreite = 2
  }

  buchBgBreite = 2 + buchBreite
  totalBuchWidth = buchBgBreite * BuchAnzahl
  authorAbstand = ((chartArea - totalBuchWidth) + (buchBgBreite * authorAnzahl)) / authorAnzahl

  ///Author-Ebene Größen und Abstände


  ///Seiten-Ebene Größen und Abstände
  sLBuchAbstand = chartArea / authorAnzahl
  //  var sLAuthorAbstand = 120 //???
  //var sLAuthorAbstand2 = 30



  sLTotalBuchWidthSelected = thisVerfasserSelectedBookCount * sLBuchAbstandSelected
  sLTotalBuchWidthUnselected = (BuchAnzahl - thisVerfasserSelectedBookCount) * sLBuchAbstandUnselected
  sLAuthorAbstand2 = (chartArea+100 - (sLTotalBuchWidthSelected + sLTotalBuchWidthUnselected)) / (authorAnzahl-1)


  totalAreaChartsWidth = 0
  datenByAuthor.forEach(function(D, I) {
    totalAreaChartsWidth= totalAreaChartsWidth + xAreaMax*D.maxTraceNumberNorm
  })
  authorLevelAbstand = (chartArea - totalAreaChartsWidth)/authorAnzahl


  areachartGroup.selectAll("line")
      .attr("y1", 0)
      .attr("y2", areaheight)

//areachart.selectAll("path").remove()


yArea = d3.scaleLinear()
    .range([0, (areaheight / 21)]);

xArea = d3.scaleLinear()
    .range([0, xAreaMax]);




area = d3.area()
    .y(function(d, i) {
        return yArea(d.data.part)
    })
    .x0(function(d) {
      var areaChartXPos = 50//Number(dataContainer.selectAll(".bookFingerprint").filter(function(D){return D.values[0].Verfasser == d.data.Verfasser || D.values[0].Verfasser == "[Black, Adam u. Charles]"}).attr("transform").replace("translate(", "").split(',')[0])
        return xArea(d[0]);
    })
    .x1(function(d) {
      var areaChartXPos = 50//Number(dataContainer.selectAll(".bookFingerprint").filter(function(D){return D.values[0].Verfasser == d.data.Verfasser || D.values[0].Verfasser == "[Black, Adam u. Charles]"}).attr("transform").replace("translate(", "").split(',')[0])

        return xArea(d[1]);
    })
    .curve(d3.curveBasis)

areachart.selectAll("path")
  //  .attr("id", console.log(area))
    .attr("d", area)
    // .attr("class", function(d, i) {
    //     if (d.key == "AnstreichungNorm") {
    //         return "anstreichung eingefaltet"
    //     } else if (d.key == "UnterstreichungNorm") {
    //         return "unterstreichung eingefaltet"
    //     } else if (d.key == "ProvenienzNorm") {
    //         return "provenienz eingefaltet"
    //     } else if (d.key == "StempelNorm") {
    //         return "provenienzstempel eingefaltet"
    //     } else if (d.key == "DurchstreichungNorm") {
    //         return "durchstreichung eingefaltet"
    //     } else if (d.key == "ZusatzMaterialNorm") {
    //         return "zusatzMaterial"
    //     } else if (d.key == "SonstigeMarkierungNorm") {
    //         return "sonstigeMarkierung eingefaltet"
    //     } else if (d.key == "AnderesNorm") {
    //         return "anderes eingefaltet"
    //     } else if (d.key == "BewertungNorm") {
    //         return "bewertung eingefaltet"
    //     } else if (d.key == "KommentarNorm") {
    //         return "kommentar eingefaltet"
    //     } else if (d.key == "TextkorrekturNorm") {
    //         return "textkorrektur eingefaltet"
    //     } else if (d.key == "UebersetzungNorm") {
    //         return "uebersetzung eingefaltet"
    //     } else if (d.key == "VarianteNorm") {
    //         return "variante eingefaltet"
    //     }
    // })


console.log("ttest")


  canvas
    .attr('width', scaledWidth)
    .attr('height', scaledHeight)
    .style('width', width + 'px')
    .style('height', height + 'px')
//	.style("display","none");

canvas.node().getContext('2d');
context.scale(ratio, ratio)

scrollFunction()
draw()

});
//////////////Rezize Function End






                var transcriptFontSize = d3.scaleLinear()
                    .domain([500, 2500])
                    .range([2, 12])
                    .clamp(true)


                    var detailInfoScale = d3.scaleLinear()
                        .domain([450, 800])
                        .range([1, 0])
                        .clamp(true)

                        var detailInfoTextBoxScale = d3.scaleLinear()
                            .domain([50, 800])
                            .range([selectedBookBuchlevel*11, selectedBookBuchlevel*15])
                            .clamp(true)

                        var detailTranscriptScale = d3.scaleLinear()
                            .domain([-0.01,0, 380])
                            .range([0,1, 1])
                            .clamp(true)

                            var transcriptYStart= d3.scaleLinear()
                                .domain([900, 1250])
                                .range([1,-20])
                                .clamp(true)

                        //        console.log(scrollTop)

                            var detailCircleScale= d3.scaleLinear()
                                .domain([2500, 3000])
                                .range([0,2])
                                .clamp(true)

                                var transcriptPositionScale= d3.scaleLinear()
                                    .domain([2500, 3000])
                                    .range([8,10])
                                    .clamp(true)

                                    var transcriptPathScaleOpacity= d3.scaleLinear()
                                        .domain([2500, 3000])
                                        .range([0,1])
                                        .clamp(true)



///////
//d3.selectAll(".transcriptions").style("pointer-event", "")






      //      console.log(datenByAuthor)

            datenByAuthor.forEach(function(D, I) {
                D.Abschnitte = []
                //	D.Abschnitte2 = []
                //	D.Abschnitte2.push({Provenienz:[0,0,0,0,0,0,0,0,0,0], Stempel:[], Anstreichung:[], Unterstreichung:[], Durchstreichung:[], SonstigeMarkierung:[], ZusatzMaterial:[],Bewertung:[],Kommentar:[],Textkorrektur:[],Variante:[],Uebersetzung:[],Anderes:[],Leer:[]})
                D.Abschnitte.push({
                    part: 0,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 1,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 2,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 3,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 4,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 5,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 6,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 7,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 8,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 9,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 10,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 11,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 12,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 13,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 14,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 15,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 16,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 17,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 18,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 19,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 20,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })
                D.Abschnitte.push({
                    part: 21,
                    Provenienz: 0,
                    Stempel: 0,
                    Anstreichung: 0,
                    Unterstreichung: 0,
                    Durchstreichung: 0,
                    SonstigeMarkierung: 0,
                    ZusatzMaterial: 0,
                    Bewertung: 0,
                    Kommentar: 0,
                    Textkorrektur: 0,
                    Variante: 0,
                    Uebersetzung: 0,
                    Anderes: 0,
                    Leer: 0,
                    Verfasser: D.key,
                    BuchAnzahlAutor: D.values.length
                })



                D.values.forEach(function(E, G) {
                    E.values.forEach(function(F, C) {
                        if (F.Part / F.maxPart <= 0.05) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[1].Provenienz++
                                //			D.Abschnitte2[0].Provenienz[0]++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[1].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[1].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[1].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[1].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[1].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[1].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[1].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[1].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[1].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[1].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[1].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[1].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[1].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.05 && F.Part / F.maxPart <= 0.1) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[2].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[2].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[2].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[2].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[2].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[2].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[2].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[2].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[2].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[2].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[2].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[2].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[2].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[2].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.1 && F.Part / F.maxPart <= 0.15) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[3].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[3].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[3].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[3].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[3].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[3].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[3].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[3].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[3].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[3].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[3].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[3].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[3].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[3].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.15 && F.Part / F.maxPart <= 0.2) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[4].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[4].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[4].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[4].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[4].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[4].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[4].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[4].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[4].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[4].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[4].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[4].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[4].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[4].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.2 && F.Part / F.maxPart <= 0.25) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[5].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[5].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[5].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[5].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[5].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[5].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[5].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[5].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[5].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[5].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[5].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[5].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[5].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[5].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.25 && F.Part / F.maxPart <= 0.3) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[6].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[6].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[6].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[6].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[6].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[6].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[6].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[6].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[6].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[6].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[6].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[6].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[6].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[6].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.3 && F.Part / F.maxPart <= 0.35) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[7].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[7].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[7].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[7].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[7].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[7].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[7].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[7].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[7].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[7].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[7].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[7].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[7].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[7].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.35 && F.Part / F.maxPart <= 0.4) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[8].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[8].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[8].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[8].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[8].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[8].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[8].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[8].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[8].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[8].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[8].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[8].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[8].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[8].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.4 && F.Part / F.maxPart <= 0.45) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[9].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[9].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[9].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[9].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[9].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[9].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[9].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[9].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[9].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[9].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[9].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[9].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[9].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[9].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.45 && F.Part / F.maxPart <= 0.5) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[10].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[10].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[10].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[10].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[10].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[10].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[10].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[10].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[10].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[10].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[10].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[10].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[10].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[10].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.5 && F.Part / F.maxPart <= 0.55) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[11].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[11].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[11].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[11].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[11].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[11].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[11].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[11].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[11].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[11].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[11].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[11].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[11].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[11].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.55 && F.Part / F.maxPart <= 0.6) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[12].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[12].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[12].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[12].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[12].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[12].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[12].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[12].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[12].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[12].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[12].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[12].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[12].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[12].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.5 && F.Part / F.maxPart <= 0.65) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[13].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[13].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[13].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[13].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[13].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[13].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[13].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[13].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[13].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[13].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[13].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[13].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[13].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[13].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.65 && F.Part / F.maxPart <= 0.7) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[14].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[14].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[14].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[14].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[14].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[14].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[14].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[14].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[14].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[14].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[14].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[14].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[14].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[14].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.7 && F.Part / F.maxPart <= 0.75) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[15].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[15].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[15].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[15].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[15].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[15].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[15].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[15].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[15].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[15].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[15].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[15].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[15].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[15].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.75 && F.Part / F.maxPart <= 0.8) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[16].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[16].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[16].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[16].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[16].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[16].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[16].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[16].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[16].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[16].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[16].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[16].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[16].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[16].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.8 && F.Part / F.maxPart <= 0.85) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[17].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[17].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[17].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[17].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[17].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[17].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[17].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[17].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[17].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[17].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[17].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[17].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[17].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[17].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.85 && F.Part / F.maxPart <= 0.9) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[18].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[18].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[18].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[18].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[18].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[18].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[18].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[18].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[18].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[18].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[18].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[18].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[18].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[18].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.9 && F.Part / F.maxPart <= 0.95) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[19].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[19].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[19].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[19].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[19].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[19].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[19].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[19].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[19].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[19].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[19].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[19].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[19].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[19].Leer++
                            }
                        } else if (F.Part / F.maxPart > 0.95 && F.Part / F.maxPart <= 1) {
                            if (F.SchriftspurTyp === "P" && F.Schreibmedium !== "Stempel") {
                                D.Abschnitte[20].Provenienz++
                            } else if (F.SchriftspurTyp === "P" && F.Schreibmedium == "Stempel") {
                                D.Abschnitte[20].Stempel++
                            } else if (F.Benutzungsspur === "1" || F.Benutzungsspur === "1?") {
                                D.Abschnitte[20].Anstreichung++
                            } else if (F.Benutzungsspur === "2" || F.Benutzungsspur === "2?") {
                                D.Abschnitte[20].Unterstreichung++
                            } else if (F.Benutzungsspur === "3" || F.Benutzungsspur === "3?") {
                                D.Abschnitte[20].Durchstreichung++
                            } else if (F.Benutzungsspur === "4" || F.Benutzungsspur === "4?") {
                                D.Abschnitte[20].SonstigeMarkierung++
                            } else if (F.Benutzungsspur === "6" || F.Benutzungsspur === "6?") {
                                D.Abschnitte[20].ZusatzMaterial++
                            } else if (F.Benutzungsspur === "7" || F.Benutzungsspur === "7?") {
                                D.Abschnitte[20].Anderes++
                            } else if (F.SchriftspurTyp === "B") {
                                D.Abschnitte[20].Bewertung++
                            } else if (F.SchriftspurTyp === "K") {
                                D.Abschnitte[20].Kommentar++
                            } else if (F.SchriftspurTyp === "T") {
                                D.Abschnitte[20].Textkorrektur++
                            } else if (F.SchriftspurTyp === "U") {
                                D.Abschnitte[20].Uebersetzung++
                            } else if (F.SchriftspurTyp === "V") {
                                D.Abschnitte[20].Variante++
                            } else if (F.Benutzungsspur === "null") {
                                D.Abschnitte[20].Leer++
                            }
                        }




                    })

                })





                D.Abschnitte.forEach(function(E, F) {
                    E.ProvenienzNorm = E.Provenienz / E.BuchAnzahlAutor
                    E.StempelNorm = E.Stempel / E.BuchAnzahlAutor
                    E.AnstreichungNorm = E.Anstreichung / E.BuchAnzahlAutor
                    E.UnterstreichungNorm = E.Unterstreichung / E.BuchAnzahlAutor
                    E.DurchstreichungNorm = E.Durchstreichung / E.BuchAnzahlAutor
                    E.SonstigeMarkierungNorm = E.SonstigeMarkierung / E.BuchAnzahlAutor
                    E.ZusatzMaterialNorm = E.ZusatzMaterial / E.BuchAnzahlAutor
                    E.BewertungNorm = E.Bewertung / E.BuchAnzahlAutor
                    E.KommentarNorm = E.Kommentar / E.BuchAnzahlAutor
                    E.TextkorrekturNorm = E.Textkorrektur / E.BuchAnzahlAutor
                    E.VarianteNorm = E.Variante / E.BuchAnzahlAutor
                    E.UebersetzungNorm = E.Uebersetzung / E.BuchAnzahlAutor
                    E.AnderesNorm = E.Anderes / E.BuchAnzahlAutor
                    E.LeerNorm = E.Leer / E.BuchAnzahlAutor
                    // E.PlatzhalterNorm = 0

										E.TotalTraces = E.Provenienz + E.Stempel + E.Anstreichung + E.Unterstreichung + E.Durchstreichung + E.SonstigeMarkierung + E.ZusatzMaterial
										+ E.Bewertung + E.Kommentar + E.Textkorrektur + E.Variante + E.Uebersetzung + E.Anderes
										E.TotalTracesNorm = E.TotalTraces / E.BuchAnzahlAutor
                })



            })


            datenByAuthor.forEach(function(D, I) {

            D.maxTraceNumber = d3.max([D.Abschnitte[0].TotalTraces, D.Abschnitte[1].TotalTraces, D.Abschnitte[2].TotalTraces, D.Abschnitte[3].TotalTraces, D.Abschnitte[4].TotalTraces, D.Abschnitte[5].TotalTraces, D.Abschnitte[6].TotalTraces, D.Abschnitte[7].TotalTraces
            , D.Abschnitte[8].TotalTraces, D.Abschnitte[9].TotalTraces, D.Abschnitte[10].TotalTraces, D.Abschnitte[11].TotalTraces, D.Abschnitte[12].TotalTraces, D.Abschnitte[13].TotalTraces, D.Abschnitte[14].TotalTraces
            , D.Abschnitte[15].TotalTraces, D.Abschnitte[16].TotalTraces, D.Abschnitte[17].TotalTraces, D.Abschnitte[18].TotalTraces, D.Abschnitte[19].TotalTraces, D.Abschnitte[20].TotalTraces])

            D.maxTraceNumberNorm = D.maxTraceNumber/D.Abschnitte[0].BuchAnzahlAutor
          //  D.maxTraceNumberNormBefore = datenByAuthor[I-1].maxTraceNumberNorm

            })

            datenByAuthor.forEach(function(D, I) {

            D.maxTraceNumber = d3.max([D.Abschnitte[0].TotalTraces, D.Abschnitte[1].TotalTraces, D.Abschnitte[2].TotalTraces, D.Abschnitte[3].TotalTraces, D.Abschnitte[4].TotalTraces, D.Abschnitte[5].TotalTraces, D.Abschnitte[6].TotalTraces, D.Abschnitte[7].TotalTraces
            , D.Abschnitte[8].TotalTraces, D.Abschnitte[9].TotalTraces, D.Abschnitte[10].TotalTraces, D.Abschnitte[11].TotalTraces, D.Abschnitte[12].TotalTraces, D.Abschnitte[13].TotalTraces, D.Abschnitte[14].TotalTraces
            , D.Abschnitte[15].TotalTraces, D.Abschnitte[16].TotalTraces, D.Abschnitte[17].TotalTraces, D.Abschnitte[18].TotalTraces, D.Abschnitte[19].TotalTraces, D.Abschnitte[20].TotalTraces])

            D.maxTraceNumberNorm = D.maxTraceNumber/D.Abschnitte[0].BuchAnzahlAutor
            if (I>0){
              D.maxTraceNumberNormBefore = datenByAuthor[I-1].maxTraceNumberNorm
}
            })







console.log(datenByAuthor[0].Abschnitte)














            var posx = 0
            var posx2 = 0

            var bookFingerprint = dataContainer.selectAll(".bookFingerprint")
                .data(datenByTitle)
                .enter()
                .append("g")
                .attr("class", "bookFingerprint")
                .attr("transform", function(d, i) {
                    if (i == 0) {
                        posx = 0
                        return "translate(" + (marginleft + (posx)) + "," + (posYCanvas) + ")"
                    } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser && d.values[0].AuthorCount > 1) {
                        posx = posx + authorAbstand
                        return "translate(" + (marginleft + (posx)) + "," + (posYCanvas) + ")"
                    } else {
                        posx = posx + buchBgBreite
                        return "translate(" + (marginleft + (posx)) + "," + (posYCanvas) + ")"
                    }
                })


            ///clip-path für transcriptions start

            svg.append("defs")
            .append("clipPath")
            .attr("id", "transcript-clip")
            .append("rect")
            .attr("height", height)
            .attr("width", width)

            ///clip-path für transcriptions ende


            var bookG = svg.selectAll(".bookBG")
                .data(datenByTitle)
                .enter()
                .append("g")
                .attr("transform", function(d, i) {
                    if (i == 0) {
                        posx = 0
                        return "translate(" + (marginleft - ((buchBgBreite - buchBreite) / 2) + (posx)) + "," + (posY) + ")"
                    } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser && d.values[0].AuthorCount > 1) {
                        posx = posx + authorAbstand
                        return "translate(" + (marginleft - ((buchBgBreite - buchBreite) / 2) + (posx)) + "," + (posY) + ")"
                    } else {
                        posx = posx + buchBgBreite
                        return "translate(" + (marginleft - ((buchBgBreite - buchBreite) / 2) + (posx)) + "," + (posY) + ")"
                    }
                })
                .attr("class", "bookBG")

            var bookGFront = svgFront.selectAll(".bookBG")
                .data(datenByTitle)
                .enter()
                .append("g")
                .attr("transform", function(d, i) {
                    if (i == 0) {
                        posx = 0
                        return "translate(" + (marginleft - ((buchBgBreite - buchBreite) / 2) + (posx)) + "," + (posY) + ")"
                    } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser && d.values[0].AuthorCount > 1) {
                        posx = posx + authorAbstand
                        return "translate(" + (marginleft - ((buchBgBreite - buchBreite) / 2) + (posx)) + "," + (posY) + ")"
                    } else {
                        posx = posx + buchBgBreite
                        return "translate(" + (marginleft - ((buchBgBreite - buchBreite) / 2) + (posx)) + "," + (posY) + ")"
                    }
                })
                .attr("class", "bookBG")

            var bookTitleFront =  svgFrontTitles.selectAll(".bookTitleFrontG")
                .data(datenByTitle)
                .enter()
                .append("g")
                .attr("transform", function(d, i) {
                    if (i == 0) {
                        posx = 0
                        return "translate(" + (marginleft-40.5 + (posx)) + "," + (posY) + ")"
                    } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser && d.values[0].AuthorCount > 1) {
                        posx = posx + authorAbstand
                        return "translate(" + (marginleft-40.5 + (posx)) + "," + (posY) + ")"
                    } else {
                        posx = posx + buchBgBreite
                        return "translate(" + (marginleft-40.5 + (posx)) + "," + (posY) + ")"
                    }
                })
                .attr("class", "bookTitleFrontG")
                .style("display", "none")


                bookTitleFront.append("rect")
                .attr("height", 1500)
                .attr("width", 40)
                .attr("fill", "#474747")
                .attr("class", "BuchTitelRect")


                bookTitleFront.append("text").attr("x", -4).attr("y", 16).style("text-anchor", "end")
                .text(function(d) {
                    if (d.values[0].Verfasser_Original.length > 70) {
                        return (d.values[0].Verfasser_Original).substring(0, 70) + " [...]"
                    } else {
                        return d.values[0].Verfasser_Original
                    }
                })
                .attr("fill", "white")
                .attr("class", "BuchTitelLabel")
                .style("font-weight", "bold")
                .style("letter-spacing", "1px")
                .attr("transform", "rotate(-90)")



              bookTitleFront.append("text").attr("x", -4).attr("y", 32).style("text-anchor", "end")
                .text(function(d) {if(korpus.filter(function(D,I){return D.KurzSignatur == d.values[0].BookID})[0]){
                    if (korpus.filter(function(D,I){return D.KurzSignatur == d.values[0].BookID})[0].Kurztitel.length > 70) {
                        return (korpus.filter(function(D,I){return D.KurzSignatur == d.values[0].BookID})[0].Kurztitel).substring(0, 70) + " [...]"
                    } else {
                        return korpus.filter(function(D,I){return D.KurzSignatur == d.values[0].BookID})[0].Kurztitel
                    }}
                })
                .attr("fill", "white")
                .attr("class", "BuchTitelLabel")
                .attr("transform", "rotate(-90)")


                bookTitleFront.append("text").attr("x", -areaheight).attr("y", 24).style("text-anchor", "start")
                  .text(function(d) {if(korpus.filter(function(D,I){return D.KurzSignatur == d.values[0].BookID})[0])
                          {if (korpus.filter(function(D,I){return D.KurzSignatur == d.values[0].BookID})[0].Formalschlagwort_Genre != "null"){

                            return korpus.filter(function(D,I){return D.KurzSignatur == d.values[0].BookID})[0].Formalschlagwort_Genre +" ("+korpus.filter(function(D,I){return D.KurzSignatur == d.values[0].BookID})[0].Jahr+")"
}else{return "("+korpus.filter(function(D,I){return D.KurzSignatur == d.values[0].BookID})[0].Jahr +")"}
                  }})
                  .attr("fill", "white")
                  .attr("class", "BuchTitelLabel")
                  .attr("transform", "rotate(-90)")


            var authorGroup = bookG
                .filter(function(d, i) {
                    return i == 0 || d.values[0].Verfasser != datenByTitle[i - 1].values[0].Verfasser
                })
                .append("g").attr("class", function(d) {
                    return d.values[0].Verfasser
                }).attr("transform", "translate(0,0)")
                .classed("authorBg", true)


            var authorLabel = bookG
                .filter(function(d, i) {
                    return i == 0 || d.values[0].Verfasser != datenByTitle[i - 1].values[0].Verfasser
                })
                //|| d.values[0].AuthorCount == 1 && datenByTitle[i-1].authorCount != 1}
                .append("g").attr("transform", "translate(4,-3)rotate(-45)")
            var layerGroups = bookGFront
                .filter(function(d, i) {
                    return i == 0 || d.values[0].Verfasser != datenByTitle[i - 1].values[0].Verfasser
                })
                .append("g").attr("transform", "translate(0,0)rotate(0)")

            //console.log(authorGroup)
            //console.log(datenByTitle)

            authorGroup.append("rect")
                //.attr("class", function(d,i){console.log(datenByAuthor[i])})
                .attr("width", function(d, i) {
                    return buchBgBreite * (datenByAuthor[i].values.length)
                })
                .attr("height", 6000)
                .attr("fill", "#EBE3DD")//"#cec1b8")//"red")
                .attr("class", "authorBg")
                .attr("opacity", 0)






            var stack = d3.stack()
                .keys(["BewertungNorm", "KommentarNorm", "TextkorrekturNorm", "UebersetzungNorm", "VarianteNorm", "AnstreichungNorm", "UnterstreichungNorm", "DurchstreichungNorm", "SonstigeMarkierungNorm", "AnderesNorm", "ProvenienzNorm", "StempelNorm", "ZusatzMaterialNorm"])
                .order(d3.stackOrderNone)
                .offset(d3.stackOffsetNone);



            var xAreaMax = 4.5
            var totalAreaChartsWidth = 0
            datenByAuthor.forEach(function(D, I) {
              totalAreaChartsWidth= totalAreaChartsWidth + xAreaMax*D.maxTraceNumberNorm
            })
            authorLevelAbstand = (chartArea - totalAreaChartsWidth)/authorAnzahl



            var yArea = d3.scaleLinear()
                .range([0, (areaheight / 21)]);

            var xArea = d3.scaleLinear()
                .range([0, xAreaMax]);




            var area = d3.area()
                .y(function(d, i) {
                    return yArea(d.data.part)
                })
                .x0(function(d) {
                  var areaChartXPos = 50//Number(dataContainer.selectAll(".bookFingerprint").filter(function(D){return D.values[0].Verfasser == d.data.Verfasser || D.values[0].Verfasser == "[Black, Adam u. Charles]"}).attr("transform").replace("translate(", "").split(',')[0])
                    return xArea(d[0]);
                })
                .x1(function(d) {
                  var areaChartXPos = 50//Number(dataContainer.selectAll(".bookFingerprint").filter(function(D){return D.values[0].Verfasser == d.data.Verfasser || D.values[0].Verfasser == "[Black, Adam u. Charles]"}).attr("transform").replace("translate(", "").split(',')[0])

                    return xArea(d[1]);
                })
                .curve(d3.curveBasis)
              //  .context(context);

           var areachartGroup = layerGroups.append("g").attr("class", "areachartGroup")
          //var areachartGroup = dataContainer.append("g").attr("class", "areachartGroup")

            var areachart = areachartGroup.selectAll(".areachartlayer")
                .data(function(D, I) {
                    return (stack(datenByAuthor[I].Abschnitte).filter(function(d) {
                        return d
                    }))
                })
                .enter().append("g")
                .attr("class", "areachartlayer")
                .attr("display", "none")

//            console.log(d3.max(datenByAuthor[1].Abschnitte[1].TotalTraces))
			//			console.log(d3.max([(datenByAuthor[1].Abschnitte[0].TotalTracesNorm),(datenByAuthor[1].Abschnitte[1].TotalTracesNorm),(datenByAuthor[1].Abschnitte[2].TotalTracesNorm)
	// 				,(datenByAuthor[1].Abschnitte[3].TotalTracesNorm),(datenByAuthor[1].Abschnitte[4].TotalTracesNorm),(datenByAuthor[1].Abschnitte[5].TotalTracesNorm),(datenByAuthor[1].Abschnitte[6].TotalTracesNorm)
	// 			,(datenByAuthor[1].Abschnitte[7].TotalTracesNorm),(datenByAuthor[1].Abschnitte[8].TotalTracesNorm),(datenByAuthor[1].Abschnitte[9].TotalTracesNorm),(datenByAuthor[1].Abschnitte[10].TotalTracesNorm)
	// 		,(datenByAuthor[1].Abschnitte[11].TotalTracesNorm),(datenByAuthor[1].Abschnitte[12].TotalTracesNorm),(datenByAuthor[1].Abschnitte[13].TotalTracesNorm),(datenByAuthor[1].Abschnitte[14].TotalTracesNorm)
	// 	,(datenByAuthor[1].Abschnitte[15].TotalTracesNorm),(datenByAuthor[1].Abschnitte[16].TotalTracesNorm),(datenByAuthor[1].Abschnitte[17].TotalTracesNorm),(datenByAuthor[1].Abschnitte[18].TotalTracesNorm)
	// ,(datenByAuthor[1].Abschnitte[19].TotalTracesNorm),(datenByAuthor[1].Abschnitte[20].TotalTracesNorm)]))

            areachartGroup.append("line")
                .attr("x1", 0)
                .attr("x2", 0)
                .attr("y1", 0)
                .attr("y2", areaheight)
                .attr("stroke-width", 0.5)
                .attr("stroke", "black")
                .style("opacity", 1)
                .attr("stroke-dasharray", 2, 0.5)
                .attr("display", "none")


            areachart.append("path")
              //  .attr("id", console.log(area))
                .attr("d", area)
                .attr("class", function(d, i) {
                    if (d.key == "AnstreichungNorm") {
                        return "anstreichung eingefaltet"
                    } else if (d.key == "UnterstreichungNorm") {
                        return "unterstreichung eingefaltet"
                    } else if (d.key == "ProvenienzNorm") {
                        return "provenienz eingefaltet"
                    } else if (d.key == "StempelNorm") {
                        return "provenienzstempel eingefaltet"
                    } else if (d.key == "DurchstreichungNorm") {
                        return "durchstreichung eingefaltet"
                    } else if (d.key == "ZusatzMaterialNorm") {
                        return "zusatzMaterial"
                    } else if (d.key == "SonstigeMarkierungNorm") {
                        return "sonstigeMarkierung eingefaltet"
                    } else if (d.key == "AnderesNorm") {
                        return "anderes eingefaltet"
                    } else if (d.key == "BewertungNorm") {
                        return "bewertung eingefaltet"
                    } else if (d.key == "KommentarNorm") {
                        return "kommentar eingefaltet"
                    } else if (d.key == "TextkorrekturNorm") {
                        return "textkorrektur eingefaltet"
                    } else if (d.key == "UebersetzungNorm") {
                        return "uebersetzung eingefaltet"
                    } else if (d.key == "VarianteNorm") {
                        return "variante eingefaltet"
                    } else if (d.key == "PlatzhalterNorm") {
                          return "platzhalter"
                      }
                })



            //console.log(datenByAuthor)


            authorLabel.append("text")
                .attr("class", "authorLabel")
                .attr("fill", "black")
                .text(function(d) {
                    if (d.values[0].Verfasser == "[Black, Adam u. Charles]") {
                        return "Sonstige"
                    } else {
                        return d.values[0].Verfasser
                    }
                })
                .style("font-size", function(d, i) {
                    if (d.values[0].Verfasser == "[ohne Angabe]" || d.values[0].Verfasser == "Sonstige") {
                        return 10.5 + "px"
                    } else {
                        var fontSizeScale = d3.scaleLinear()
                            .domain([2, 28])
                            .range([10.5, 18])
                            .clamp(true)

                        return fontSizeScale(d.values[0].AuthorCount) + "px"
                    }
                })
                .style("cursor", "pointer")
                .on("mouseover", function(d){

                  d3.select(this).style("font-weight", "bold")

                //  thisVerfasserSelected = d3.select(this).text()
                  })
                  .on("mouseout", function(d){
                    svg.selectAll(".authorLabel").filter(function(d) {
                        return d.values[0].Verfasser == thisVerfasserSelected
                    }).style("font-weight", "bold")
                    svg.selectAll(".authorLabel").filter(function(d) {
                        return d.values[0].Verfasser != thisVerfasserSelected
                    }).style("font-weight", "normal")
                    })
                  .on("click", function(d){
                    thisVerfasserSelected = d3.select(this).text()

                    if(clickedBook != 0){
                      d3.selectAll(".detailInfoParent")
                          .transition()
                          .style("opacity", 0)
                          .remove()

                          d3.selectAll(".bookBG").selectAll("rect")
                              .transition()
                              .style("opacity", 0)

                      $("html,body").animate({
                            scrollTop: 5999
                        }, '200')
                        setTimeout(function () {
                          clickedBook = 0

                          $("html,body").animate({
                          scrollTop: 9000
                        }, 300);
})

                    }

                    if (scrollTop == 3000){
                      $("html,body").animate({
                            scrollTop: 9001
                        }, '1000')

                    }else{
                      $("html,body").animate({
                            scrollTop: 9000
                        }, '1000')
                    }
                  })




            /////Titel und hover
            bookG
                //.attr("transform", "translate(" + (posX-1) + "," + (posY) + ")")
                .append("rect")
                .attr("cursor", function() {
                    if (scrollTop > -5) {
                        return "pointer"
                    } else {
                        return "not-allowed"
                    }
                })
                .attr("opacity", 0)
                .attr("width", buchBgBreite)
                .attr("height", "7500")
                .attr("class", "bookBG")
                .classed("singleBookBG", true)
                .attr("fill", "#cec1b8")
              //  .attr("fill", "red")
                .on("mouseover", function(d) {
                    if (scrollTop > -800 && scrollTop < 1200) {
                        thisVerfasserSelected = d3.select(this).datum().values[0].Verfasser


                    }

                                            authorGroup.selectAll("rect").filter(function(d) {
                                                    return d.values[0].Verfasser == thisVerfasser
                                                }).transition().duration(200)
                                                .attr("opacity", function() {
                                                    if (scrollTop < 400) {
                                                        return 1
                                                    } else {
                                                        return 0
                                                    }
                                                })

                                            authorGroup.selectAll("rect").filter(function(d) {
                                                    return d.values[0].Verfasser == thisVerfasserSelected
                                                }).transition().duration(200)
                                                .attr("opacity", function() {
                                                    if (scrollTop > 400) {
                                                        return 0
                                                    }
                                                })

                                            svg.selectAll(".authorLabel").filter(function(d) {
                                                return d.values[0].Verfasser == thisVerfasserSelected
                                            }).style("font-weight", "bold")
                                            svg.selectAll(".authorLabel").filter(function(d) {
                                                return d.values[0].Verfasser != thisVerfasserSelected
                                            }).style("font-weight", "normal")

                                            //console.log(d)

                                            var thisBookID = d3.select(this).datum().values[0].BookID


                                            svgFrontTitles.selectAll(".bookTitleFrontG")
                                              .filter(function(d) {
                                                    return d.values[0].BookID == thisBookID
                                                })
                                              .style("display", "inline")



                })
                .on("mousemove", function(d) {

                    if (scrollTop > -800) {
                        if (scrollTop > -800 && scrollTop < 1200) {
                            thisVerfasserSelected = d3.select(this).datum().values[0].Verfasser
                            //	console.log(thisVerfasser)

                        }
                        var currentScrollTop = Math.max(window.pageYOffset, document.documentElement.scrollTop, document.body.scrollTop)
                    //    console.log(currentScrollTop)
                    //    console.log(d3.event.layerY || d3.event.offsety)
                    //    console.log(d3.event.offsety)
                    //    console.log(d3.event.layerY )
                    //    console.log(d3.event.pageY)
                    //    var mouseY = ((d3.event.layerY || d3.event.offsety) - currentScrollTop-120);
                        var mouseY = ((d3.event.pageY) - currentScrollTop-270);
                    //    console.log(mouseY)
                        //console.log(mouseY/pageheight)
                        //console.log(d.values)
                        var thisPage = (round45(mouseY) / pageheight) + 1
                    //    console.log(thisPage)
                        function round45(x) {
                            return Math.ceil(x / pageheight) * pageheight
                        }
                        //console.log(d.values.filter(function(D,I){return D.Part == 3}))
                        thisVerfasser = d3.select(this).datum().values[0].Verfasser
                        var thisBookID = d3.select(this).datum().values[0].BookID



                        //tooltip.select("p").text(thisPageID)
                        if (d.values[0].maxPart < thisPage || mouseY < 0) {
                            d3.select('.tooltip')
                                .style("display", "none")
                                .style('top', d3.event.pageY)
                        } else if (d.values[0].maxPart >= thisPage && mouseY > 0) {

                            var thisPageID = (d.values.filter(function(d, i) {
                                return d.Part == thisPage
                            }))[0].ID

                            d3.select(".tooltip")
                                .style("display", "block")
                                .style('top', d3.event.pageY - 100 + 'px')
                                .style('left', function(){if (d3.event.pageX < width/2){return d3.event.pageX + 25 + 'px'}else {return d3.event.pageX -250 + 'px'}})

                            tooltip.select("img").attr("src", function() {
                                return "./img/m/" + thisPageID + ".jpg"
                            })
                        }


                        authorGroup.selectAll("rect").filter(function(d) {
                                return d.values[0].Verfasser == thisVerfasser
                            }).transition().duration(200)
                            .attr("opacity", function() {
                                if (scrollTop < 400) {
                                    return 1
                                } else {
                                    return 0
                                }
                            })

                        authorGroup.selectAll("rect").filter(function(d) {
                                return d.values[0].Verfasser == thisVerfasserSelected
                            }).transition().duration(200)
                            .attr("opacity", function() {
                                if (scrollTop > 400) {
                                    return 0
                                }
                            })

                        svg.selectAll(".authorLabel").filter(function(d) {
                            return d.values[0].Verfasser == thisVerfasserSelected
                        }).style("font-weight", "bold")
                        svg.selectAll(".authorLabel").filter(function(d) {
                            return d.values[0].Verfasser != thisVerfasserSelected
                        }).style("font-weight", "normal")

                        //console.log(d)

                        var thisBookID = d3.select(this).datum().values[0].BookID


                        svgFrontTitles.selectAll(".bookTitleFrontG")
                          .filter(function(d) {
                                return d.values[0].BookID == thisBookID
                            })
                          .style("display", "inline")



                    }
                })
                .on("mouseout", function() {

                  var thisBookID = d3.select(this).datum().values[0].BookID

                  svgFrontTitles.selectAll(".bookTitleFrontG")
                    .filter(function(d) {
                          return d.values[0].BookID == thisBookID
                      })
                    .style("display", "none")


                    authorGroup.selectAll("rect").filter(function(d) {
                        return d.values[0].Verfasser != thisVerfasserSelected
                    }).transition().duration(200).attr("opacity", function() {
                        return 0
                    })
                    svg.selectAll(".authorLabel").filter(function(d) {
                        if (scrollTop > 0) {
                            return d.values[0].Verfasser != thisVerfasserSelected
                        } else {
                            return d
                        }
                    }).style("font-weight", function() {
                        if (scrollTop < 0) {
                            return "normal"
                        }
                    })


                    //	d3.select(this).transition().attr("opacity", 0)

                    d3.select('.tooltip')
                        .style("display", "none")

                })
                .on("click", bookClick)


            bookFingerprint.append("rect")
                .attr("class", "nodesbg")
                .attr("width", buchBreite)
                .attr("height", function(d) {
                    return (d.values[0].maxPart) * pageheight
                })
                .attr("fill", "white")
                .attr("x", 0)
                .attr("y", posYCanvas)
                .attr("opacity", 1)


            bookFingerprint.selectAll(".nodes")
                .data(function(d) {
                    return d.values.filter(function(d) {
                        return d.Benutzungsspur != "null"
                    })
                })
                //			.data(function(d){return d.values})
                .enter()
                .append("rect")
                .attr("width", buchBreite)
                .attr("height", pageheight)
                .attr("x", 0)
                .attr("y", function(d, i) {
                    return posYCanvas + pageheight * d.Part
                })
                .attr("opacity", 1)
                //	.attr("fill", function(d){return color(d.Benutzungsspur)})
                .attr("fill", function(d) {
                    if (d.Benutzungsspur == "null") {
                        return "white"
                    } else if (d.Benutzungsspur === "1" || d.Benutzungsspur === "1?") {
                        return "#58b0f7"
                    } else if (d.Benutzungsspur === "2" || d.Benutzungsspur === "2?") {
                        return "#58b0f7"
                    } else if (d.Benutzungsspur === "3" || d.Benutzungsspur === "3?") {
                        return "#58b0f7"
                    } else if (d.Benutzungsspur === "4" || d.Benutzungsspur === "4?") {
                        return "#58b0f7"
                    } else if (d.Benutzungsspur === "7" || d.Benutzungsspur === "7?") {
                        return "#ab56c4"
                    } else if (d.Benutzungsspur === "6" || d.Benutzungsspur === "6?") {
                        return "rgb(72, 184, 112)"
                    } else if (d.SchriftspurTyp == "P" && d.Schreibmedium != "Stempel") {
                        return "#5B5B5B"
                    } else if (d.SchriftspurTyp == "P" && d.Schreibmedium == "Stempel") {
                        return "#5B5B5B"
                    } else if (d.SchriftspurTyp == "B") {
                        return "#f72652"
                    } else if (d.SchriftspurTyp == "K") {
                        return "#f72652"
                    } else if (d.SchriftspurTyp == "T") {
                        return "#f72652"
                    } else if (d.SchriftspurTyp == "U") {
                        return "#f72652"
                    } else if (d.SchriftspurTyp == "V") {
                        return "#f72652"
                    }
                })
                // .attr("fill", function(d){
                // 	if (d.Benutzungsspur == "null"){return "white"}
                // 	else if (d.Benutzungsspur === "1" || d.Benutzungsspur === "1?"){return "#FF5D62"}
                // 	else if (d.Benutzungsspur === "2" || d.Benutzungsspur === "2?"){return "#ff7d5d"}
                // 	else if (d.Benutzungsspur === "3" || d.Benutzungsspur === "3?"){return "#4020d0"}
                // 	else if (d.Benutzungsspur === "4" || d.Benutzungsspur === "4?"){return "#29D1E2"}
                // 	else if (d.Benutzungsspur === "7" || d.Benutzungsspur === "7?"){return "#ab56c4"}
                //
                // 	else if (d.Benutzungsspur === "6" || d.Benutzungsspur === "6?"){return "#e3c460"}
                //
                //
                // 	else if (d.SchriftspurTyp == "P" && d.Schreibmedium != "Stempel") {return "#575757"}
                // 	else if (d.SchriftspurTyp == "P" && d.Schreibmedium == "Stempel") {return "#828282"}
                //
                // 	else if (d.SchriftspurTyp == "B") {return "#95B739"}
                // 	else if (d.SchriftspurTyp == "K") {return "#075011"}
                // 	else if (d.SchriftspurTyp == "T") {return "#00D18D"}
                // 	else if (d.SchriftspurTyp == "U") {return "#017554"}
                // 	else if (d.SchriftspurTyp == "V") {return "#519E15"}
                // 	})
                .attr("class", function(d) {
                    if (d.Benutzungsspur == "null") {
                        return "leer"
                    } else if (d.Benutzungsspur === "1" || d.Benutzungsspur === "1?") {
                        return "anstreichung"
                    } else if (d.Benutzungsspur === "2" || d.Benutzungsspur === "2?") {
                        return "unterstreichung"
                    } else if (d.Benutzungsspur === "3" || d.Benutzungsspur === "3?") {
                        return "durchstreichung"
                    } else if (d.Benutzungsspur === "4" || d.Benutzungsspur === "4?") {
                        return "sonstigeMarkierung"
                    } else if (d.Benutzungsspur === "7" || d.Benutzungsspur === "7?") {
                        return "anderes"
                    } else if (d.Benutzungsspur === "6" || d.Benutzungsspur === "6?") {
                        return "zusatzMaterial"
                    } else if (d.SchriftspurTyp == "P" && d.Schreibmedium != "Stempel") {
                        return "provenienz"
                    } else if (d.SchriftspurTyp == "P" && d.Schreibmedium == "Stempel") {
                        return "provenienzstempel"
                    } else if (d.SchriftspurTyp == "B") {
                        return "bewertung"
                    } else if (d.SchriftspurTyp == "K") {
                        return "kommentar"
                    } else if (d.SchriftspurTyp == "T") {
                        return "textkorrektur"
                    } else if (d.SchriftspurTyp == "U") {
                        return "uebersetzung"
                    } else if (d.SchriftspurTyp == "V") {
                        return "variante"
                    }
                })
                .classed("nodes", true)

            //})

            function farbausfaltungProvenienz() {
                transitions = true

                setTimeout(function() {
                    transitions = false
                }, 1000);

                areachart.selectAll(".provenienz,.provenienzstempel,.sonstigeMarkierung,.anstreichung,.unterstreichung,.durchstreichung,.bewertung,.kommentar,.textkorrektur,.uebersetzung,.variante").classed("eingefaltet", false)

                dataContainer.selectAll(".nodes").filter(".provenienz,.provenienzstempel").transition().duration(800)
                    .attr("fill", function(d) {
                        if (d.SchriftspurTyp == "P" && d.Schreibmedium != "Stempel") {
                            return "#575757"
                        } else if (d.SchriftspurTyp == "P" && d.Schreibmedium == "Stempel") {
                            return "#828282"
                        }
                    })
}

function farbeinfaltungProvenienz() {
    transitions = true

    setTimeout(function() {
        transitions = false
    }, 1000);

    areachart.selectAll(".provenienz,.provenienzstempel").classed("eingefaltet", true)

    dataContainer.selectAll(".nodes").filter(".provenienz,.provenienzstempel").transition().duration(800)
        .attr("fill", function(d) {
            if (d.SchriftspurTyp == "P" && d.Schreibmedium != "Stempel") {
                return "#5B5B5B"
            } else if (d.SchriftspurTyp == "P" && d.Schreibmedium == "Stempel") {
                return "#5B5B5B"
            }
        })
}



            function farbausfaltungMarkierung() {
                transitions = true

                setTimeout(function() {
                    transitions = false
                }, 1000);

                areachart.selectAll(".provenienz,.provenienzstempel,.sonstigeMarkierung,.anstreichung,.unterstreichung,.durchstreichung,.bewertung,.kommentar,.textkorrektur,.uebersetzung,.variante").classed("eingefaltet", false)

                dataContainer.selectAll(".nodes").filter(".unterstreichung,.anstreichung,.durchstreichung,.sonstigeMarkierung,.anderes").transition().duration(800)
                    .attr("fill", function(d) {
                        if (d.Benutzungsspur === "1" || d.Benutzungsspur === "1?") {
                            return "#018DC9"
                        } else if (d.Benutzungsspur === "2" || d.Benutzungsspur === "2?") {
                            return "#415aff"
                        } else if (d.Benutzungsspur === "3" || d.Benutzungsspur === "3?") {
                            return "#4020d0"
                        } else if (d.Benutzungsspur === "4" || d.Benutzungsspur === "4?") {
                            return "#29D1E2"
                        } else if (d.Benutzungsspur === "7" || d.Benutzungsspur === "7?") {
                            return "#ab56c4"
                        }
                    })
            }

            function farbeinfaltungMarkierung() {
                transitions = true

                setTimeout(function() {
                    transitions = false
                }, 1000);

                areachart.selectAll(".unterstreichung,.anstreichung,.durchstreichung,.sonstigeMarkierung").classed("eingefaltet", true)

                dataContainer.selectAll(".nodes").filter(".unterstreichung,.anstreichung,.durchstreichung,.sonstigeMarkierung").transition().duration(800)
                    .attr("fill", function(d) {
                        if (d.Benutzungsspur === "1" || d.Benutzungsspur === "1?") {
                            return "#58b0f7"
                        } else if (d.Benutzungsspur === "2" || d.Benutzungsspur === "2?") {
                            return "#58b0f7"
                        } else if (d.Benutzungsspur === "3" || d.Benutzungsspur === "3?") {
                            return "#58b0f7"
                        } else if (d.Benutzungsspur === "4" || d.Benutzungsspur === "4?") {
                            return "#58b0f7"
                        }
                    })
            }



            function farbausfaltungMarginalien() {
                transitions = true

                setTimeout(function() {
                    transitions = false
                }, 1000);

                areachart.selectAll(".provenienz,.provenienzstempel,.sonstigeMarkierung,.anstreichung,.unterstreichung,.durchstreichung,.bewertung,.kommentar,.textkorrektur,.uebersetzung,.variante").classed("eingefaltet", false)

                dataContainer.selectAll(".nodes").filter(".bewertung,.kommentar,.textkorrektur,.uebersetzung,.variante").transition().duration(800)
                    .attr("fill", function(d) {
                        if (d.SchriftspurTyp == "B") {
                            return "#F74141"
                        } else if (d.SchriftspurTyp == "K") {
                            return "#FF8A5D"
                        } else if (d.SchriftspurTyp == "T") {
                            return "#8D084E"
                        } else if (d.SchriftspurTyp == "U") {
                            return "#f93593"
                        } else if (d.SchriftspurTyp == "V") {
                            return "#FD9698"
                        }
                    })
            }

            function farbeinfaltungMarginalien() {
                transitions = true

                setTimeout(function() {
                    transitions = false
                }, 1000);

                areachart.selectAll(".bewertung,.kommentar,.textkorrektur,.uebersetzung,.variante").classed("eingefaltet", true)

                dataContainer.selectAll(".nodes").filter(".bewertung,.kommentar,.textkorrektur,.uebersetzung,.variante").transition().duration(800)
                    .attr("fill", function(d) {
                        if (d.SchriftspurTyp == "B") {
                            return "#f72652"
                        } else if (d.SchriftspurTyp == "K") {
                            return "#f72652"
                        } else if (d.SchriftspurTyp == "T") {
                            return "#f72652"
                        } else if (d.SchriftspurTyp == "U") {
                            return "#f72652"
                        } else if (d.SchriftspurTyp == "V") {
                            return "#f72652"
                        }
                    })
            }

var detailview = false
var thisData = 0

            function bookClick() {
        //      d3.select("#svgFrontTitles").style("display", "none")
                ///Trigger animation in Canvas
                transitions = true

                ///Stop animation in Canvas
                setTimeout(function() {
                    transitions = false
                }, 20000);

                ///Hide Background for Author Group
                authorGroup.selectAll("rect").attr("display", "none")


                ///create array thisData that only includes pages with Benutzungsspuren
                thisData = (d3.select(this).datum().values).filter(function(d) {
                    return d.Benutzungsspur != "null"
                })


                ///set a selection based on ID
                clickedBook = d3.select(this).datum().values[0].BookID

                ///create Variable that counts number of "Schriftspuren" on one page
                var maxX = 0

                ///create variable that helps to position the books
                var posX = 0



                ////Create Scale for book/page width, based on scroll position
                var selectedBookScale = d3.scaleLinear()
                    .domain([0, 3000])
                    .range([selectedBookBuchlevel, selectedBookSeitenlevel])
                    .clamp(true)

                var unselectedBookSameAuthorScale = d3.scaleLinear()
                    .domain([0, 3000])
                    .range([unselectedBookSameAuthorBuchlevel, unselectedBookSameAuthorSeitenlevel])
                    .clamp(true)

                var unselectedBookScale = d3.scaleLinear()
                    .domain([0, 3000])
                    .range([unselectedBookBuchlevel, unselectedBookSeitenlevel])
                    .clamp(true)

                    var BuchauswahlFeldScale = d3.scaleLinear()
                        .domain([0, 3000])
                        .range([BuchauswahlFeld, BuchauswahlFeldSeitenFeld])
                        .clamp(true)

                        var onSelectionAuthorAbstand = (chartArea-100-(BuchauswahlFeldScale(scrollTop)+ (BuchAnzahl-1)*unselectedBookBuchlevel)) / (authorAnzahl) //-100 muss eventuell raus? warum die benötigt werden ist un klar


                bookFingerprint.selectAll(".nodes")
                  .filter(function(d, i) {
                        return d.BookID != clickedBook
                        })
                    .transition()
                    .duration(500)
                    .attr("width", function(d) {
                            return unselectedBookScale(scrollTop)
                    })

                    .attr("x", 0)




                    bookFingerprint.selectAll(".nodes")
                    .filter(function(d, i) {
                                            return d.BookID == clickedBook
                                        })
                        .transition()
                        .duration(500)
                    .attr("width", function(d) {
                            return selectedBookScale(scrollTop)
                    })
                    .attr("x", function(d, i) {
                        if (i > 5 && thisData[i - 6].ID == d.ID) {
                          //  maxX = (Math.max(maxX, 7))
                            return 7*selectedBookScale(scrollTop)-selectedBookScale(scrollTop)*6
                        } else if (i > 4 && thisData[i - 5].ID == d.ID) {
                        //    maxX = (Math.max(maxX, 6))
                            return 7*selectedBookScale(scrollTop)-selectedBookScale(scrollTop)*5
                        } else if (i > 3 && thisData[i - 4].ID == d.ID) {
                        //    maxX = (Math.max(maxX, 5))
                            return 7*selectedBookScale(scrollTop)-selectedBookScale(scrollTop)*4
                        } else if (i > 2 && thisData[i - 3].ID == d.ID) {
                        //    maxX = (Math.max(maxX, 4))
                            return 7*selectedBookScale(scrollTop)-selectedBookScale(scrollTop)*3
                        } else if (i > 1 && thisData[i - 2].ID == d.ID) {
                          //  maxX = (Math.max(maxX, 3))
                            return 7*selectedBookScale(scrollTop)-selectedBookScale(scrollTop)*2
                        } else if (i != 0 && thisData[i - 1].ID == d.ID) {
                          //  maxX = (Math.max(maxX, 2))
                            return 7*selectedBookScale(scrollTop)-selectedBookScale(scrollTop)
                        } else {
                      //      maxX = (Math.max(maxX, 1))
                            return 7*selectedBookScale(scrollTop)
                        }
                    })

                bookFingerprint.selectAll(".nodesbg")
                    .transition()
                    .duration(500)
                    .attr("width", function(d) {
                        if (d.values[0].BookID == clickedBook) {
                            return selectedBookScale(scrollTop)
                        } else {
                            return unselectedBookScale(scrollTop)
                        }
                    })
                    .attr("x", function(d) {
                        if (d.values[0].BookID == clickedBook) {
                            return 7*selectedBookScale(scrollTop)
                        } else {
                            return 0
                        }
                    })



                bookFingerprint
                    .transition()
                    .duration(500)
                    .attr("transform", function(d, i) {
                        if (i == 0) {
                            posx = 0
                            return "translate(" + (marginleft + (posx)) + "," + (posYCanvas) + ")"
                        } else if (i != 0 && datenByTitle[i - 1].values[0].BookID == clickedBook) {
                            posx = posx + BuchauswahlFeldScale(scrollTop)
                            return "translate(" + (marginleft + (posx)) + "," + (posYCanvas) + ")"
                        } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser) {
                            posx = posx + onSelectionAuthorAbstand
                            return "translate(" + (marginleft + (posx)) + "," + (posYCanvas) + ")"
                        } else {
                            posx = posx + onSelectionBuchAbstand
                            return "translate(" + (marginleft + (posx)) + "," + (posYCanvas) + ")"
                        }
                    })


                bookG
                   .transition()
                   .duration(500)
                    .attr("transform", function(d, i) {
                        if (i == 0) {
                            posx = 0
                            return "translate(" + (marginleft - 2 + (posx)) + "," + (posY) + ")"
                        } else if (i != 0 && datenByTitle[i - 1].values[0].BookID == clickedBook) {
                            posx = posx + BuchauswahlFeldScale(scrollTop)
                            return "translate(" + (marginleft - 2 + (posx)) + "," + (posY) + ")"
                        } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser) {
                            posx = posx + onSelectionAuthorAbstand
                            return "translate(" + (marginleft - 2 + (posx)) + "," + (posY) + ")"
                        } else {
                            posx = posx + onSelectionBuchAbstand
                            return "translate(" + (marginleft - 2 + (posx)) + "," + (posY) + ")"
                        }
                    })


                    d3.selectAll(".bookTitleFrontG")
                    .attr("transform", function(d, i) {
                        if (i == 0) {
                            posx = 0
                            return "translate(" + (marginleft + (posx)-40.5) + "," + (posY) + ")"
                        } else if (i != 0 && datenByTitle[i - 1].values[0].BookID == clickedBook) {
                            posx = posx + BuchauswahlFeldScale(scrollTop)
                            return "translate(" + (marginleft + (posx)-40.5) + "," + (posY) + ")"
                        } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser) {
                            posx = posx + onSelectionAuthorAbstand
                            return "translate(" + (marginleft + (posx)-40.5) + "," + (posY) + ")"
                        } else {
                            posx = posx + onSelectionBuchAbstand
                            return "translate(" + (marginleft + (posx)-40.5) + "," + (posY) + ")"
                        }
                    })





                //    .selectAll("rect")

                //    d3.selectAll(".bookBG").attr("opacity", 1)


                bookG.selectAll(".bookBG")
                    .transition()
                    //.delay(50)
                    .duration(500)
                    .style("opacity", 0)
                    //.attr("fill", function(d){console.log(d.values[0].BookID)})
                    .attr("width", function(d) {
                        if (d.values[0].BookID == clickedBook) {
                            return BuchauswahlFeldScale(scrollTop)
                        } else {
                            return buchBreite
                        }
                    })
                    .filter(function(d){return d.values[0].BookID == clickedBook})
                    .style("fill", "#cec1b8")
                    .style("opacity", 0.3)




                d3.selectAll(".BuchTitel").remove()

                // d3.selectAll(".detailinfo")
                //     .remove()

                    d3.selectAll(".detailInfoParent")
                        .remove()

                detailview = true
                ///Detailinfo bei Klick einblenden
                var detailInfoParent = d3.select(this.parentNode).append("g").attr("class", "detailInfoParent")//.attr("pointer-events", "visible")

                var detailInfo = detailInfoParent.append("g")//.attr("pointer-events", "visible")

                var detailInfoTextBox = detailInfo.append("g").attr("class", "detailInfoTextBox").attr("transform", function(d){return "translate(" + detailInfoTextBoxScale(scrollTop) + "," + 0 + ")"})


                detailInfo.attr("class", "detailinfo")
                .attr("transform", "scale(0,1)")
                .transition()
                .duration(600)
                .attr("transform", "scale(1,1)")








                  detailInfo.append("text")
                      .attr("class", "detail_titel")
                      // .text(function(d) {
                      //     return d.values[0].BuchTitel
                      // })
                      .text(function(d) {if(korpus.filter(function(D,I){return D.KurzSignatur == d.values[0].BookID})[0]){
                          if (korpus.filter(function(D,I){return D.KurzSignatur == d.values[0].BookID})[0].Kurztitel.length > 70) {
                              return (korpus.filter(function(D,I){return D.KurzSignatur == d.values[0].BookID})[0].Kurztitel).substring(0, 70) + " [...]"
                          } else {
                              return korpus.filter(function(D,I){return D.KurzSignatur == d.values[0].BookID})[0].Kurztitel
                          }}
                      })
                      .attr("y", -5)
                      .attr("dy", 0)
                      .attr("text-anchor", "middle")
                      .attr("x", 9*selectedBookScale(scrollTop))
                      .call(wrapUp, 300)
                      .selectAll("tspan")
                      .attr("x", 9*selectedBookScale(scrollTop))
                      .attr("text-anchor", "middle")



    // var detailInfoScale = d3.scaleLinear()
    //     .domain([50, 400])
    //     .range([1, 0])
    //     .clamp(true)


        detailInfoTextBox.attr("opacity", function(d){return detailInfoScale(scrollTop)})


                    detailInfoTextBox.append("image")
                        .attr("xlink:href", function(d) {
                            return "./img/m/" + (d.values.filter(function(D) {
                                return D.Part === "1"
                            })[0].ID) + ".jpg"
                        })
                        //.attr("xlink:href", function(d){return console.log(d.values.filter(function(D){return D.Part === "1"}))})
                        .attr("class", "detail_cover")
                        .attr("y", function() {
                            return 0
                        })
                      //  .attr("x", 10 + 9*selectedBookScale(scrollTop))
                        .attr("height", 250+"px")
                        .attr("width", 190+"px")





                    detailInfoTextBox.append("text")
                        .attr("class", "detail_verfasser")
                        .text(function(d) {
                            return "Verfasser: " + d.values[0].Verfasser
                        })
                        .attr("y", function() {
                            return 270// + (d3.select(".detail_titel")).node().getBBox().height
                        })
                        .attr("dy", 0)
                  //      .attr("x", 10 + 9*selectedBookScale(scrollTop))
                        .call(wrap, 220)
                        .selectAll("tspan")
                        .attr("x", 0)
                      //  .attr("x", 10 + 9*selectedBookScale(scrollTop))


                    detailInfoTextBox.append("text")
                        .attr("class", "detail_genre")
                        .text(function(d) {
                            return "Genre: " + korpus.filter(function(D,I){return D.KurzSignatur == d.values[0].BookID})[0].Formalschlagwort_Genre//d.values[0].Genre
                        })
                        .attr("y", function() {
                            return 290})
                        .attr("dy", 0)
                //        .attr("x", 10 + 9*selectedBookScale(scrollTop))
                        .call(wrap, 200)
                        .selectAll("tspan")
                        .attr("x", 0)
              //          .attr("x", 10 + 9*selectedBookScale(scrollTop))


                    detailInfoTextBox.append("text")
                        .attr("class", "detail_year")
                        .text(function(d) {
                        return "Datierung: " + korpus.filter(function(D,I){return D.KurzSignatur == d.values[0].BookID})[0].Jahr//d.values[0].Genre
                    })
                        .attr("y", function() {
                            return 310// + ((d3.select(".detail_genre")).node().getBBox().height) + ((d3.select(".detail_titel")).node().getBBox().height) + (d3.select(".detail_verfasser")).node().getBBox().height
                        })
                        .attr("dy", 0)
//                        .attr("x", 10 + 9*selectedBookScale(scrollTop))


                    detailInfoTextBox.append("text")
                        .attr("class", "detail_seitenzahl")
                        .text(function(d) {
                            return "Seitenzahl: " + d.values[0].maxPart
                        })
                        .attr("y", function() {
                            return 330 //+ ((d3.select(".detail_year")).node().getBBox().height) + ((d3.select(".detail_genre")).node().getBBox().height) + ((d3.select(".detail_titel")).node().getBBox().height) + (d3.select(".detail_verfasser")).node().getBBox().height
                        })
                        .attr("dy", 0)
                    //    .attr("x", 10 + 9*selectedBookScale(scrollTop))


                        detailInfoTextBox.append("text")
                            .attr("class", "eigentumsangaben")
                            .text(function(d) {
                                return "Provenienzangaben: "  +thisData.filter(function(d){return d.SchriftspurTyp == "P"}).length
                            })
                            .attr("y", function() {
                                return 350 //+ ((d3.select(".detail_year")).node().getBBox().height) + ((d3.select(".detail_genre")).node().getBBox().height) + ((d3.select(".detail_titel")).node().getBBox().height) + (d3.select(".detail_verfasser")).node().getBBox().height
                            })
                            .attr("dy", 0)
                //            .attr("x", 10 + 9*selectedBookScale(scrollTop))


                            detailInfoTextBox.append("text")
                                .attr("class", "markierungen")
                                .text(function(d) {
                                    return "Markierungen: "  +thisData.filter(function(d){return d.Benutzungsspur == "1" || d.Benutzungsspur == "1?" ||
                                    d.Benutzungsspur == "2" || d.Benutzungsspur == "2?" ||
                                    d.Benutzungsspur == "3" || d.Benutzungsspur == "3?" ||
                                    d.Benutzungsspur == "4" || d.Benutzungsspur == "4?" ||
                                    d.Benutzungsspur == "7" || d.Benutzungsspur == "7?"
                                  }).length
                                })
                                .attr("y", function() {
                                    return 370 //+ ((d3.select(".detail_year")).node().getBBox().height) + ((d3.select(".detail_genre")).node().getBBox().height) + ((d3.select(".detail_titel")).node().getBBox().height) + (d3.select(".detail_verfasser")).node().getBBox().height
                                })
                                .attr("dy", 0)
                    //            .attr("x", 10 + 9*selectedBookScale(scrollTop))



                                detailInfoTextBox.append("text")
                                    .attr("class", "marginalien")
                                    .text(function(d) {
                                        return "Marginalien: "  +thisData.filter(function(d){return d.Benutzungsspur == "5" && d.SchriftspurTyp != "P"}).length
                                    })
                                    .attr("y", function() {
                                        return 390 //+ ((d3.select(".detail_year")).node().getBBox().height) + ((d3.select(".detail_genre")).node().getBBox().height) + ((d3.select(".detail_titel")).node().getBBox().height) + (d3.select(".detail_verfasser")).node().getBBox().height
                                    })
                                    .attr("dy", 0)
                      //              .attr("x", 10 + 9*selectedBookScale(scrollTop))



                                    detailInfoTextBox.append("text")
                                        .attr("class", "zusatzMaterial")
                                        .text(function(d) {
                                            return "Sonstiges Material: "  +thisData.filter(function(d){return d.Benutzungsspur == "6" || d.Benutzungsspur == "6?"}).length
                                        })
                                        .attr("y", function() {
                                            return 410 //+ ((d3.select(".detail_year")).node().getBBox().height) + ((d3.select(".detail_genre")).node().getBBox().height) + ((d3.select(".detail_titel")).node().getBBox().height) + (d3.select(".detail_verfasser")).node().getBBox().height
                                        })
                                        .attr("dy", 0)
                    //                    .attr("x", 10 + 9*selectedBookScale(scrollTop))

                                        var detailTranscriptScale = d3.scaleLinear()
                                            .domain([-0.01,0, 380])
                                            .range([0,1, 1])
                                            .clamp(true)

var transcriptions = detailInfoParent.append("g").attr("clip-path","url(#transcript-clip)").append("g").classed("transcriptions", true).attr("opacity", function(d){return detailTranscriptScale(scrollTop)})

var transcriptData = thisData.filter(function(d){return d.SchriftspurTranskription!= "null"})

var explicateScale2 = d3.scaleLinear()
    .domain([500, 2500])
    .range([pageheight, 31])
    .clamp(true)
//var lasttranscripty = 0

// var transcriptFontSize = d3.scaleLinear()
//     .domain([500, 3000])
//     .range([1.5, 12])
//     .clamp(true)
//


transcriptions.selectAll("text")
.data(transcriptData)
.enter()
.append("text")
.text(function(d){return d.SchriftspurTranskription})
.style("font-size", 12 + "px")
.attr("x", transcriptPositionScale(scrollTop)*selectedBookScale(scrollTop)+10)
.attr("y", function(d,i){
          if (i == 0){
            return transcriptYStart(scrollTop)+(explicateScale2(scrollTop))*d.Part}
          else {
            return transcriptYStart(scrollTop)+(explicateScale2(scrollTop))*d.Part}})
.attr("dy", 0)
.attr("dx", 0)
.attr("class", function(d,i){if(d.Schreibmedium == "Stempel"){return "stempel"} else {return "handschrift"}})
.classed("transcriptText", true)
.style("fill", function(d){if(d.Schreibmedium == "Bleistift" || d.Schreibmedium == "Bleistift?"){return "grey"}else if(d.Schreibmedium == "Tinte" || d.Schreibmedium == "Tinte?"){return "black"}
else if(d.Schreibmedium == "roter Buntstift" || d.Schreibmedium == "roter Buntstift?"){return "red"}  else if(d.Schreibmedium == "lila Buntstift"){return "DarkOrchid"}
else if(d.Schreibmedium == "blauer Buntstift"){return "blue"}})
.text(function(d,i){return d.SchriftspurTranskription})
.call(wraptext, 270)
.selectAll("tspan")
.attr("x", transcriptPositionScale(scrollTop)*selectedBookScale(scrollTop)+10)

transcriptions.selectAll("text").classed("transcriptionText", true).style("font-size", function(){return transcriptFontSize(scrollTop)+ "px"})


d3.selectAll(".transcriptionText")
 .each(function(d,i){
   if(i>0){
   var thisTranscriptY = d3.select(this).node().getBBox().y
   var lastTranscriptMaxY = d3.selectAll(".transcriptionText").filter(function(D,I){return I == i-1}).node().getBBox().y + d3.selectAll(".transcriptionText").filter(function(D,I){return I == i-1}).node().getBBox().height

   if (thisTranscriptY <= lastTranscriptMaxY){
     d3.select(this)
     .attr("y", function(){
       return lastTranscriptMaxY+transcriptFontSize(scrollTop)})
       .selectAll("tspan").attr("y", function(){
          return lastTranscriptMaxY+transcriptFontSize(scrollTop)})

      transcriptions.append("circle")
      .attr("r", detailCircleScale(scrollTop))
      .attr("fill", "white")
      // .attr("fill", function(d){ if (d.SchriftspurTyp == "P" && d.Schreibmedium != "Stempel") {
      //     return "#5B5B5B"
      // } else if (d.SchriftspurTyp == "P" && d.Schreibmedium == "Stempel") {
      //     return "#5B5B5B"
      // } else if (d.SchriftspurTyp == "B") {
      //     return "#f72652"
      // } else if (d.SchriftspurTyp == "K") {
      //     return "#f72652"
      // } else if (d.SchriftspurTyp == "T") {
      //     return "#f72652"
      // } else if (d.SchriftspurTyp == "U") {
      //     return "#f72652"
      // } else if (d.SchriftspurTyp == "V") {
      //     return "#f72652"
      // }})
      .attr("cx",  transcriptPositionScale(scrollTop)*selectedBookScale(scrollTop))
      .attr("cy", lastTranscriptMaxY+transcriptFontSize(scrollTop)-3)


////line between transcript and rect
      transcriptions.append("path")
      .style("stroke", "white")
      .style("stroke-width", 1)
      .style("opacity", .7)
      .style("fill", "none")
      //.style("stroke-dasharray", "1,2")
      .attr("d", function(d, i){
          var line = d3.line().curve(d3.curveBasis)
          var data = [[transcriptPositionScale(scrollTop)*selectedBookScale(scrollTop)-3, lastTranscriptMaxY+transcriptFontSize(scrollTop)-3], [transcriptPositionScale(scrollTop)*selectedBookScale(scrollTop)-20, lastTranscriptMaxY+transcriptFontSize(scrollTop)-3],  [8*selectedBookScale(scrollTop)+20, thisTranscriptY+15], [8*selectedBookScale(scrollTop), thisTranscriptY+15]];

          return line(data)
      })


    }else{
        transcriptions.append("circle")
        .attr("r", detailCircleScale(scrollTop))
        .attr("fill", "white")
        .attr("cx",  transcriptPositionScale(scrollTop)*selectedBookScale(scrollTop))
        .attr("cy", thisTranscriptY+transcriptFontSize(scrollTop)-6)

        ////line between transcript and rect
              transcriptions.append("path")
              .style("stroke", "white")
              .style("stroke-width", 1)
              .style("opacity", .7)
              .style("fill", "none")
              //.style("stroke-dasharray", "1,2")
              .attr("d", function(d, i){
                  var line = d3.line().curve(d3.curveBasis)
                  var data = [[transcriptPositionScale(scrollTop)*selectedBookScale(scrollTop)-3, thisTranscriptY+transcriptFontSize(scrollTop)-6], [transcriptPositionScale(scrollTop)*selectedBookScale(scrollTop)-20, thisTranscriptY+transcriptFontSize(scrollTop)-6],  [8*selectedBookScale(scrollTop)+20, thisTranscriptY+transcriptFontSize(scrollTop)-6], [8*selectedBookScale(scrollTop), thisTranscriptY+15]];

                  return line(data)
              })



    }

 }
else{
var thisTranscriptY = d3.select(this).node().getBBox().y

  transcriptions.append("circle")
  .attr("r", detailCircleScale(scrollTop))
  .attr("fill", "white")
  .attr("cx",  transcriptPositionScale(scrollTop)*selectedBookScale(scrollTop))
  .attr("cy", thisTranscriptY+transcriptFontSize(scrollTop)-6)


  ////line between transcript and rect
        transcriptions.append("path")
        .style("stroke", "white")
        .style("stroke-width", 1)
        .style("opacity", .7)
        .style("fill", "none")
        //.style("stroke-dasharray", "1,2")
        .attr("d", function(d, i){
            var line = d3.line().curve(d3.curveBasis)
            var data = [[transcriptPositionScale(scrollTop)*selectedBookScale(scrollTop)-3, thisTranscriptY+transcriptFontSize(scrollTop)-6], [transcriptPositionScale(scrollTop)*selectedBookScale(scrollTop)-20, thisTranscriptY+transcriptFontSize(scrollTop)-6],  [8*selectedBookScale(scrollTop)+20, thisTranscriptY+transcriptFontSize(scrollTop)-6], [8*selectedBookScale(scrollTop), thisTranscriptY+15]];

            return line(data)
        })

}})

d3.selectAll(".transcriptions").selectAll("path")
.style("opacity", transcriptPathScaleOpacity(scrollTop))

            }



            ////////// Text-Wrap Function Anfang///
            ///////////////////////////////////////
            ///////////////////////////////////////

            function wrap(text, width) {

                text.each(function() {
                    var lineNumber = 0
                    var text = d3.select(this),
                        words = text.text().split(/\s+/).reverse(),
                        word,
                        line = []

                    var lineHeight = 1.1, // ems
                        y = text.attr("y"),
                        dy = parseFloat(text.attr("dy")),
                        tspan = text.text(null).append("tspan").attr("y", y).attr("dy", dy + "em")


                    while (word = words.pop()) {
                        line.push(word);
                        tspan.text(line.join(" "));
                        if (tspan.node().getComputedTextLength() > width) {
                            line.pop();
                            tspan.text(line.join(" "));
                            line = [word];
                            lineNumber = lineNumber + 1
                            tspan = text.append("tspan").attr("y", y).attr("dy", lineNumber * lineHeight + dy + "em").text(word);
                        }
                    }

                });

            }


            function wrapUp(text, width) {
              text.each(function() {
                var text = d3.select(this),
                    words = text.text().split(/\s+/).reverse(),
                    word,
                    line = [],
                    lineNumber = 0,
                    lineHeight = 1.1, // ems
                    y = text.attr("y"),
                    dy = parseFloat(text.attr("dy")),
                    tspan = text.text(null).append("tspan").attr("y", y).attr("dy", dy + "em");
                while (word = words.pop()) {
                  line.push(word);
                  tspan.text(line.join(" "));
                  if (tspan.node().getComputedTextLength() > width) {
                    line.pop();
                    tspan.text(line.join(" "));
                    line = [word];
                    lineNumber= lineNumber+1

                    tspan = text.append("tspan")
                    //  .attr("y", function(d,i){if(lineNumber >= 0 ){return y-40} else {return y}})
                      .attr("y", y)
                      .attr("dy", lineNumber * lineHeight + "em").text(word);
                  }
                }

                var tspanCount= text.selectAll("tspan").size();
                text.attr("transform", "translate(" + 0 + "," + -((tspanCount-1)*15) + ")");
              });
            }


            /////Text
            ////Text-Wrap function
            function wraptext(text, width) {
              text.each(function() {
                var text = d3.select(this),
                    words = text.text().split(/\s+/).reverse(),
                    word,
                    line = [],
                    lineNumber = 0,
                    lineHeight = 1.1, // ems
                    y = text.attr("y"),
                    dy = parseFloat(text.attr("dy")),
                    tspan = text.text(null).append("tspan").attr("y", y).attr("dy", dy + "em");
                while (word = words.pop()) {
                  line.push(word);
                  tspan.text(line.join(" "));
                  if (tspan.node().getComputedTextLength() > width) {
                    line.pop();
                    tspan.text(line.join(" "));
                    line = [word];
                    tspan = text.append("tspan").attr("y", y).attr("dy", ++lineNumber * lineHeight + dy + "em").text(word);
                  }
                }
              });
            }



            ////////// Text-Wrap Function Ende/////
            ///////////////////////////////////////
            ///////////////////////////////////////











            ////////// Filter Interaction///////////
            ///////////////////////////////////////
            ///////////////////////////////////////


            d3.select("h1").on("click", function() {
                transitions = true
                setTimeout(function() {
                    transitions = false
                }, 1000);
                dataContainer.selectAll(".nodes")
                    .transition()
                    .attr("opacity", 1)
            })

            function filterInteraction() {
                transitions = true
                setTimeout(function() {
                    transitions = false
                }, 1000);
                if (filter == null) {
                  areachart.selectAll("path").classed("filtered", false).classed("eingefaltet", true)

                    dataContainer.selectAll(".nodes")
                        .attr("opacity", 1)

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.SchriftspurTyp == "P" && d.Schreibmedium != "Stempel"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "#5B5B5B")

                        dataContainer.selectAll(".nodes")
                            .filter(function(d) {
                                return d.SchriftspurTyp == "P" && d.Schreibmedium == "Stempel"
                            })
                            .attr("opacity", 1)
                            .transition()
                            .attr("fill", "#5B5B5B")


                            dataContainer.selectAll(".nodes")
                                .filter(function(d) {
                                    return d.Benutzungsspur === "1" || d.Benutzungsspur === "1?"
                                })
                                .attr("opacity", 1)
                                .transition()
                                .attr("fill", "#58b0f7")

                                dataContainer.selectAll(".nodes")
                                    .filter(function(d) {
                                        return d.Benutzungsspur === "2" || d.Benutzungsspur === "2?"
                                    })
                                    .attr("opacity", 1)
                                    .transition()
                                    .attr("fill", "#58b0f7")

                                    dataContainer.selectAll(".nodes")
                                        .filter(function(d) {
                                            return d.Benutzungsspur === "3" || d.Benutzungsspur === "3?"
                                        })
                                        .attr("opacity", 1)
                                        .transition()
                                        .attr("fill", "#58b0f7")

                                        dataContainer.selectAll(".nodes")
                                            .filter(function(d) {
                                                return d.Benutzungsspur === "4" || d.Benutzungsspur === "4?"
                                            })
                                            .attr("opacity", 1)
                                            .transition()
                                            .attr("fill", "#58b0f7")

                                            dataContainer.selectAll(".nodes")
                                                .filter(function(d) {
                                                    return d.Benutzungsspur === "6" || d.Benutzungsspur === "6?"
                                                })
                                                .attr("opacity", 1)
                                                .transition()
                                                .attr("fill", "rgb(72, 184, 112)")

                                                dataContainer.selectAll(".nodes")
                                                    .filter(function(d) {
                                                        return d.SchriftspurTyp == "B"
                                                    })
                                                    .attr("opacity", 1)
                                                    .transition()
                                                    .attr("fill", "#f72652")

                                                    dataContainer.selectAll(".nodes")
                                                        .filter(function(d) {
                                                            return d.SchriftspurTyp == "K"
                                                        })
                                                        .attr("opacity", 1)
                                                        .transition()
                                                        .attr("fill", "#f72652")

                                                        dataContainer.selectAll(".nodes")
                                                            .filter(function(d) {
                                                                return d.SchriftspurTyp == "T"
                                                            })
                                                            .attr("opacity", 1)
                                                            .transition()
                                                            .attr("fill", "#f72652")

                                                            dataContainer.selectAll(".nodes")
                                                                .filter(function(d) {
                                                                    return d.SchriftspurTyp == "V"
                                                                })
                                                                .attr("opacity", 1)
                                                                .transition()
                                                                .attr("fill", "#f72652")

                                                                dataContainer.selectAll(".nodes")
                                                                    .filter(function(d) {
                                                                        return d.SchriftspurTyp == "U"
                                                                    })
                                                                    .attr("opacity", 1)
                                                                    .transition()
                                                                    .attr("fill", "#f72652")

                                                                    dataContainer.selectAll(".nodes")
                                                                        .filter(function(d) {
                                                                            return d.Benutzungsspur === "7" || d.Benutzungsspur === "7?"
                                                                        })
                                                                        .attr("opacity", 1)
                                                                        .transition()
                                                                        .attr("fill", "#ab56c4")

                }else if (filter == "Fontane") {

                    areachart.selectAll("path").classed("filtered", true).filter(".schreibhandFontane").classed("filtered", false)

                    dataContainer.selectAll(".nodes")
                    .attr("opacity", 0)
                        .transition()
                        .attr("fill", "white")

                        dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.SchriftspurSchreibhand == "Theodor Fontane" || d.SchriftspurSchreibhand == "?Theodor Fontane?"
                        })
                            .filter(function(d) {
                                return d.SchriftspurTyp == "B"
                            })
                            .attr("opacity", 1)
                            .transition()
                            .attr("fill", "#F74141")

                            dataContainer.selectAll(".nodes")
                            .filter(function(d) {
                                return d.SchriftspurSchreibhand == "Theodor Fontane" || d.SchriftspurSchreibhand == "?Theodor Fontane?"
                            })
                                .filter(function(d) {
                                    return d.SchriftspurTyp == "K"
                                })
                                .attr("opacity", 1)
                                .transition()
                                .attr("fill", "#FF8A5D")

                                dataContainer.selectAll(".nodes")
                                .filter(function(d) {
                                    return d.SchriftspurSchreibhand == "Theodor Fontane" || d.SchriftspurSchreibhand == "?Theodor Fontane?"
                                })
                                    .filter(function(d) {
                                        return d.SchriftspurTyp == "T"
                                    })
                                    .attr("opacity", 1)
                                    .transition()
                                    .attr("fill", "#8D084E")

                                    dataContainer.selectAll(".nodes")
                                    .filter(function(d) {
                                        return d.SchriftspurSchreibhand == "Theodor Fontane" || d.SchriftspurSchreibhand == "?Theodor Fontane?"
                                    })
                                        .filter(function(d) {
                                            return d.SchriftspurTyp == "V"
                                        })
                                        .attr("opacity", 1)
                                        .transition()
                                        .attr("fill", "#FD9698")

                                        dataContainer.selectAll(".nodes")
                                        .filter(function(d) {
                                            return d.SchriftspurSchreibhand == "Theodor Fontane" || d.SchriftspurSchreibhand == "?Theodor Fontane?"
                                        })
                                            .filter(function(d) {
                                                return d.SchriftspurTyp == "U"
                                            })
                                            .attr("opacity", 1)
                                            .transition()
                                            .attr("fill", "#f93593")



                }  else if (filter == "Familie") {

                      areachart.selectAll("path").classed("filtered", true).filter(".schreibhandFamilie").classed("filtered", false)

                      dataContainer.selectAll(".nodes")
                      .attr("opacity", 0)
                          .transition()
                          .attr("fill", "white")

                          dataContainer.selectAll(".nodes")
                          .filter(function(d) {
                              return d.SchriftspurSchreibhand == "Emilie Fontane" || d.SchriftspurSchreibhand == "?Emilie Fontane?"
                                  || d.SchriftspurSchreibhand == "Friedrich Fontane" || d.SchriftspurSchreibhand == "?Friedrich Fontane?"
                                  || d.SchriftspurSchreibhand == "Georg Fontane" || d.SchriftspurSchreibhand == "Georg Fontane?"
                                  || d.SchriftspurSchreibhand == "Theodor Fontane jr."
                          })
                              .filter(function(d) {
                                  return d.SchriftspurTyp == "B"
                              })
                              .attr("opacity", 1)
                              .transition()
                              .attr("fill", "#F74141")

                              dataContainer.selectAll(".nodes")
                              .filter(function(d) {
                                  return d.SchriftspurSchreibhand == "Emilie Fontane" || d.SchriftspurSchreibhand == "?Emilie Fontane?"
                                      || d.SchriftspurSchreibhand == "Friedrich Fontane" || d.SchriftspurSchreibhand == "?Friedrich Fontane?"
                                      || d.SchriftspurSchreibhand == "Georg Fontane" || d.SchriftspurSchreibhand == "Georg Fontane?"
                                      || d.SchriftspurSchreibhand == "Theodor Fontane jr."
                              })
                                  .filter(function(d) {
                                      return d.SchriftspurTyp == "K"
                                  })
                                  .attr("opacity", 1)
                                  .transition()
                                  .attr("fill", "#FF8A5D")

                                  dataContainer.selectAll(".nodes")
                                  .filter(function(d) {
                                      return d.SchriftspurSchreibhand == "Emilie Fontane" || d.SchriftspurSchreibhand == "?Emilie Fontane?"
                                          || d.SchriftspurSchreibhand == "Friedrich Fontane" || d.SchriftspurSchreibhand == "?Friedrich Fontane?"
                                          || d.SchriftspurSchreibhand == "Georg Fontane" || d.SchriftspurSchreibhand == "Georg Fontane?"
                                          || d.SchriftspurSchreibhand == "Theodor Fontane jr."
                                  })
                                      .filter(function(d) {
                                          return d.SchriftspurTyp == "T"
                                      })
                                      .attr("opacity", 1)
                                      .transition()
                                      .attr("fill", "#8D084E")

                                      dataContainer.selectAll(".nodes")
                                      .filter(function(d) {
                                          return d.SchriftspurSchreibhand == "Emilie Fontane" || d.SchriftspurSchreibhand == "?Emilie Fontane?"
                                              || d.SchriftspurSchreibhand == "Friedrich Fontane" || d.SchriftspurSchreibhand == "?Friedrich Fontane?"
                                              || d.SchriftspurSchreibhand == "Georg Fontane" || d.SchriftspurSchreibhand == "Georg Fontane?"
                                              || d.SchriftspurSchreibhand == "Theodor Fontane jr."
                                      })
                                          .filter(function(d) {
                                              return d.SchriftspurTyp == "V"
                                          })
                                          .attr("opacity", 1)
                                          .transition()
                                          .attr("fill", "#FD9698")

                                          dataContainer.selectAll(".nodes")
                                          .filter(function(d) {
                                              return d.SchriftspurSchreibhand == "Emilie Fontane" || d.SchriftspurSchreibhand == "?Emilie Fontane?"
                                                  || d.SchriftspurSchreibhand == "Friedrich Fontane" || d.SchriftspurSchreibhand == "?Friedrich Fontane?"
                                                  || d.SchriftspurSchreibhand == "Georg Fontane" || d.SchriftspurSchreibhand == "Georg Fontane?"
                                                  || d.SchriftspurSchreibhand == "Theodor Fontane jr."
                                          })
                                              .filter(function(d) {
                                                  return d.SchriftspurTyp == "U"
                                              })
                                              .attr("opacity", 1)
                                              .transition()
                                              .attr("fill", "#f93593")



                  }
                else if (filter == "eigentumsangaben") {

                    areachart.selectAll("path").classed("filtered", true).filter(".provenienz,.provenienzstempel").classed("filtered", false)

                    dataContainer.selectAll(".nodes")
                    .attr("opacity", 0)
                        .transition()
                        .attr("fill", "white")

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.SchriftspurTyp == "P" && d.Schreibmedium != "Stempel"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "#575757")

                        dataContainer.selectAll(".nodes")
                            .filter(function(d) {
                                return d.SchriftspurTyp == "P" && d.Schreibmedium == "Stempel"
                            })
                            .attr("opacity", 1)
                            .transition()
                            .attr("fill", "#828282")
                }
                else if (filter == "provenienz") {

                    areachart.selectAll("path").classed("filtered", true).filter(".provenienz").classed("filtered", false)

                    dataContainer.selectAll(".nodes")
                    .attr("opacity", 0)
                        .transition()
                        .attr("fill", "white")

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.SchriftspurTyp == "P" && d.Schreibmedium != "Stempel"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "#575757")


                } else if (filter == "provenienzstempel") {

                    areachart.selectAll("path").classed("filtered", true).filter(".provenienzstempel").classed("filtered", false)

                    dataContainer.selectAll(".nodes")
                    .attr("opacity", 0)
                        .transition()
                        .attr("fill", "white")

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.SchriftspurTyp == "P" && d.Schreibmedium == "Stempel"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "#828282")

                      } else if (filter == "markierungen") {

                        areachart.selectAll("path").classed("filtered", true).filter(".unterstreichung,.anstreichung,.durchstreichung,.sonstigeMarkierung").classed("filtered", false)

                          dataContainer.selectAll(".nodes")
                          .attr("opacity", 0)
                              .transition()
                              .attr("fill", "white")


                              dataContainer.selectAll(".nodes")
                                  .filter(function(d) {
                                      return d.Benutzungsspur === "1" || d.Benutzungsspur === "1?"
                                  })
                                  .attr("opacity", 1)
                                  .transition()
                                  .attr("fill", "#018DC9")

                                  dataContainer.selectAll(".nodes")
                                      .filter(function(d) {
                                          return d.Benutzungsspur === "2" || d.Benutzungsspur === "2?"
                                      })
                                      .attr("opacity", 1)
                                      .transition()
                                      .attr("fill", "#415aff")

                                      dataContainer.selectAll(".nodes")
                                          .filter(function(d) {
                                              return d.Benutzungsspur === "3" || d.Benutzungsspur === "3?"
                                          })
                                          .attr("opacity", 1)
                                          .transition()
                                          .attr("fill", "#4020d0")

                                          dataContainer.selectAll(".nodes")
                                              .filter(function(d) {
                                                  return d.Benutzungsspur === "4" || d.Benutzungsspur === "4?"
                                              })
                                              .attr("opacity", 1)
                                              .transition()
                                              .attr("fill", "#29D1E2")





                      } else if (filter == "anstreichung") {

                        areachart.selectAll("path").classed("filtered", true).filter(".anstreichung").classed("filtered", false)

                          dataContainer.selectAll(".nodes")
                          .attr("opacity", 0)
                              .transition()
                              .attr("fill", "white")

                          dataContainer.selectAll(".nodes")
                              .filter(function(d) {
                                  return d.Benutzungsspur === "1" || d.Benutzungsspur === "1?"
                              })
                              .attr("opacity", 1)
                              .transition()
                              .attr("fill", "#018DC9")


                } else if (filter == "unterstreichung") {

                  areachart.selectAll("path").classed("filtered", true).filter(".unterstreichung").classed("filtered", false)

                    dataContainer.selectAll(".nodes")
                    .attr("opacity", 0)
                        .transition()
                        .attr("fill", "white")

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.Benutzungsspur === "2" || d.Benutzungsspur === "2?"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "#415aff")
                } else if (filter == "durchstreichung") {

                  areachart.selectAll("path").classed("filtered", true).filter(".durchstreichung").classed("filtered", false)

                    dataContainer.selectAll(".nodes")
                    .attr("opacity", 0)
                        .transition()
                        .attr("fill", "white")

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.Benutzungsspur === "3" || d.Benutzungsspur === "3?"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "#4020d0")
                } else if (filter == "sonstigeMarkierung") {

areachart.selectAll("path").classed("filtered", true).filter(".sonstigeMarkierung").classed("filtered", false)

                    dataContainer.selectAll(".nodes")
                    .attr("opacity", 0)
                        .transition()
                        .attr("fill", "white")

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.Benutzungsspur === "4" || d.Benutzungsspur === "4?"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "#29D1E2")
                } else if (filter == "zusatzMaterial") {
                  areachart.selectAll("path").classed("filtered", true).filter(".zusatzMaterial").classed("filtered", false)

                    dataContainer.selectAll(".nodes")
                    .attr("opacity", 0)
                        .transition()
                        .attr("fill", "white")

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.Benutzungsspur === "6" || d.Benutzungsspur === "6?"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "rgb(72, 184, 112)")

                      } else if (filter == "marginalien") {
                        areachart.selectAll("path").classed("filtered", true).filter(".bewertung,.kommentar,.textkorrektur,.uebersetzung,.variante").classed("filtered", false)

                          dataContainer.selectAll(".nodes")
                          .attr("opacity", 0)
                              .transition()
                              .attr("fill", "white")

                              dataContainer.selectAll(".nodes")
                                  .filter(function(d) {
                                      return d.SchriftspurTyp == "B"
                                  })
                                  .attr("opacity", 1)
                                  .transition()
                                  .attr("fill", "#F74141")

                                  dataContainer.selectAll(".nodes")
                                      .filter(function(d) {
                                          return d.SchriftspurTyp == "K"
                                      })
                                      .attr("opacity", 1)
                                      .transition()
                                      .attr("fill", "#FF8A5D")

                                      dataContainer.selectAll(".nodes")
                                          .filter(function(d) {
                                              return d.SchriftspurTyp == "T"
                                          })
                                          .attr("opacity", 1)
                                          .transition()
                                          .attr("fill", "#8D084E")

                                          dataContainer.selectAll(".nodes")
                                              .filter(function(d) {
                                                  return d.SchriftspurTyp == "V"
                                              })
                                              .attr("opacity", 1)
                                              .transition()
                                              .attr("fill", "#FD9698")

                                              dataContainer.selectAll(".nodes")
                                                  .filter(function(d) {
                                                      return d.SchriftspurTyp == "U"
                                                  })
                                                  .attr("opacity", 1)
                                                  .transition()
                                                  .attr("fill", "#f93593")


                } else if (filter == "bewertung") {
                  areachart.selectAll("path").classed("filtered", true).filter(".bewertung").classed("filtered", false)


                    dataContainer.selectAll(".nodes")
                    .attr("opacity", 0)
                        .transition()
                        .attr("fill", "white")

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.SchriftspurTyp == "B"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "#F74141")
                } else if (filter == "kommentar") {
                  areachart.selectAll("path").classed("filtered", true).filter(".kommentar").classed("filtered", false)

                    dataContainer.selectAll(".nodes")
                    .attr("opacity", 0)
                        .transition()
                        .attr("fill", "white")

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.SchriftspurTyp == "K"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "#FF8A5D")
                } else if (filter == "textkorrektur") {
                  areachart.selectAll("path").classed("filtered", true).filter(".textkorrektur").classed("filtered", false)

                    dataContainer.selectAll(".nodes")
                    .attr("opacity", 0)
                        .transition()
                        .attr("fill", "white")

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.SchriftspurTyp == "T"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "#8D084E")
                } else if (filter == "variante") {
                  areachart.selectAll("path").classed("filtered", true).filter(".variante").classed("filtered", false)

                    dataContainer.selectAll(".nodes")
                    .attr("opacity", 0)
                        .transition()
                        .attr("fill", "white")

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.SchriftspurTyp == "V"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "#FD9698")
                } else if (filter == "uebersetzung") {
                  areachart.selectAll("path").classed("filtered", true).filter(".uebersetzung").classed("filtered", false)

                    dataContainer.selectAll(".nodes")
                    .attr("opacity", 0)
                        .transition()
                        .attr("fill", "white")

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.SchriftspurTyp == "U"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "#f93593")
                } else if (filter == "anderes") {
                  areachart.selectAll("path").classed("filtered", true).filter(".anderes").classed("filtered", false)

                    dataContainer.selectAll(".nodes")
                    .attr("opacity", 0)
                        .transition()
                        .attr("fill", "white")

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.Benutzungsspur === "7" || d.Benutzungsspur === "7?"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "#ab56c4")
                } else if (filter == "leer") {
                    dataContainer.selectAll(".nodes")
                    .attr("opacity", 0)
                        .transition()
                        .attr("fill", "white")

                    dataContainer.selectAll(".nodes")
                        .filter(function(d) {
                            return d.Benutzungsspur === "null"
                        })
                        .attr("opacity", 1)
                        .transition()
                        .attr("fill", "white")
                }


            }



            ////////// Filter Interaction Ende/////
            ///////////////////////////////////////
            ///////////////////////////////////////



            function animate() {

                if (transitions == true || scrollTop !== newScrollTop) {
                    scrollTop = newScrollTop
                    scrollFunction()
                    draw()

                }
                window.requestAnimationFrame(animate);
            }
            window.requestAnimationFrame(animate);





function hashFunction(){
if (scrollTop < -3000){
  window.location.hash = "#level=distanz"+"?filter="+filter+"?auswahl="+clickedBook

}else if(scrollTop >= -3000 && scrollTop <= 1200){

  window.location.hash = "#level=start"+"?filter="+filter+"?auswahl="+clickedBook

}else if(scrollTop > 1200 ){
  window.location.hash = "#level=detail"+"?filter="+filter+"?auswahl="+clickedBook

}
}

var fullHash = 0
var level = "start"

function hashLoad(){
  if (window.location.hash == ""){
    setTimeout(function() {

      window.scrollTo(0, 6000)
    }, 10);
  }

  else if (window.location.hash != ""){
  fullHash = window.location.hash.split("?");
  console.log(fullHash)
  level = fullHash[0].substring(7)
  filter = fullHash[1].substring(7)
  //clickedBook = fullHash[2].substring(8)
  console.log(level)
  console.log(filter)
  console.log(clickedBook)

if (filter == "eigentumsangaben" || filter == "provenienz" || filter == "provenienzstempel"){

    farbausfaltungProvenienz()
    eigentumsangaben.selectAll(".EigentumsangabenPlus").text(" ⊖")
    markierungen.selectAll(".MarkierungenPlus").text(" ⊕")
    marginalien.selectAll(".MarginalienPlus").text(" ⊕")
    eigentumsangaben.selectAll("text").style("font-weight", "bolder").style("opacity", 1)
    zusatzMaterial.selectAll("text").style("font-weight", "400").style("opacity",.6)
    marginalien.selectAll("text").style("font-weight", "400").style("opacity", .6)
    markierungen.selectAll("text").style("font-weight", "400").style("opacity", .6)

    eigentumsangabendetail.transition().duration(800).attr("transform", "scale(1,1)").style("opacity", 1)
    markierungendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 1)
    marginaliendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 1)

}else if (filter == "markierungen" || filter == "anstreichung" || filter == "unterstreichung" || filter == "durchstreichung" || filter == "sonstigeMarkierung" ){
  farbausfaltungMarkierung()

  eigentumsangaben.selectAll(".EigentumsangabenPlus").text(" ⊕")
  markierungen.selectAll(".MarkierungenPlus").text(" ⊖")
  marginalien.selectAll(".MarginalienPlus").text(" ⊕")
  markierungen.selectAll("text").style("font-weight", "bolder").style("opacity", 1)
  zusatzMaterial.selectAll("text").style("font-weight", "400").style("opacity", .6)
  marginalien.selectAll("text").style("font-weight", "400").style("opacity", .6)
  eigentumsangaben.selectAll("text").style("font-weight", "400").style("opacity", .6)

  eigentumsangabendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 1)
  markierungendetail.transition().duration(800).attr("transform", "scale(1,1)").style("opacity", 1)
  marginaliendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 1)
}else if (filter == "marginalien" || filter == "bewertung" || filter == "kommentar" || filter == "textkorrektur" || filter == "variante" || filter == "uebersetzung"){
  farbausfaltungMarginalien()

  marginalien.selectAll(".MarginalienPlus").text(" ⊖")
  marginalien.selectAll("text").style("font-weight", "bolder")
  marginaliendetail.transition().duration(800).attr("transform", "scale(1,1)").style("opacity", 1)

  eigentumsangaben.selectAll(".EigentumsangabenPlus").text(" ⊕")
  markierungen.selectAll(".MarkierungenPlus").text(" ⊕")
  marginalien.selectAll(".MarginalienPlus").text(" ⊖")
  marginalien.selectAll("text").style("font-weight", "bolder").style("opacity", 1)
  zusatzMaterial.selectAll("text").style("font-weight", "400").style("opacity", .6)
  markierungen.selectAll("text").style("font-weight", "400").style("opacity", .6)
  eigentumsangaben.selectAll("text").style("font-weight", "400").style("opacity", .6)

  eigentumsangabendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 1)
  markierungendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 1)
  marginaliendetail.transition().duration(800).attr("transform", "scale(1,1)").style("opacity", 1)
}else if(filter == "zusatzMaterial"){
  eigentumsangaben.selectAll(".EigentumsangabenPlus").text(" ⊕")
  markierungen.selectAll(".MarkierungenPlus").text(" ⊕")
  marginalien.selectAll(".MarginalienPlus").text(" ⊕")
  zusatzMaterial.selectAll("text").style("font-weight", "bolder").style("opacity", 1)
  marginalien.selectAll("text").style("font-weight", "400").style("opacity", .6)
  markierungen.selectAll("text").style("font-weight", "400").style("opacity", .6)
  eigentumsangaben.selectAll("text").style("font-weight", "400").style("opacity", .6)

  eigentumsangabendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 1)
  markierungendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 1)
  marginaliendetail.transition().duration(800).attr("transform", "scale(0,1)").style("opacity", 1)
}

  filterInteraction()









setTimeout(function () {
  if (level == "start"){
    $("html,body").animate({
        scrollTop: 6000
    }, '3000')

  }else if (level == "distanz"){
    $("html,body").animate({
        scrollTop: 0
    }, '3000')

  }else if (level == "detail"){
    $("html,body").animate({
        scrollTop: 9000
    }, '3000')
  }

}, 500);
}
}









            function scrollFunction() {
              hashFunction()
              if (scrollTop < 0) {


detailview = false

bookG
    .selectAll("rect")
    .attr("cursor", function() {
        if (scrollTop >= 0 ) {
            return "pointer"
        } else if (scrollTop < 0 && scrollTop > -4000){
            return "not-allowed"
        }else{ return "auto"}
    })

 d3.select("#svgFrontTitles").style("display", "none")

}else if(scrollTop == 0 && detailview == false){
     d3.select("#svgFrontTitles").style("display", "inline")

   }else if(scrollTop == 0 && detailview == true){
    //    d3.select("#svgFrontTitles").style("display", "none")
}


bookG
    .selectAll("rect")
    .attr("cursor", function() {
        if (scrollTop >= 0 ) {
            return "pointer"
        } else if (scrollTop < 0 && scrollTop > -4000){
            return "not-allowed"
        }else{ return "auto"}
    })
    .attr("pointer-events", function() {
        if (scrollTop >= 0 ) {
            return "auto"
        } else if (scrollTop < 0 && scrollTop > -4000){
            return "auto"
        }else{ return "none"}
    })



                if (scrollTop < 0) {
                  /////remove Detailview von buchauswahl

                  clickedBook = 0
                                d3.selectAll(".detailInfoParent")
                                    .transition()
                                    .style("opacity", 0)
                                    .remove()

                                    d3.selectAll(".bookBG").selectAll("rect")
                                        .transition()
                                        .style("opacity", 0)
                  /////remove Detailview von buchauswahl ende


                    authorGroup.selectAll("rect").transition().duration(200).attr("opacity", 0)


                    bookFingerprint.selectAll(".nodes")
                        .attr("height", function(d) {
                            if (d.maxPart >= 1674) {
                                var implicateScaleB = d3.scaleLinear()
                                    .domain([-100, -4000])
                                    .range([(areaheight / d.maxPart), 0])
                                    .clamp(true)
                                return implicateScaleB(scrollTop)
                            } else {
                                var implicateScale = d3.scaleLinear()
                                    .domain([-100, -4000])
                                    .range([pageheight, (areaheight / d.maxPart)])
                                    .clamp(true)
                                return implicateScale(scrollTop)
                            }
                        })
                        .attr("width", function(d, i) {
                            if (d.Verfasser == thisVerfasserSelected) {
                                var implicateScaleWidth = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([buchBreite, sLBuchBreiteSelected])
                                    .clamp(true)

                                return implicateScaleWidth(scrollTop)


                            } else {
                                var implicateScaleWidth = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([buchBreite, sLBuchBreiteUnselected])
                                    .clamp(true)

                                return implicateScaleWidth(scrollTop)
                            }
                        })
                        .attr("x", function(d, i) {return 0})
                        .attr("y", function(d, i) {
                            if (d.maxPart >= 1674) {
                                var implicateScaleB = d3.scaleLinear()
                                    .domain([-100, -4000])
                                    .range([(areaheight / d.maxPart), pageheight])
                                    .clamp(true)

                                return posYCanvas + implicateScaleB(scrollTop) * (d.Part - 1)
                            } else {
                                var implicateScale = d3.scaleLinear()
                                    .domain([-100, -4000])
                                    .range([pageheight, (areaheight / d.maxPart)])
                                    .clamp(true)

                                return posYCanvas + implicateScale(scrollTop) * (d.Part - 1)
                            }
                        })


                    bookFingerprint.selectAll(".nodesbg")
                        .attr("opacity", 1)
                        .attr("height", function(d) {
                            if (d.maxPart >= 1674) {
                                var implicateScaleB = d3.scaleLinear()
                                    .domain([-100, -4000])
                                    .range([areaheight, (d.values[0].maxPart) * pageheight])
                                    .clamp(true)
                                return implicateScaleB(scrollTop)
                            } else {
                                var implicateScale = d3.scaleLinear()
                                    .domain([-100, -4000])
                                    .range([(d.values[0].maxPart) * pageheight, areaheight])
                                    .clamp(true)
                                return implicateScale(scrollTop)
                            }
                        }).attr("width", function(d, i) {
                            if (d.values[0].Verfasser == thisVerfasserSelected) {
                                var implicateScaleWidth = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([buchBreite, sLBuchBreiteSelected])
                                    .clamp(true)

                                return implicateScaleWidth(scrollTop)


                            } else {
                                var implicateScaleWidth = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([buchBreite, sLBuchBreiteUnselected])
                                    .clamp(true)

                                return implicateScaleWidth(scrollTop)
                            }
                        })
                        .attr("x", function(d, i) {return 0})


                    bookFingerprint.selectAll(".nodes")
                        .attr("opacity", 1)
                        .attr("width", function(d) {
                            var implicateScaleC = d3.scaleLinear()
                                .domain([-4000, -5000])
                                .range([buchBreite, 0])
                                .clamp(true)
                            return implicateScaleC(scrollTop)
                        })







                    //			if (scrollTop < -2300){

                    bookG
                        .attr("transform", function(d, i) {
													var areaSize = xAreaMax*(datenByAuthor.filter(function(D,I){if (d.values[0].AuthorCount == 1){return D.values[0].values[0].AuthorCount == 1}else{return D.values[0].values[0].Verfasser == d.values[0].Verfasser}})[0].maxTraceNumberNormBefore)
						//		console.log(datenByAuthor.filter(function(D,I){if (d.values[0].AuthorCount == 1){return D.values[0].values[0].AuthorCount == 1}else{return D.values[0].values[0].Verfasser == d.values[0].Verfasser}})[0].maxTraceNumberNormBefore)

                            if (i == 0) {
                                posx2 = 0
                                posx = 0
                                return "translate(" + (marginleft - 1 + (posx2)) + "," + (posY) + ")"
                            } else if (i != 0 && d.values[0].AuthorCount == 1 ) {
                                posx2 = posx2
                                posx = posx + buchBgBreite

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([-100, -6000])
                                    .range([posx, posx2])
                                    .clamp(true)

                                return "translate(" + (marginleft - 1 + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"
                            } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser) {
                                posx2 = posx2 + areaSize+authorLevelAbstand
                                posx = posx + authorAbstand

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([-100, -6000])
                                    .range([posx, posx2])
                                    .clamp(true)

                                return "translate(" + (marginleft - 1 + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"
                            } else {
                                posx2 = posx2
                                posx = posx + buchBgBreite

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([-100, -6000])
                                    .range([posx, posx2])
                                    .clamp(true)

                                return "translate(" + (marginleft - 1 + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"
                            }
                        })



                    bookGFront
                        .attr("transform", function(d, i) {
													var areaSize = xAreaMax*(datenByAuthor.filter(function(D,I){if (d.values[0].AuthorCount == 1){return D.values[0].values[0].AuthorCount == 1}else{return D.values[0].values[0].Verfasser == d.values[0].Verfasser}})[0].maxTraceNumberNormBefore)


                            if (i == 0) {
                                posx2 = 0
                                posx = 0
                                return "translate(" + (marginleft - 1 + (posx2)) + "," + (posY) + ")"
                            } else if (i != 0 && d.values[0].AuthorCount == 1 ) {
                                posx2 = posx2
                                posx = posx + buchBgBreite

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([-100, -6000])
                                    .range([posx, posx2])
                                    .clamp(true)

                                return "translate(" + (marginleft - 1 + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"

                            } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser) {
																posx2 = posx2 + areaSize+authorLevelAbstand
                                posx = posx + authorAbstand

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([-100, -6000])
                                    .range([posx, posx2])
                                    .clamp(true)

                                return "translate(" + (marginleft - 1 + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"
                            } else {
                                posx2 = posx2
                                posx = posx + buchBgBreite

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([-100, -6000])
                                    .range([posx, posx2])
                                    .clamp(true)

                                return "translate(" + (marginleft - 1 + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"
                            }
                        })






                    bookFingerprint
                        .attr("transform", function(d, i) {
													var areaSize = xAreaMax*(datenByAuthor.filter(function(D,I){if (d.values[0].AuthorCount == 1){return D.values[0].values[0].AuthorCount == 1}else{return D.values[0].values[0].Verfasser == d.values[0].Verfasser}})[0].maxTraceNumberNormBefore)

                            if (i == 0) {
                                posx2 = 0
                                posx = 0
                                return "translate(" + (marginleft - 1 + (posx2)) + "," + (posYCanvas) + ")"
                            } else if (i != 0 && d.values[0].AuthorCount == 1 ) {
                                posx2 = posx2
                                posx = posx + buchBgBreite

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([-100, -6000])
                                    .range([posx, posx2])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posYCanvas) + ")"
                            } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser) {


																posx2 = posx2 + areaSize+authorLevelAbstand
                                posx = posx + authorAbstand

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([-100, -6000])
                                    .range([posx, posx2])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posYCanvas) + ")"
                            } else {
                                posx2 = posx2
                                posx = posx + buchBgBreite

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([-100, -6000])
                                    .range([posx, posx2])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posYCanvas) + ")"
                            }
                        })



                    bookFingerprint
                        .selectAll(".nodesbg")
                        .attr("opacity", function(d) {
                            var implicateScaleOpacity = d3.scaleLinear()
                                .domain([-4000, -4900])
                                .range([1, 0])
                                .clamp(true)

                            return implicateScaleOpacity(scrollTop)
                        })

                    var implicateScaleAreaChart = d3.scaleLinear()
                        .domain([-4000, -6000])
                        .range([0, 1])
                        .clamp(true)


                    layerGroups.attr("transform", "translate(0,0)scale(" + implicateScaleAreaChart(scrollTop) + ",1)")
                    areachartGroup.selectAll("line").attr("display", "auto")
                    areachart.attr("display", function() {
                        if (scrollTop > 0) {
                            return "auto"
                        }
                    })




                }

                ////////Scroll-Section > 0 Start
                ///////////////////////////////////////
                ///////////////////////////////////////
                ///////////////////////////////////////
                else if (scrollTop >= 0) {
                  /////remove Detailview von buchauswahl

                //  d3.select("#svgFrontTitles").style("display", "none")

                                // d3.selectAll(".detailinfo")
                                //     .transition()
                                //     .style("opacity", 0)
                                //     .remove()
                  /////remove Detailview von buchauswahl ende


                  areachartGroup.selectAll("line").attr("display", "none")
                  areachart.attr("display", "none")

                  var explicateScale = d3.scaleLinear()
                      .domain([500, 2500])
                      .range([pageheight, 30])
                      .clamp(true)

                  var explicateScale2 = d3.scaleLinear()
                      .domain([500, 2500])
                      .range([pageheight, 31])
                      .clamp(true)

////////////////////////////
///////No book selectected
////////////////////////////
////////////////////////////

if (clickedBook == 0){
                    bookG
                        .attr("transform", function(d, i) {
                            if (i == 0) {
                                posx2 = 0
                                posx = 0
                                return "translate(" + (marginleft - 1 + (posx2)) + "," + (posY) + ")"
                            } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser) {
                                posx2 = posx2 + sLAuthorAbstand2
                                posx = posx + authorAbstand

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([-100, -6000])
                                    .range([posx, posx2])
                                    .clamp(true)

                                return "translate(" + (marginleft - 1 + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"
                            } else {
                                posx2 = posx2
                                posx = posx + buchBgBreite

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([-100, -6000])
                                    .range([posx, posx2])
                                    .clamp(true)

                                return "translate(" + (marginleft - 1 + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"
                            }
                        })

                    bookFingerprint
                        .attr("transform", function(d, i) {
                            if (i == 0) {
                                posx2 = 0
                                posx = 0
                                return "translate(" + (marginleft - 1 + (posx2)) + "," + (posYCanvas) + ")"
                            } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser) {
                                posx2 = posx2 + sLAuthorAbstand2
                                posx = posx + authorAbstand

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([-100, -6000])
                                    .range([posx, posx2])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posYCanvas) + ")"
                            } else {
                                posx2 = posx2
                                posx = posx + buchBgBreite

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([-100, -6000])
                                    .range([posx, posx2])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posYCanvas) + ")"
                            }
                        })



                    bookFingerprint
                        .selectAll(".nodesbg")
                        .attr("opacity", function(d) {
                            var implicateScaleOpacity = d3.scaleLinear()
                                .domain([-200, -5000])
                                .range([1, 0])
                                .clamp(true)

                            return implicateScaleOpacity(scrollTop)
                        })







                    //////////////////////////Auswahl für SelectedAuthor beim Reinzoomen und Stauchen der anderen Bücher
                    thisVerfasserSelectedBookCount = datenByAuthor.filter(function(d, i) {
                        return d.key == thisVerfasserSelected
                    })[0].values.length
                    sLTotalBuchWidthSelected = thisVerfasserSelectedBookCount * sLBuchAbstandSelected
                    sLTotalBuchWidthUnselected = (BuchAnzahl - thisVerfasserSelectedBookCount) * sLBuchAbstandUnselected
                    sLAuthorAbstand2 = (chartArea+100 - (sLTotalBuchWidthSelected + sLTotalBuchWidthUnselected)) / (authorAnzahl-1)



                    bookFingerprint.selectAll(".nodes")
                        .attr("height", explicateScale(scrollTop))
                        .attr("width", function(d, i) {
                            if (d.Verfasser == thisVerfasserSelected) {
                                var implicateScaleWidth = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([buchBreite, sLBuchBreiteSelected])
                                    .clamp(true)

                                return implicateScaleWidth(scrollTop)


                            } else {
                                var implicateScaleWidth = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([buchBreite, sLBuchBreiteUnselected])
                                    .clamp(true)

                                return implicateScaleWidth(scrollTop)
                            }
                        })
                        .attr("y", function(d, i) {
                            return posYCanvas + (explicateScale2(scrollTop)) * (d.Part - 1)
                        })
                        //.filter(function(d,i){return d.Verfasser == thisVerfasserSelected})
                        .attr("x", function(d, i) {
                            if (d.Verfasser == thisVerfasserSelected) {

                                var thisBookData = (d3.select(this.parentNode).datum()).values.filter(function(D, I) {
                                    return D.Benutzungsspur != "null"
                                })
                                //	console.log(thisBookData)
                                var maxX = 0

                                if (i > 5 && thisBookData[i - 6].ID == d.ID) {
                                    maxX = (Math.max(maxX, 7))

                                    var implicateScaleXPos = d3.scaleLinear()
                                        .domain([500, 2000])
                                        .range([0, 6 * sLSeitenAbstandSelected])
                                        .clamp(true)


                                    return implicateScaleXPos(scrollTop)
                                } else if (i > 4 && thisBookData[i - 5].ID == d.ID) {
                                    maxX = (Math.max(maxX, 6))

                                    var implicateScaleXPos = d3.scaleLinear()
                                        .domain([500, 2000])
                                        .range([0, 5 * sLSeitenAbstandSelected])
                                        .clamp(true)


                                    return implicateScaleXPos(scrollTop)
                                } else if (i > 3 && thisBookData[i - 4].ID == d.ID) {
                                    maxX = (Math.max(maxX, 5))

                                    var implicateScaleXPos = d3.scaleLinear()
                                        .domain([500, 2000])
                                        .range([0, 4 * sLSeitenAbstandSelected])
                                        .clamp(true)


                                    return implicateScaleXPos(scrollTop)
                                } else if (i > 2 && thisBookData[i - 3].ID == d.ID) {
                                    maxX = (Math.max(maxX, 4))

                                    var implicateScaleXPos = d3.scaleLinear()
                                        .domain([500, 2000])
                                        .range([0, 3 * sLSeitenAbstandSelected])
                                        .clamp(true)


                                    return implicateScaleXPos(scrollTop)
                                } else if (i > 1 && thisBookData[i - 2].ID == d.ID) {
                                    maxX = (Math.max(maxX, 3))

                                    var implicateScaleXPos = d3.scaleLinear()
                                        .domain([500, 2000])
                                        .range([0, 2 * sLSeitenAbstandSelected])
                                        .clamp(true)


                                    return implicateScaleXPos(scrollTop)
                                } else if (i != 0 && thisBookData[i - 1].ID == d.ID) {
                                    maxX = (Math.max(maxX, 2))


                                    var implicateScaleXPos = d3.scaleLinear()
                                        .domain([500, 2000])
                                        .range([0, 1 * sLSeitenAbstandSelected])
                                        .clamp(true)


                                    return implicateScaleXPos(scrollTop)
                                } else {
                                    maxX = (Math.max(maxX, 1))
                                    return 0
                                }

                            } else {
                                return 0
                            }
                        })




                    bookFingerprint.selectAll(".nodesbg")
                        .attr("height", function(d) {
                            return (explicateScale2(scrollTop)) * (d.values[0].maxPart)
                        })
                        .attr("width", function(d, i) {
                            if (d.values[0].Verfasser == thisVerfasserSelected) {
                                var implicateScaleWidth = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([buchBreite, sLBuchBreiteSelected])
                                    .clamp(true)

                                return implicateScaleWidth(scrollTop)


                            } else {
                                var implicateScaleWidth = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([buchBreite, sLBuchBreiteUnselected])
                                    .clamp(true)

                                return implicateScaleWidth(scrollTop)
                            }
                        })

                        d3.select("#svg").selectAll(".singleBookBG")//.selectAll(".bookBG").selectAll("rect")
                        .attr("width", function(d, i) {
                            if (d.values[0].Verfasser == thisVerfasserSelected) {
                                var implicateScaleWidth = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([buchBgBreite, sLBuchBreiteSelected])
                                    .clamp(true)

                                var thisCount = datenByAuthor.filter(function(D,I){return D.key === thisVerfasserSelected})[0].values.length

                                //  datenByAuthor.filter(function(D,I){return d.}).values.length

                                return implicateScaleWidth(scrollTop)


                            } else {
                                var implicateScaleWidth = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([buchBreite, sLBuchBreiteUnselected])
                                    .clamp(true)

                                    //console.log(d3.select(this).datum().values[0].Verfasser)
                                  //  var thisCountunselected = datenByAuthor.filter(function(D,I){return D.key === d3.select(this).datum().values[0].Verfasser})[0].values.length

                                    return implicateScaleWidth(scrollTop)//thisCountunselected
                            }
                        })

                        d3.select("#svg").selectAll(".authorBg")//.selectAll(".bookBG").selectAll("rect")
                        .attr("width", function(d, i) {
                            if (d.values[0].Verfasser == thisVerfasserSelected) {
                                var implicateScaleWidth = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([buchBgBreite, sLBuchBreiteSelected])
                                    .clamp(true)

                                var thisCount = datenByAuthor.filter(function(D,I){return D.key === thisVerfasserSelected})[0].values.length

                                //  datenByAuthor.filter(function(D,I){return d.}).values.length

                                return implicateScaleWidth(scrollTop)*thisCount


                            } else {
                                var implicateScaleWidth = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([buchBreite, sLBuchBreiteUnselected])
                                    .clamp(true)

                                  //  console.log(d3.select(this).datum().values[0].Verfasser)
                                  //  var thisCountunselected = datenByAuthor.filter(function(D,I){return D.key === d3.select(this).datum().values[0].Verfasser})[0].values.length

                                    return implicateScaleWidth(scrollTop)*1//thisCountunselected
                            }
                        })



                    bookFingerprint
                        .attr("transform", function(d, i) {
                          if (scrollTop < 3000){
                            posYCanvas = 0
                          }
                          else {
                            posYCanvas = 0-((scrollTop-3000)*1)
                          }//console.log(posYCanvas)
                          //falls erstes Element
                            if (i == 0) {
                                posx3 = 0
                                posx = 0
                                return "translate(" + (marginleft - 1 + (posx3)) + "," + (posYCanvas) + ")"

                            //falls vorheriges Element Selected und anderer Verfasser
                            } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser && datenByTitle[i - 1].values[0].Verfasser == thisVerfasserSelected) {
                                posx3 = posx3 + sLBuchAbstandSelected + sLAuthorAbstand2
                                posx = posx + authorAbstand

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([posx, posx3])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posYCanvas) + ")"

                            //falls vorheriges Element Selected und gleicher Verfasser
                          } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser == thisVerfasserSelected && datenByTitle[i - 1].values[0].Verfasser == d.values[0].Verfasser) {
                                posx3 = posx3 + sLBuchAbstandSelected
                                posx = posx + buchBgBreite

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([posx, posx3])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posYCanvas) + ")"

                            //falls vorheriges Element NICHT Selected und anderer Verfasser
                          } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser && datenByTitle[i - 1].values[0].Verfasser != thisVerfasserSelected && datenByTitle[i - 1].values[0].AuthorCount != 1) {
                                posx3 = posx3 + sLAuthorAbstand2
                                posx = posx + authorAbstand

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([posx, posx3])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posYCanvas) + ")"

                            //falls vorheriges Element NICHT Selected und gleicher Verfasser
                            } else {
                                posx3 = posx3 + sLBuchAbstandUnselected
                                posx = posx + buchBgBreite

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([posx, posx3])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posYCanvas) + ")"
                            }
                        })

bookFingerprint.selectAll(".nodesbg")
.attr("y", function(d, i) {
                          if (scrollTop < 3000){

                            posYCanvas = 0
                          }
                          else {

                            posYCanvas = 0-((scrollTop-3000)*1)

                          } //console.log(posYCanvas)
                                return posYCanvas})





                    bookG
                        .attr("transform", function(d, i) {
                          //falls erstes Element
                            if (i == 0) {
                                posx3 = 0
                                posx = 0
                                return "translate(" + (marginleft - 1 + (posx3)) + "," + (posY) + ")"

                                //falls vorheriges Element Selected und anderer Verfasser
                            } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser && datenByTitle[i - 1].values[0].Verfasser == thisVerfasserSelected) {
                                posx3 = posx3 + sLBuchAbstandSelected + sLAuthorAbstand2
                                posx = posx + authorAbstand

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([posx, posx3])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"

                                //falls vorheriges Element Selected und gleicher Verfasser
                            } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser == thisVerfasserSelected) {
                                posx3 = posx3 + sLBuchAbstandSelected
                                posx = posx + buchBgBreite

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([posx, posx3])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"

                                //falls vorheriges Element NICHT Selected und anderer Verfasser
                            } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser && datenByTitle[i - 1].values[0].Verfasser != thisVerfasserSelected) {
                                posx3 = posx3 + sLAuthorAbstand2
                                posx = posx + authorAbstand

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([posx, posx3])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"

                                //falls vorheriges Element NICHT Selected und gleicher Verfasser
                            } else {
                                posx3 = posx3 + sLBuchAbstandUnselected
                                posx = posx + buchBgBreite

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([posx, posx3])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"
                            }
                        })


                        //bu
                                                d3.selectAll(".bookTitleFrontG")
                                                .attr("transform", function(d, i) {
                                                  //falls erstes Element
                                                    if (i == 0) {
                                                        posx3 = 0
                                                        posx = 0
                                                        return "translate(" + (marginleft - 1 + (posx3)-40.5) + "," + (posY) + ")"

                                                        //falls vorheriges Element Selected und anderer Verfasser
                                                    } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser && datenByTitle[i - 1].values[0].Verfasser == thisVerfasserSelected) {
                                                        posx3 = posx3 + sLBuchAbstandSelected + sLAuthorAbstand2
                                                        posx = posx + authorAbstand

                                                        var implicateScaleX1 = d3.scaleLinear()
                                                            .domain([500, 2000])
                                                            .range([posx, posx3])
                                                            .clamp(true)

                                                        return "translate(" + (marginleft + (implicateScaleX1(scrollTop))-40.5) + "," + (posY) + ")"

                                                        //falls vorheriges Element Selected und gleicher Verfasser
                                                    } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser == thisVerfasserSelected) {
                                                        posx3 = posx3 + sLBuchAbstandSelected
                                                        posx = posx + buchBgBreite

                                                        var implicateScaleX1 = d3.scaleLinear()
                                                            .domain([500, 2000])
                                                            .range([posx, posx3])
                                                            .clamp(true)

                                                        return "translate(" + (marginleft + (implicateScaleX1(scrollTop))-40.5) + "," + (posY) + ")"

                                                        //falls vorheriges Element NICHT Selected und anderer Verfasser
                                                    } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser && datenByTitle[i - 1].values[0].Verfasser != thisVerfasserSelected) {
                                                        posx3 = posx3 + sLAuthorAbstand2
                                                        posx = posx + authorAbstand

                                                        var implicateScaleX1 = d3.scaleLinear()
                                                            .domain([500, 2000])
                                                            .range([posx, posx3])
                                                            .clamp(true)

                                                        return "translate(" + (marginleft + (implicateScaleX1(scrollTop))-40.5) + "," + (posY) + ")"

                                                        //falls vorheriges Element NICHT Selected und gleicher Verfasser
                                                    } else {
                                                        posx3 = posx3 + sLBuchAbstandUnselected
                                                        posx = posx + buchBgBreite

                                                        var implicateScaleX1 = d3.scaleLinear()
                                                            .domain([500, 2000])
                                                            .range([posx, posx3])
                                                            .clamp(true)

                                                        return "translate(" + (marginleft + (implicateScaleX1(scrollTop))-40.5) + "," + (posY) + ")"
                                                    }
                                                })



                    bookGFront
                        .attr("transform", function(d, i) {
                            if (i == 0) {
                                posx3 = 0
                                posx = 0
                                return "translate(" + (marginleft - 1 + (posx3)) + "," + (posY) + ")"
                            } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser && datenByTitle[i - 1].values[0].Verfasser == thisVerfasserSelected) {
                                posx3 = posx3 + sLBuchAbstandSelected
                                posx = posx + authorAbstand

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([posx, posx3])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"
                            } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser == thisVerfasserSelected) {
                                posx3 = posx3 + sLBuchAbstandSelected
                                posx = posx + buchBgBreite

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([posx, posx3])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"
                            } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser && datenByTitle[i - 1].values[0].Verfasser != thisVerfasserSelected) {
                                posx3 = posx3 + sLAuthorAbstand2
                                posx = posx + authorAbstand

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([posx, posx3])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"
                            } else {
                                posx3 = posx3 + sLBuchAbstandUnselected
                                posx = posx + buchBgBreite

                                var implicateScaleX1 = d3.scaleLinear()
                                    .domain([500, 2000])
                                    .range([posx, posx3])
                                    .clamp(true)

                                return "translate(" + (marginleft + (implicateScaleX1(scrollTop))) + "," + (posY) + ")"
                            }
                        })


                      }
                      //////////////////////////////
                      //////no selected book Ende
                      //////////////////////////////
                      //////////////////////////////


                      //////////////////////////////
                      //////if book selected
                      //////////////////////////////
                      //////////////////////////////

if (clickedBook != 0 && scrollTop >0){



  ///create Variable that counts number of "Schriftspuren" on one page
  var maxX = 0

  ///create variable that helps to position the books
  var posX = 0



  ////Create Scale for book/page width, based on scroll position
  var selectedBookScale = d3.scaleLinear()
      .domain([0, 3000])
      .range([selectedBookBuchlevel, selectedBookSeitenlevel])
      .clamp(true)

  var unselectedBookSameAuthorScale = d3.scaleLinear()
      .domain([0, 3000])
      .range([unselectedBookSameAuthorBuchlevel, unselectedBookSameAuthorSeitenlevel])
      .clamp(true)

  var unselectedBookScale = d3.scaleLinear()
      .domain([0, 3000])
      .range([unselectedBookBuchlevel, unselectedBookSeitenlevel])
      .clamp(true)

      var BuchauswahlFeldScale = d3.scaleLinear()
          .domain([0, 3000])
          .range([BuchauswahlFeld, BuchauswahlFeldSeitenFeld])
          .clamp(true)





          var onSelectionAuthorAbstand = (chartArea-100-(BuchauswahlFeldScale(scrollTop)+ (BuchAnzahl-1)*unselectedBookBuchlevel)) / (authorAnzahl) //-100 muss eventuell raus? warum die benötigt werden ist un klar

          bookFingerprint.selectAll(".nodes")
            .filter(function(d, i) {
                  return d.BookID != clickedBook
                  })
              .attr("width", function(d) {
                      return unselectedBookScale(scrollTop)
              })
              .attr("height", explicateScale(scrollTop))
              .attr("y", function(d, i) {
                  return posYCanvas + (explicateScale2(scrollTop)) * (d.Part - 1)
              })
              .attr("x", 0)


              bookFingerprint.selectAll(".nodes")
              .filter(function(d, i) {
                                      return d.BookID == clickedBook
                                  })
              .attr("width", function(d) {
                      return selectedBookScale(scrollTop)
              })
              .attr("height", explicateScale(scrollTop))
              .attr("y", function(d, i) {
                  return posYCanvas + (explicateScale2(scrollTop)) * (d.Part - 1)
              })
              .attr("x", function(d, i) {
                  if (i > 5 && thisData[i - 6].ID == d.ID) {
                    //  maxX = (Math.max(maxX, 7))
                      return 7*selectedBookScale(scrollTop)-selectedBookScale(scrollTop)*6
                  } else if (i > 4 && thisData[i - 5].ID == d.ID) {
                  //    maxX = (Math.max(maxX, 6))
                      return 7*selectedBookScale(scrollTop)-selectedBookScale(scrollTop)*5
                  } else if (i > 3 && thisData[i - 4].ID == d.ID) {
                  //    maxX = (Math.max(maxX, 5))
                      return 7*selectedBookScale(scrollTop)-selectedBookScale(scrollTop)*4
                  } else if (i > 2 && thisData[i - 3].ID == d.ID) {
                  //    maxX = (Math.max(maxX, 4))
                      return 7*selectedBookScale(scrollTop)-selectedBookScale(scrollTop)*3
                  } else if (i > 1 && thisData[i - 2].ID == d.ID) {
                    //  maxX = (Math.max(maxX, 3))
                      return 7*selectedBookScale(scrollTop)-selectedBookScale(scrollTop)*2
                  } else if (i != 0 && thisData[i - 1].ID == d.ID) {
                    //  maxX = (Math.max(maxX, 2))
                      return 7*selectedBookScale(scrollTop)-selectedBookScale(scrollTop)
                  } else {
                //      maxX = (Math.max(maxX, 1))
                      return 7*selectedBookScale(scrollTop)
                  }
              })

          bookFingerprint.selectAll(".nodesbg")
              .attr("width", function(d) {
                  if (d.values[0].BookID == clickedBook) {
                      return selectedBookScale(scrollTop)
                  } else {
                      return unselectedBookScale(scrollTop)
                  }
              })
              .attr("height", function(d) {
                  return (explicateScale2(scrollTop)) * (d.values[0].maxPart)
              })
              .attr("x", function(d) {
                  if (d.values[0].BookID == clickedBook) {
                      return 7*selectedBookScale(scrollTop)
                  } else {
                      return 0
                  }
              })
              .attr("y", function(d, i) {
                                        if (scrollTop < 3000){

                                          posYCanvas = 0
                                        }
                                        else {

                                          posYCanvas = 0-((scrollTop-3000)*1)

                                        } //console.log(posYCanvas)
                                              return posYCanvas})




          bookFingerprint
              .attr("transform", function(d, i) {
                if (scrollTop < 3000){
                  posYCanvas = 0
                }
                else {
                  posYCanvas = 0-((scrollTop-3000)*1)
                }

                  if (i == 0) {
                      posx = 0
                      return "translate(" + (marginleft + (posx)) + "," + (posYCanvas) + ")"
                  } else if (i != 0 && datenByTitle[i - 1].values[0].BookID == clickedBook) {
                      posx = posx + BuchauswahlFeldScale(scrollTop)
                      return "translate(" + (marginleft + (posx)) + "," + (posYCanvas) + ")"
                  } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser) {
                      posx = posx + onSelectionAuthorAbstand
                      return "translate(" + (marginleft + (posx)) + "," + (posYCanvas) + ")"
                  } else {
                      posx = posx + onSelectionBuchAbstand
                      return "translate(" + (marginleft + (posx)) + "," + (posYCanvas) + ")"
                  }
              })


          bookG
              .attr("transform", function(d, i) {
                  if (i == 0) {
                      posx = 0
                      return "translate(" + (marginleft - 2 + (posx)) + "," + (posY) + ")"
                  } else if (i != 0 && datenByTitle[i - 1].values[0].BookID == clickedBook) {
                      posx = posx + BuchauswahlFeldScale(scrollTop)
                      return "translate(" + (marginleft - 2 + (posx)) + "," + (posY) + ")"
                  } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser) {
                      posx = posx + onSelectionAuthorAbstand
                      return "translate(" + (marginleft - 2 + (posx)) + "," + (posY) + ")"
                  } else {
                      posx = posx + onSelectionBuchAbstand
                      return "translate(" + (marginleft - 2 + (posx)) + "," + (posY) + ")"
                  }
              })


///Buchtitel
              d3.selectAll(".bookTitleFrontG")
              .attr("transform", function(d, i) {
                  if (i == 0) {
                      posx = 0
                      return "translate(" + (marginleft + (posx)-40.5) + "," + (posY) + ")"
                  } else if (i != 0 && datenByTitle[i - 1].values[0].BookID == clickedBook) {
                      posx = posx + BuchauswahlFeldScale(scrollTop)
                      return "translate(" + (marginleft + (posx)-40.5) + "," + (posY) + ")"
                  } else if (i != 0 && datenByTitle[i - 1].values[0].Verfasser != d.values[0].Verfasser) {
                      posx = posx + onSelectionAuthorAbstand
                      return "translate(" + (marginleft + (posx)-40.5) + "," + (posY) + ")"
                  } else {
                      posx = posx + onSelectionBuchAbstand
                      return "translate(" + (marginleft + (posx)-40.5) + "," + (posY) + ")"
                  }
              })






          bookG.selectAll(".bookBG")
              .style("opacity", 0)
              //.attr("fill", function(d){console.log(d.values[0].BookID)})
              .attr("width", function(d) {
                  if (d.values[0].BookID == clickedBook) {
                      return BuchauswahlFeldScale(scrollTop)
                  } else {
                      return buchBreite
                  }
              })
              .filter(function(d){return d.values[0].BookID == clickedBook})
              .style("fill", "#cec1b8")
              .style("opacity", 0.3)

              d3.selectAll(".transcriptText")
              .style("font-size", function(){return transcriptFontSize(scrollTop) + "px"})
              .attr("x", transcriptPositionScale(scrollTop)*selectedBookScale(scrollTop)+10)
              .attr("y", function(d,i){
                        if (i == 0){
                          return transcriptYStart(scrollTop)+(explicateScale2(scrollTop))*d.Part}
                        else {
                          return transcriptYStart(scrollTop)+(explicateScale2(scrollTop))*d.Part}})
              .selectAll("tspan")
              .attr("x", transcriptPositionScale(scrollTop)*selectedBookScale(scrollTop)+10)
              .attr("y", function(d,i){
                          return transcriptYStart(scrollTop)+(explicateScale2(scrollTop))*d.Part})



d3.selectAll(".detailInfoTextBox")
.attr("opacity", function(d){return detailInfoScale(scrollTop)})
.attr("transform", function(d){return "translate(" + detailInfoTextBoxScale(scrollTop) + "," + 0 + ")"})

d3.selectAll(".transcriptions").attr("opacity", function(d){return detailTranscriptScale(scrollTop)})



d3.selectAll(".transcriptions").selectAll("circle")
.attr("r", detailCircleScale(scrollTop))

d3.selectAll(".transcriptions").selectAll("path")
.style("opacity", transcriptPathScaleOpacity(scrollTop))


d3.selectAll(".transcriptionText")
 .each(function(d,i){
   if(i>0){
   var thisTranscriptY = d3.select(this).node().getBBox().y
   var lastTranscriptMaxY = d3.selectAll(".transcriptionText").filter(function(D,I){return I == i-1}).node().getBBox().y + d3.selectAll(".transcriptionText").filter(function(D,I){return I == i-1}).node().getBBox().height

   if (thisTranscriptY <= lastTranscriptMaxY){
     d3.select(this)
     .attr("y", function(){
       return lastTranscriptMaxY+transcriptFontSize(scrollTop)})
       .selectAll("tspan").attr("y", function(){
          return lastTranscriptMaxY+transcriptFontSize(scrollTop)})

      d3.selectAll(".transcriptions").selectAll("circle").filter(function(D,I){return I == i})
      .attr("cx",  transcriptPositionScale(scrollTop)*selectedBookScale(scrollTop))
      .attr("cy", lastTranscriptMaxY+transcriptFontSize(scrollTop)-3)
//
//
////line between transcript and rect
      d3.selectAll(".transcriptions").selectAll("path").filter(function(D,I){return I == i})
      .attr("d", function(d, i){
          var line = d3.line().curve(d3.curveBasis)
          var data = [[transcriptPositionScale(scrollTop)*selectedBookScale(scrollTop)-3, lastTranscriptMaxY+transcriptFontSize(scrollTop)-3], [transcriptPositionScale(scrollTop)*selectedBookScale(scrollTop)-20, lastTranscriptMaxY+transcriptFontSize(scrollTop)-3],  [8*selectedBookScale(scrollTop)+20, thisTranscriptY+15], [8*selectedBookScale(scrollTop), thisTranscriptY+15]];

          return line(data)
      })


    }else{
        d3.selectAll(".transcriptions").selectAll("circle").filter(function(D,I){return I == i})
        .attr("cx",  transcriptPositionScale(scrollTop)*selectedBookScale(scrollTop))
        .attr("cy", thisTranscriptY+transcriptFontSize(scrollTop)-6)

        ////line between transcript and rect
              d3.selectAll(".transcriptions").selectAll("path").filter(function(D,I){return I == i})
              .attr("d", function(d, i){
                  var line = d3.line().curve(d3.curveBasis)
                  var data = [[transcriptPositionScale(scrollTop)*selectedBookScale(scrollTop)-3, thisTranscriptY+transcriptFontSize(scrollTop)-6], [transcriptPositionScale(scrollTop)*selectedBookScale(scrollTop)-20, thisTranscriptY+transcriptFontSize(scrollTop)-6],  [8*selectedBookScale(scrollTop)+20, thisTranscriptY+transcriptFontSize(scrollTop)-6], [8*selectedBookScale(scrollTop), thisTranscriptY+15]];

                  return line(data)
              })



    }

 }
else{
var thisTranscriptY = d3.select(this).node().getBBox().y

  d3.selectAll(".transcriptions").selectAll("circle").filter(function(D,I){return I == i})
  .attr("cx",  transcriptPositionScale(scrollTop)*selectedBookScale(scrollTop))
  .attr("cy", thisTranscriptY+transcriptFontSize(scrollTop)-6)

//
  ////line between transcript and rect
        d3.selectAll(".transcriptions").selectAll("path").filter(function(D,I){return I == i})
        .attr("d", function(d, i){
            var line = d3.line().curve(d3.curveBasis)
            var data = [[transcriptPositionScale(scrollTop)*selectedBookScale(scrollTop)-3, thisTranscriptY+transcriptFontSize(scrollTop)-6], [transcriptPositionScale(scrollTop)*selectedBookScale(scrollTop)-20, thisTranscriptY+transcriptFontSize(scrollTop)-6],  [8*selectedBookScale(scrollTop)+20, thisTranscriptY+transcriptFontSize(scrollTop)-6], [8*selectedBookScale(scrollTop), thisTranscriptY+15]];

            return line(data)
        })

}})











              d3.selectAll(".transcriptions")
              .attr("transform", function(d, i) {
                if (scrollTop < 3000){
                  posYCanvas = 0
                }
                else {
                  posYCanvas = 0-((scrollTop-3000)*1)
                }
                return "translate(" + 0 + "," + (posYCanvas) + ")"
              })









}

//////////////////////////////
//////selected book Ende
//////////////////////////////
//////////////////////////////


                    if (scrollTop > 400) {
                        d3.select("#svg").selectAll(".bookBG").selectAll("rect").attr("opacity", function(d) {
                            return 0
                        })

                    }



                    //////////////
                    //////////////
                    ///Hover-Thumb

                    d3.selectAll(".singleBookBG").on("mousemove", function(d) {
//console.log(posYCanvas)
//console.log(scrollTop)
                        if (scrollTop >= 0) {
                          var currentScrollTop = Math.max(window.pageYOffset, document.documentElement.scrollTop, document.body.scrollTop)

                      //    var mouseY = ((d3.event.layerY || d3.event.offsety) - currentScrollTop-120);
                      var mouseY = ((d3.event.pageY) - currentScrollTop-270-posYCanvas);

                            //console.log(mouseY/pageheight)
                            //console.log(d.values)

                      //      console.log(mouseY)
                            var thisPage = (round45(mouseY) / explicateScale2(scrollTop))
//console.log(thisPage)

                            function round45(x) {
                                return Math.ceil(x / explicateScale2(scrollTop)) * explicateScale2(scrollTop)
                            }
                            //console.log(d.values.filter(function(D,I){return D.Part == 3}))
                            thisVerfasser = d3.select(this).datum().values[0].Verfasser
                            var thisBookID = d3.select(this).datum().values[0].BookID

                            ///für jedes Buch, das nicht der aktuellen Selektion entspricht
                            if (thisBookID != clickedBook || scrollTop > 500 ){
                            //tooltip.select("p").text(thisPageID)
                            if (d.values[0].maxPart < thisPage || mouseY < 0) {
                                d3.select('.tooltip')
                                    .style("display", "none")
                                    .style('top', d3.event.pageY)
                            } else if (d.values[0].maxPart >= thisPage && mouseY > 0) {
                                var thisPageID = (d.values.filter(function(d, i) {
                                    return d.Part == thisPage
                                }))[0].ID

                                d3.select('.tooltip')
                                    .style("display", "block")
                                    .style('top', d3.event.pageY - 100 + 'px')
                                    .style('left', function(){if (d3.event.pageX < width/2){return d3.event.pageX + 25 + 'px'}else {return d3.event.pageX -250 + 'px'}})

                                tooltip.select("img").attr("src", function() {
                                    return "./img/m/" + thisPageID + ".jpg"
                                })
                            }
                          }
                          ////Für Auswahl
                          else{
                            if (d.values[0].maxPart < thisPage || mouseY < 0) {
                                d3.select('.tooltip')
                                    .style("display", "none")
                                    .style('top', d3.event.pageY)
                            } else if (d.values[0].maxPart >= thisPage && mouseY > 0) {
                                var thisPageID = (d.values.filter(function(d, i) {
                                    return d.Part == thisPage
                                }))[0].ID

                                d3.selectAll('.detail_cover')
                                .attr("xlink:href", function(d) {
                                    return "./img/m/" + thisPageID + ".jpg"})
                            }


                            }
//Ende


                        }

                    })


                    //////////////
                    //////////////
                    ///Hover-Transcript

                    d3.selectAll(".transcriptions").attr("cursor", "pointer").selectAll("text").on("mousemove", function(d) {
  //console.log(posYCanvas)
  //console.log(scrollTop)
                        if (scrollTop >= 0) {
                          var currentScrollTop = Math.max(window.pageYOffset, document.documentElement.scrollTop, document.body.scrollTop)

                      //    var mouseY = ((d3.event.layerY || d3.event.offsety) - currentScrollTop-120);
                      var mouseY = ((d3.event.pageY) - currentScrollTop-270-posYCanvas);



                            //console.log(d.values.filter(function(D,I){return D.Part == 3}))
                    //        thisVerfasser = d3.select(this).datum().values[0].Verfasser
            //                var thisBookID = d3.select(this).datum().values[0].BookID
                            var thisPageID = d3.select(this).datum().ID

//console.log(thisPageID)
if (scrollTop > 500 ){
                                d3.selectAll('.detail_cover')
                                .attr("xlink:href", function(d) {
                                    return "./img/m/" + thisPageID + ".jpg"})
                                }



}else if (scrollTop <= 500 ){

  tooltip.select("img").attr("src", function() {
      return "./img/m/" + thisPageID + ".jpg"
  })

}

                    })






                }

                ////////Scroll-Section > 0 Ende
                ///////////////////////////////////////
                ///////////////////////////////////////
                ///////////////////////////////////////

            }


            draw()

            function draw() {
                //		context.globalCompositeOperation = 'multiply';
                // clear canvas

                context.clearRect(0, 0, width, height);
                ///draw elements
                var bookGroups = dataContainer.selectAll(".bookFingerprint")


// areachart.each(function(d){
//
//
//   context.beginPath();
//   area(d);
//   if (d.key == "SonstigeMarkierungNorm"){
//     context.fillStyle = 'blue';
//     context.strokeStyle = 'blue';
//   }else{
//   context.fillStyle = 'red';
//   context.strokeStyle = 'red';}
//   context.fill();
// })

                bookGroups.each(function(d) {
                    //console.log(Number(d3.select(this).attr("transform").replace("translate(", "").split(',')[0]))
                    var bookGroupPosition = Number(d3.select(this).attr("transform").replace("translate(", "").split(',')[0])

                    var elementswhite = d3.select(this).selectAll(".nodesbg");

                    elementswhite.each(function(d) {

                        var node = d3.select(this);
                        var nodeXPos = Number(node.attr("x")) + bookGroupPosition
                        context.fillStyle = node.attr("fill");
                        context.globalAlpha = node.attr("opacity")
              //          context.shadowBlur = 0


                        context.beginPath();
                        context.rect((nodeXPos), (node.attr("y")), (node.attr("width")), (node.attr("height")))
                        //	context.arc((+node.attr("x")), (+node.attr("y")),  (+node.attr("width")), (+node.attr("height")));
                        context.fill();
                        context.closePath();
                    })



                    var elements = d3.select(this).selectAll(".nodes");

                    elements.each(function(d) {
                        var node = d3.select(this);
                        var nodeXPos = Number(node.attr("x")) + bookGroupPosition

                        context.fillStyle = node.attr("fill");
                        context.globalAlpha = node.attr("opacity")
                        //context.globalCompositeOperation = 'multiply';

                        // if (filter != null && node.attr("opacity")!= 0){


                        // context.shadowColor = node.attr("fill");
                        // context.shadowBlur = 5
                        //;}
                        // else{ context.shadowBlur = 0}

                        context.beginPath();
                        context.rect((nodeXPos), (node.attr("y")), (node.attr("width")), (node.attr("height")))
                        //	context.arc((+node.attr("x")), (+node.attr("y")),  (+node.attr("width")), (+node.attr("height")));
                        context.fill();
                        context.closePath();
                    })
                })

            }





console.log(datenByTitle)





var table = d3.select('body').append('table')
  var thead = table.append('thead')
  var	tbody = table.append('tbody');


console.log(datenByTitle)
      // create a row for each object in the data
      d3.select("body").append("p")
      .text("ID*Seitenzahl*Verfasserr*Genre*Anstreichung*Unterstreichung*Durchstreichung*SonstigeMarkierung*ZusatzMaterial*Anderes*Provenienz*Stempel*Kommentar*Bewertung*Textkorrektur*Variante*Uebersetzung*AnstreichungNorm*UnterstreichungNorm*DurchstreichungNorm*SonstigeMarkierungNorm*ZusatzMaterialNorm*AnderesNorm*ProvenienzNorm*StempelNorm*KommentarNorm*BewertungNorm*TextkorrekturNorm*VarianteNorm*UebersetzungNorm")

    		d3.select("body").selectAll(".zeilen")
    		  .data(datenByTitle)
    		  .enter()
    		  .append('p')
          .attr("class", "zeilen")
          .text(function(d){
            if (korpus.filter(function(D,I){return D.KurzSignatur == d.values[0].BookID})[0]){
            return d.key
            +"*"+ d.values[0].maxPart
            +"*"+ d.values[0].Verfasser
            +"*"+ korpus.filter(function(D,I){return D.KurzSignatur == d.values[0].BookID})[0].Formalschlagwort_Genre
            +"*"+ d.values.filter(function(d){return d.Benutzungsspur == "1"}).length
            +"*"+ d.values.filter(function(d){return d.Benutzungsspur == "2"}).length
            +"*"+ d.values.filter(function(d){return d.Benutzungsspur == "3"}).length
            +"*"+ d.values.filter(function(d){return d.Benutzungsspur == "4"}).length
            +"*"+ d.values.filter(function(d){return d.Benutzungsspur == "6"}).length
            +"*"+ d.values.filter(function(d){return d.Benutzungsspur == "7"}).length
            +"*"+ d.values.filter(function(d){return d.SchriftspurTyp == "P" && d.Schreibmedium != "Stempel"}).length
            +"*"+ d.values.filter(function(d){return d.SchriftspurTyp == "P" && d.Schreibmedium == "Stempel"}).length
            +"*"+ d.values.filter(function(d){return d.SchriftspurTyp == "K"}).length
            +"*"+ d.values.filter(function(d){return d.SchriftspurTyp == "B"}).length
            +"*"+ d.values.filter(function(d){return d.SchriftspurTyp == "T"}).length
            +"*"+ d.values.filter(function(d){return d.SchriftspurTyp == "V"}).length
            +"*"+ d.values.filter(function(d){return d.SchriftspurTyp == "U"}).length
            ///normalized
            +"*"+ (d.values.filter(function(d){return d.Benutzungsspur == "1"}).length/d.values[0].maxPart).toFixed(6)
            +"*"+ (d.values.filter(function(d){return d.Benutzungsspur == "2"}).length/d.values[0].maxPart).toFixed(6)
            +"*"+ (d.values.filter(function(d){return d.Benutzungsspur == "3"}).length/d.values[0].maxPart).toFixed(6)
            +"*"+ (d.values.filter(function(d){return d.Benutzungsspur == "4"}).length/d.values[0].maxPart).toFixed(6)
            +"*"+ (d.values.filter(function(d){return d.Benutzungsspur == "6"}).length/d.values[0].maxPart).toFixed(6)
            +"*"+ (d.values.filter(function(d){return d.Benutzungsspur == "7"}).length/d.values[0].maxPart).toFixed(6)
            +"*"+ (d.values.filter(function(d){return d.SchriftspurTyp == "P" && d.Schreibmedium != "Stempel"}).length/d.values[0].maxPart).toFixed(6)
            +"*"+ (d.values.filter(function(d){return d.SchriftspurTyp == "P" && d.Schreibmedium == "Stempel"}).length/d.values[0].maxPart).toFixed(6)
            +"*"+ (d.values.filter(function(d){return d.SchriftspurTyp == "K"}).length/d.values[0].maxPart).toFixed(6)
            +"*"+ (d.values.filter(function(d){return d.SchriftspurTyp == "B"}).length/d.values[0].maxPart).toFixed(6)
            +"*"+ (d.values.filter(function(d){return d.SchriftspurTyp == "T"}).length/d.values[0].maxPart).toFixed(6)
            +"*"+ (d.values.filter(function(d){return d.SchriftspurTyp == "V"}).length/d.values[0].maxPart).toFixed(6)
            +"*"+ (d.values.filter(function(d){return d.SchriftspurTyp == "U"}).length/d.values[0].maxPart).toFixed(6)
        }else{
          return d.key
            +"*"+ d.values[0].maxPart
            +"*"+ d.values[0].Verfasser
            +"*"+ "null"
            +"*"+ d.values.filter(function(d){return d.Benutzungsspur == "1"}).length
            +"*"+ d.values.filter(function(d){return d.Benutzungsspur == "2"}).length
            +"*"+ d.values.filter(function(d){return d.Benutzungsspur == "3"}).length
            +"*"+ d.values.filter(function(d){return d.Benutzungsspur == "4"}).length
            +"*"+ d.values.filter(function(d){return d.Benutzungsspur == "6"}).length
            +"*"+ d.values.filter(function(d){return d.Benutzungsspur == "7"}).length
            +"*"+ d.values.filter(function(d){return d.SchriftspurTyp == "P" && d.Schreibmedium != "Stempel"}).length
            +"*"+ d.values.filter(function(d){return d.SchriftspurTyp == "P" && d.Schreibmedium == "Stempel"}).length
            +"*"+ d.values.filter(function(d){return d.SchriftspurTyp == "K"}).length
            +"*"+ d.values.filter(function(d){return d.SchriftspurTyp == "B"}).length
            +"*"+ d.values.filter(function(d){return d.SchriftspurTyp == "T"}).length
            +"*"+ d.values.filter(function(d){return d.SchriftspurTyp == "V"}).length
            +"*"+ d.values.filter(function(d){return d.SchriftspurTyp == "U"}).length
            ///normalized
            +"*"+ (d.values.filter(function(d){return d.Benutzungsspur == "1"}).length/d.values[0].maxPart).toFixed(6)
            +"*"+ (d.values.filter(function(d){return d.Benutzungsspur == "2"}).length/d.values[0].maxPart).toFixed(6)
            +"*"+ (d.values.filter(function(d){return d.Benutzungsspur == "3"}).length/d.values[0].maxPart).toFixed(6)
            +"*"+ (d.values.filter(function(d){return d.Benutzungsspur == "4"}).length/d.values[0].maxPart).toFixed(6)
            +"*"+ (d.values.filter(function(d){return d.Benutzungsspur == "6"}).length/d.values[0].maxPart).toFixed(6)
            +"*"+ (d.values.filter(function(d){return d.Benutzungsspur == "7"}).length/d.values[0].maxPart).toFixed(6)
            +"*"+ (d.values.filter(function(d){return d.SchriftspurTyp == "P" && d.Schreibmedium != "Stempel"}).length/d.values[0].maxPart).toFixed(6)
            +"*"+ (d.values.filter(function(d){return d.SchriftspurTyp == "P" && d.Schreibmedium == "Stempel"}).length/d.values[0].maxPart).toFixed(6)
            +"*"+ (d.values.filter(function(d){return d.SchriftspurTyp == "K"}).length/d.values[0].maxPart).toFixed(6)
            +"*"+ (d.values.filter(function(d){return d.SchriftspurTyp == "B"}).length/d.values[0].maxPart).toFixed(6)
            +"*"+ (d.values.filter(function(d){return d.SchriftspurTyp == "T"}).length/d.values[0].maxPart).toFixed(6)
            +"*"+ (d.values.filter(function(d){return d.SchriftspurTyp == "V"}).length/d.values[0].maxPart).toFixed(6)
            +"*"+ (d.values.filter(function(d){return d.SchriftspurTyp == "U"}).length/d.values[0].maxPart).toFixed(6)
        }

      });












        });
    </script>

</body>

</html>
